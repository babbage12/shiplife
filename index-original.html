<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Shiplife - An Interactive Journey</title>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #d4a574;
            --gold-light: #e8c9a0;
            --navy: #0a1628;
            --navy-light: #152238;
            --cream: #f5f0e8;
            --coral: #e07a5f;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'DM Sans', sans-serif;
            background: radial-gradient(ellipse at center, #1a2a4a 0%, var(--navy) 70%);
            color: var(--cream);
            min-height: 100vh;
            min-height: -webkit-fill-available; /* iOS Safari viewport fix */
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            -webkit-tap-highlight-color: transparent; /* Remove tap highlight globally */
        }
        
        /* iOS height fix */
        html {
            height: -webkit-fill-available;
        }

        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            padding: 2rem 3rem;
            background: linear-gradient(180deg, rgba(10, 22, 40, 0.9) 0%, transparent 100%);
            pointer-events: none;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .header a {
            pointer-events: auto;
        }

        .logo {
            font-family: 'Cormorant Garamond', serif;
            font-size: 2rem;
            font-weight: 300;
            letter-spacing: 0.1em;
        }

        .logo span {
            color: var(--gold);
        }

        .tagline {
            font-size: 0.7rem;
            letter-spacing: 0.25em;
            text-transform: uppercase;
            color: rgba(245, 240, 232, 0.4);
            margin-top: 0.25rem;
        }

        .center-name {
            position: fixed;
            top: 2rem;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            pointer-events: auto;
        }

        .center-name a {
            font-family: 'Cormorant Garamond', serif;
            font-size: 2rem;
            font-weight: 300;
            color: var(--cream);
            text-decoration: none;
            letter-spacing: 0.1em;
            transition: opacity 0.3s ease;
        }

        .center-name a span {
            color: var(--gold);
        }

        .center-name a:hover {
            opacity: 0.8;
        }

        /* Instructions */
        .instructions {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            text-align: center;
            pointer-events: none;
        }

        .instructions p {
            font-size: 0.8rem;
            color: rgba(245, 240, 232, 0.5);
            letter-spacing: 0.1em;
        }

        /* Location tooltip - anchored below icon */
        .tooltip {
            position: fixed;
            z-index: 200;
            background: linear-gradient(135deg, 
                rgba(30, 80, 140, 0.92), 
                rgba(20, 60, 120, 0.88));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(100, 160, 220, 0.4);
            border-radius: 12px;
            padding: 0.875rem 1.25rem;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s ease, transform 0.2s ease;
            max-width: 260px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            transform: translateX(-50%) translateY(8px);
        }
        
        /* Pointer arrow pointing up to the icon */
        .tooltip::before {
            content: '';
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-bottom: 12px solid rgba(30, 80, 140, 0.92);
        }
        
        /* Subtle glow effect */
        .tooltip::after {
            content: '';
            position: absolute;
            top: -1px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(100, 160, 220, 0.6), transparent);
            border-radius: 2px;
        }

        .tooltip.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
        
        /* Hide tooltip on touch devices */
        @media (hover: none) and (pointer: coarse) {
            .tooltip {
                display: none !important;
            }
        }

        .tooltip-title {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.2rem;
            color: var(--cream);
            margin-bottom: 0.15rem;
            line-height: 1.2;
        }

        .tooltip-tag {
            font-size: 0.6rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: var(--gold);
            margin-bottom: 0.4rem;
        }

        .tooltip-desc {
            font-size: 0.75rem;
            color: rgba(245, 240, 232, 0.8);
            line-height: 1.4;
        }

        /* Side panel for clicked location */
        .side-panel {
            position: fixed;
            top: 0;
            right: 0;
            width: 400px;
            height: 100%;
            background: linear-gradient(180deg, 
                rgb(50, 54, 48) 0%, 
                rgb(38, 42, 36) 100%);
            border-left: 1px solid rgba(212, 165, 116, 0.3);
            z-index: 150;
            transform: translateX(100%);
            transition: transform 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-y: auto;
        }

        /* Nautical decorative elements */
        .side-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Cpath d='M20 50 Q35 35 50 50 T80 50' stroke='%23d4a574' stroke-width='1' fill='none' opacity='0.08'/%3E%3Cpath d='M10 80 Q25 65 40 80 T70 80' stroke='%23d4a574' stroke-width='1' fill='none' opacity='0.06'/%3E%3Ccircle cx='85' cy='25' r='3' fill='%23d4a574' opacity='0.1'/%3E%3Cpath d='M5 20 Q20 5 35 20' stroke='%23d4a574' stroke-width='1' fill='none' opacity='0.07'/%3E%3C/svg%3E");
            background-size: 150px 150px;
            pointer-events: none;
            z-index: 0;
        }

        .side-panel > * {
            position: relative;
            z-index: 1;
        }

        .side-panel.open {
            transform: translateX(0);
        }

        .panel-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            font-size: 1.25rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .panel-close:hover {
            background: rgba(255,255,255,0.2);
        }

        /* Three Doors Navigation - sticky at top of panel */
        .three-doors-nav {
            display: flex;
            justify-content: center;
            gap: 8px;
            padding: 15px 20px;
            background: linear-gradient(180deg, rgba(30, 35, 28, 0.98) 0%, rgba(30, 35, 28, 0.95) 100%);
            margin-bottom: 0;
            position: sticky;
            top: 0;
            z-index: 10;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(212, 165, 116, 0.2);
        }
        
        .door-nav-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .door-nav-label {
            font-size: 0.65rem;
            color: rgba(245, 240, 232, 0.5);
            text-transform: lowercase;
            letter-spacing: 0.02em;
            white-space: nowrap;
            transition: color 0.3s ease;
        }
        
        .door-nav-item:hover .door-nav-label {
            color: var(--gold);
        }
        
        .door-nav-label.active-label {
            color: var(--gold);
            font-weight: 500;
        }
        
        .door-nav-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: 2px solid rgba(212, 165, 116, 0.4);
            background: rgba(30, 35, 28, 0.8);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            position: relative;
        }
        
        .door-nav-btn:hover {
            border-color: var(--gold);
            transform: scale(1.1);
            background: rgba(212, 165, 116, 0.15);
        }
        
        .door-nav-btn.active {
            border-color: var(--gold);
            background: rgba(212, 165, 116, 0.25);
            box-shadow: 0 0 15px rgba(212, 165, 116, 0.5), 
                        0 0 30px rgba(212, 165, 116, 0.3),
                        inset 0 0 10px rgba(212, 165, 116, 0.2);
        }
        
        .door-nav-btn .door-number {
            position: absolute;
            bottom: -4px;
            right: -4px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--gold);
            color: var(--navy);
            font-size: 0.6rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .door-nav-btn.active .door-number {
            background: var(--cream);
        }
        
        /* Hide three doors nav for non-door locations */
        .three-doors-nav.hidden {
            display: none;
        }

        /* Scroll hint at bottom of panel */
        .scroll-hint-bottom {
            position: fixed;
            bottom: 2rem;
            right: 0;
            width: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            z-index: 160;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            pointer-events: none;
        }
        
        .scroll-hint-bottom-inner {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, rgba(212, 165, 116, 0.25), rgba(212, 165, 116, 0.15));
            border: 1px solid rgba(212, 165, 116, 0.5);
            border-radius: 25px;
            color: var(--gold-light);
            font-size: 0.8rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .scroll-hint-bottom-inner .scroll-arrow {
            animation: bounceDown 1.5s ease-in-out infinite;
            font-size: 1.1rem;
        }

        @keyframes bounceDown {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(5px); }
        }

        .scroll-hint-bottom.visible {
            opacity: 1;
            visibility: visible;
        }

        /* Sidebar Scroll Hint */
        .sidebar-scroll-hint {
            position: fixed;
            left: 2rem;
            top: calc(50% + 32vh);
            z-index: 101;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.4rem 0.8rem;
            background: linear-gradient(135deg, rgba(212, 165, 116, 0.2), rgba(212, 165, 116, 0.1));
            border: 1px solid rgba(212, 165, 116, 0.4);
            border-radius: 15px;
            color: var(--gold-light);
            font-size: 0.65rem;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            backdrop-filter: blur(8px);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            pointer-events: none;
        }

        .sidebar-scroll-hint.visible {
            opacity: 1;
            visibility: visible;
        }

        .sidebar-scroll-hint .scroll-arrow {
            animation: bounceDown 1.5s ease-in-out infinite;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .scroll-hint-bottom {
                right: 0;
                left: 0;
                width: 100%;
                bottom: 1.5rem;
            }
        }

        .panel-image {
            width: 100%;
            height: 250px;
            object-fit: cover;
            object-position: var(--image-position, center);
        }

        .panel-image-container {
            position: relative;
        }

        .panel-image-caption {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 2rem 1rem 0.75rem;
            background: linear-gradient(to top, rgba(10, 22, 40, 0.9) 0%, transparent 100%);
            font-size: 0.75rem;
            color: rgba(245, 240, 232, 0.7);
            font-style: italic;
            text-align: center;
        }

        .panel-image-caption:empty {
            display: none;
        }

        .panel-content {
            padding: 2rem;
            padding-bottom: 3rem;
        }

        .panel-tag {
            display: inline-block;
            font-size: 0.65rem;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            color: var(--gold);
            background: rgba(212, 165, 116, 0.15);
            padding: 0.4rem 0.8rem;
            border-radius: 3px;
            border: 1px solid rgba(212, 165, 116, 0.3);
            margin-bottom: 0.75rem;
        }

        .panel-title {
            font-family: 'Cormorant Garamond', serif;
            font-size: 2rem;
            font-weight: 300;
            color: var(--cream);
            margin-bottom: 1.5rem;
        }

        .panel-text {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.1rem;
            line-height: 1.8;
            color: rgba(245, 240, 232, 0.85);
        }

        .panel-text p {
            margin-bottom: 1rem;
        }

        .story-image {
            width: 100%;
            border-radius: 8px;
            margin-top: 1.5rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .story-gallery {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .story-gallery .story-image {
            margin-top: 0;
        }

        /* Rich story panel styles */
        .story-section-panel {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid rgba(212, 165, 116, 0.25);
        }

        .story-section-panel:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .section-tag-panel {
            display: block;
            font-size: 0.65rem;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            color: var(--gold);
            margin-bottom: 0.5rem;
        }

        .section-title-panel {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.4rem;
            font-weight: 300;
            color: var(--cream);
            margin-bottom: 1rem;
            line-height: 1.3;
        }

        .story-section-panel p {
            margin-bottom: 0.8rem;
            line-height: 1.7;
        }

        .story-section-panel p:last-of-type {
            margin-bottom: 0;
        }

        .story-quote {
            position: relative;
            padding: 1.25rem 1.25rem 1.25rem 1.5rem;
            margin: 1.25rem 0;
            background: rgba(212, 165, 116, 0.12);
            border-left: 3px solid var(--gold);
            border-radius: 0 8px 8px 0;
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.15rem;
            font-style: italic;
            color: var(--cream);
            line-height: 1.5;
        }

        .story-quote cite {
            display: block;
            margin-top: 0.75rem;
            font-size: 0.8rem;
            font-style: normal;
            color: var(--gold);
        }

        .story-quote.final-quote {
            text-align: center;
            border-left: none;
            border: 1px solid rgba(212, 165, 116, 0.2);
            background: rgba(212, 165, 116, 0.05);
        }

        /* Story gallery grid for side-by-side photos */
        .story-gallery-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
            margin: 1rem 0;
        }

        .story-gallery-grid .story-image {
            margin: 0;
            aspect-ratio: 4/3;
            object-fit: cover;
        }

        .photo-caption-inline {
            font-size: 0.75rem;
            color: rgba(245, 240, 232, 0.5);
            font-style: italic;
            margin-top: 0.5rem;
            margin-bottom: 1rem;
            line-height: 1.4;
        }

        /* Demographics Strip */
        .demographics-strip {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem 1.25rem;
            padding: 0.75rem 0;
            margin-bottom: 1rem;
            border-bottom: 1px solid rgba(212, 165, 116, 0.2);
            font-size: 0.72rem;
            color: rgba(245, 240, 232, 0.6);
        }

        .demo-item {
            display: flex;
            align-items: center;
            gap: 0.35rem;
        }

        .demo-item .demo-icon {
            font-size: 0.85rem;
            opacity: 0.7;
        }

        .demo-item .demo-value {
            color: var(--cream);
            font-weight: 500;
        }

        /* More Info Button & Popup */
        .more-info-container {
            position: relative;
            margin: 1.5rem 0;
        }

        .more-info-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            width: 100%;
            padding: 0.9rem 1rem;
            background: rgba(212, 165, 116, 0.08);
            border: 1px dashed rgba(212, 165, 116, 0.4);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'DM Sans', sans-serif;
            font-size: 0.8rem;
            color: var(--gold-light);
            letter-spacing: 0.05em;
        }

        .more-info-btn:hover {
            background: rgba(212, 165, 116, 0.15);
            border-color: var(--gold);
        }

        .more-info-btn .info-icon {
            font-size: 1rem;
            transition: transform 0.3s ease;
        }

        .more-info-btn:hover .info-icon {
            transform: scale(1.15);
        }

        .more-info-popup {
            position: absolute;
            bottom: calc(100% + 10px);
            left: 0;
            right: 0;
            background: linear-gradient(135deg, rgba(30, 60, 100, 0.95), rgba(20, 45, 80, 0.95));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(100, 160, 220, 0.4);
            border-radius: 12px;
            padding: 1.25rem;
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px);
            transition: all 0.3s ease;
            z-index: 100;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .more-info-popup::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 10px solid rgba(30, 60, 100, 0.95);
        }

        .more-info-container:hover .more-info-popup,
        .more-info-container.active .more-info-popup {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .popup-title {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.1rem;
            color: var(--gold-light);
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .popup-title .title-icon {
            font-size: 1.2rem;
        }

        .fun-facts-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .fun-facts-list li {
            position: relative;
            padding: 0.5rem 0 0.5rem 1.25rem;
            font-size: 0.85rem;
            color: rgba(245, 240, 232, 0.9);
            line-height: 1.5;
            border-bottom: 1px solid rgba(100, 160, 220, 0.15);
        }

        .fun-facts-list li:last-child {
            border-bottom: none;
        }

        .fun-facts-list li::before {
            content: 'âœ¦';
            position: absolute;
            left: 0;
            color: var(--gold);
            font-size: 0.7rem;
        }

        .fun-facts-list li strong {
            color: var(--gold-light);
        }

        /* Director's Commentary Easter Egg */
        .directors-commentary {
            display: inline-flex;
            align-items: center;
            margin-left: 0.75rem;
            vertical-align: middle;
            position: relative;
        }

        .commentary-trigger {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 60px;
            height: 60px;
            background: transparent;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            box-shadow: 0 2px 15px rgba(212, 165, 116, 0.4), 0 0 25px rgba(212, 165, 116, 0.2);
            animation: phoneGlow 2s ease-in-out infinite;
            overflow: hidden;
        }

        .commentary-trigger img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        @keyframes phoneGlow {
            0%, 100% { box-shadow: 0 2px 15px rgba(212, 165, 116, 0.4), 0 0 25px rgba(212, 165, 116, 0.2); }
            50% { box-shadow: 0 4px 20px rgba(212, 165, 116, 0.6), 0 0 35px rgba(212, 165, 116, 0.4); }
        }

        .commentary-trigger:hover {
            transform: scale(1.15);
            box-shadow: 0 4px 25px rgba(212, 165, 116, 0.6), 0 0 45px rgba(212, 165, 116, 0.3);
            animation: none;
        }

        .click-me-text {
            position: absolute;
            width: 90px;
            height: 90px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            animation: rotateText 8s linear infinite;
        }

        @keyframes rotateText {
            from { transform: translate(-50%, -50%) rotate(0deg); }
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .click-me-text text {
            fill: var(--gold);
            font-size: 10px;
            font-weight: 700;
            letter-spacing: 0.08em;
            text-transform: uppercase;
        }

        .directors-commentary:hover .click-me-text {
            animation-play-state: paused;
        }

        /* Modal Overlay for Commentary */
        .commentary-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 22, 40, 0.85);
            backdrop-filter: blur(8px);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .commentary-modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .commentary-modal {
            background: linear-gradient(135deg, rgba(38, 42, 36, 0.98), rgba(28, 32, 26, 0.98));
            border: 1px solid rgba(212, 165, 116, 0.4);
            border-radius: 16px;
            padding: 2rem;
            max-width: 500px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.7);
            transform: scale(0.9) translateY(20px);
            transition: transform 0.3s ease;
        }

        .commentary-modal-overlay.active .commentary-modal {
            transform: scale(1) translateY(0);
        }

        .commentary-modal-close {
            position: absolute;
            top: 1rem;
            right: 1.5rem;
            width: 36px;
            height: 36px;
            background: rgba(212, 165, 116, 0.15);
            border: 1px solid rgba(212, 165, 116, 0.3);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--gold-light);
            transition: all 0.2s ease;
        }

        .commentary-modal-close:hover {
            background: rgba(212, 165, 116, 0.25);
            transform: scale(1.1);
        }

        .commentary-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid rgba(212, 165, 116, 0.2);
        }

        .commentary-icon {
            font-size: 1.2rem;
        }

        .commentary-label {
            font-size: 0.6rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: var(--gold);
        }

        .commentary-title {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.5rem;
            color: var(--cream);
            margin-bottom: 1.25rem;
            line-height: 1.3;
        }

        .commentary-modal p {
            font-size: 0.92rem;
            line-height: 1.75;
            color: rgba(245, 240, 232, 0.9);
            margin-bottom: 0.8rem;
        }

        .commentary-modal p:last-of-type {
            margin-bottom: 0;
        }

        .commentary-modal .story-emphasis {
            color: var(--gold-light);
            font-weight: 500;
        }

        .commentary-modal .zeros {
            font-family: monospace;
            font-style: italic;
            color: rgba(245, 240, 232, 0.7);
            margin-bottom: 0.4rem;
        }

        .commentary-modal .captain-voice {
            display: block;
            margin: 1rem 0;
            padding: 0.75rem 1rem;
            background: rgba(212, 165, 116, 0.1);
            border-left: 2px solid var(--gold);
            border-radius: 0 6px 6px 0;
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.1rem;
            font-style: italic;
            color: var(--cream);
        }

        .commentary-modal .rule-one {
            display: block;
            margin: 1.25rem 0;
            padding: 0.75rem 1rem;
            background: rgba(224, 122, 95, 0.15);
            border: 1px solid rgba(224, 122, 95, 0.3);
            border-radius: 6px;
            font-size: 0.88rem;
            color: var(--coral);
            font-weight: 500;
        }

        .commentary-modal .kicker {
            font-style: italic;
            color: var(--gold-light);
            margin-top: 1.25rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(212, 165, 116, 0.15);
        }

        @media (max-width: 600px) {
            .commentary-modal {
                padding: 1.5rem;
                margin: 1rem;
            }
            
            .commentary-title {
                font-size: 1.3rem;
            }
            
            .commentary-trigger {
                width: 32px;
                height: 32px;
                font-size: 1rem;
            }
        }

        .commentary-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid rgba(212, 165, 116, 0.2);
        }

        .commentary-icon {
            font-size: 1.2rem;
        }

        .commentary-label {
            font-size: 0.6rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: var(--gold);
        }

        .commentary-title {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.3rem;
            color: var(--cream);
            margin-bottom: 1rem;
            line-height: 1.3;
        }

        .commentary-popup p {
            font-size: 0.88rem;
            line-height: 1.7;
            color: rgba(245, 240, 232, 0.9);
            margin-bottom: 0.75rem;
        }

        .commentary-popup p:last-of-type {
            margin-bottom: 0;
        }

        .commentary-popup .story-emphasis {
            color: var(--gold-light);
            font-weight: 500;
        }

        .commentary-popup .zeros {
            font-family: monospace;
            font-style: italic;
            color: rgba(245, 240, 232, 0.7);
        }

        .commentary-popup .captain-voice {
            display: block;
            margin: 1rem 0;
            padding: 0.75rem 1rem;
            background: rgba(212, 165, 116, 0.1);
            border-left: 2px solid var(--gold);
            border-radius: 0 6px 6px 0;
            font-family: 'Cormorant Garamond', serif;
            font-size: 1rem;
            font-style: italic;
            color: var(--cream);
        }

        .commentary-popup .rule-one {
            display: block;
            margin: 1rem 0;
            padding: 0.6rem 0.8rem;
            background: rgba(224, 122, 95, 0.15);
            border: 1px solid rgba(224, 122, 95, 0.3);
            border-radius: 6px;
            font-size: 0.82rem;
            color: var(--coral);
            font-weight: 500;
        }

        .commentary-popup .kicker {
            font-style: italic;
            color: var(--gold-light);
            margin-top: 1rem;
            padding-top: 0.75rem;
            border-top: 1px solid rgba(212, 165, 116, 0.15);
        }

        /* Mobile tap support for commentary */
        @media (hover: none) and (pointer: coarse) {
            .commentary-trigger::after {
                display: none;
            }
        }

        /* Photo Gallery Section */
        .photo-gallery-section {
            margin-top: 2rem;
            margin-bottom: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(212, 165, 116, 0.25);
        }

        .gallery-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
            cursor: pointer;
        }

        .gallery-title {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.1rem;
            color: var(--cream);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .gallery-title .gallery-icon {
            font-size: 1.2rem;
        }

        .gallery-count {
            font-size: 0.7rem;
            color: var(--gold);
            background: rgba(212, 165, 116, 0.15);
            padding: 0.25rem 0.6rem;
            border-radius: 12px;
        }

        .gallery-toggle {
            font-size: 1.2rem;
            color: var(--gold);
            transition: transform 0.3s ease;
        }

        .gallery-header:hover .gallery-toggle {
            transform: scale(1.2);
        }

        .photo-gallery-section.expanded .gallery-toggle {
            transform: rotate(180deg);
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease, opacity 0.3s ease;
            opacity: 0;
        }

        .photo-gallery-section.expanded .gallery-grid {
            max-height: 1500px;
            opacity: 1;
            margin-bottom: 2rem;
        }

        .gallery-thumb {
            aspect-ratio: 1;
            width: 100%;
            object-fit: cover;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            filter: brightness(0.85);
        }

        .gallery-thumb:hover {
            filter: brightness(1);
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            z-index: 2;
            position: relative;
        }

        @media (max-width: 480px) {
            .demographics-strip {
                gap: 0.4rem 1rem;
            }
            
            .gallery-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* World Tour Carousel */
        .world-carousel {
            position: relative;
            width: 100%;
            height: 280px;
            margin: 1.5rem 0;
            border-radius: 12px;
            overflow: hidden;
            background: var(--navy);
            -webkit-transform: translateZ(0); /* Force GPU acceleration on iOS */
            transform: translateZ(0);
        }

        .carousel-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 1s ease-in-out;
            -webkit-backface-visibility: hidden; /* Prevent flickering on iOS */
            backface-visibility: hidden;
        }

        .carousel-slide.active {
            opacity: 1;
        }

        .carousel-slide img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            -webkit-user-drag: none; /* Prevent image dragging on iOS */
            user-select: none;
        }

        .carousel-caption {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 2rem 1rem 2rem;
            background: linear-gradient(transparent, rgba(10, 22, 40, 0.9));
            text-align: center;
            pointer-events: none;
        }

        .carousel-caption span {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.5rem;
            color: var(--cream);
            letter-spacing: 0.1em;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }

        .carousel-dots {
            position: absolute;
            bottom: 0.75rem;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 6px;
            z-index: 20;
            pointer-events: auto;
        }

        .carousel-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(245, 240, 232, 0.3);
            transition: all 0.3s ease;
            cursor: pointer;
            pointer-events: auto;
            -webkit-tap-highlight-color: transparent; /* Remove tap highlight on iOS */
        }

        .carousel-dot:hover {
            background: rgba(245, 240, 232, 0.6);
        }

        .carousel-dot.active {
            background: var(--gold);
            transform: scale(1.2);
        }

        .carousel-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            background: rgba(10, 22, 40, 0.7);
            border: 1px solid rgba(212, 165, 116, 0.3);
            border-radius: 50%;
            color: var(--cream);
            font-size: 1.2rem;
            cursor: pointer;
            z-index: 20;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            -webkit-tap-highlight-color: transparent; /* Remove tap highlight on iOS */
            -webkit-appearance: none; /* Remove default button styling on iOS */
        }

        .carousel-arrow:hover {
            background: rgba(212, 165, 116, 0.3);
            border-color: var(--gold);
        }

        .carousel-arrow.prev {
            left: 10px;
        }

        .carousel-arrow.next {
            right: 10px;
        }

        @media (max-width: 768px) {
            .carousel-arrow {
                width: 32px;
                height: 32px;
                font-size: 1rem;
            }
            
            .carousel-arrow.prev {
                left: 5px;
            }
            
            .carousel-arrow.next {
                right: 5px;
            }
        }

        .carousel-title {
            text-align: center;
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.1rem;
            color: rgba(245, 240, 232, 0.6);
            letter-spacing: 0.15em;
            text-transform: uppercase;
            margin-bottom: 1rem;
        }

        @media (max-width: 768px) {
            .world-carousel {
                height: 220px;
            }
            
            .carousel-caption span {
                font-size: 1.25rem;
            }
            
            .carousel-dots {
                gap: 8px;
                padding: 10px; /* Larger tap area */
            }
            
            .carousel-dot {
                width: 10px;
                height: 10px;
                /* Larger invisible tap target */
                position: relative;
            }
            
            .carousel-dot::before {
                content: '';
                position: absolute;
                top: -8px;
                left: -8px;
                right: -8px;
                bottom: -8px;
            }
            
            .carousel-arrow {
                width: 44px; /* iOS minimum tap target */
                height: 44px;
            }
        }

        @media (max-width: 500px) {
            .story-gallery-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Lightbox */
        .lightbox {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 22, 40, 0.95);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            cursor: pointer;
        }

        .lightbox.active {
            display: flex;
        }

        .lightbox img {
            max-width: 90%;
            max-height: 80%;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
        }

        .lightbox-close {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            font-size: 2rem;
            color: var(--cream);
            cursor: pointer;
            transition: color 0.3s;
            z-index: 1001;
        }

        .lightbox-close:hover {
            color: var(--gold);
        }

        .lightbox-caption {
            margin-top: 1rem;
            font-size: 0.85rem;
            color: rgba(245, 240, 232, 0.7);
            font-style: italic;
            text-align: center;
            max-width: 600px;
            padding: 0 1rem;
        }

        .lightbox-caption:empty {
            display: none;
        }

        /* Make story images clickable */
        .story-image {
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .story-image:hover {
            transform: scale(1.02);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }

        /* Back to globe link - subtle secondary action */
        .back-to-globe {
            display: block;
            text-align: center;
            margin-top: 15px;
            padding: 10px;
            color: rgba(245, 240, 232, 0.35);
            font-size: 0.75rem;
            cursor: pointer;
            transition: color 0.3s ease;
        }
        
        .back-to-globe:hover {
            color: rgba(245, 240, 232, 0.6);
        }

        .copyright {
            text-align: center;
            margin-top: 20px;
            padding: 15px 10px;
            color: rgba(245, 240, 232, 0.25);
            font-size: 0.65rem;
            letter-spacing: 0.05em;
            border-top: 1px solid rgba(212, 165, 116, 0.1);
        }
        
        /* Next Door button - prominent call to action */
        .next-door-hint {
            display: block;
            margin-top: 20px;
            padding: 18px 20px;
            background: linear-gradient(135deg, rgba(212, 165, 116, 0.25), rgba(212, 165, 116, 0.1));
            border: 2px solid rgba(212, 165, 116, 0.5);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .next-door-hint:hover {
            background: linear-gradient(135deg, rgba(212, 165, 116, 0.35), rgba(212, 165, 116, 0.15));
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(212, 165, 116, 0.2);
        }
        
        .next-door-hint .door-icon {
            display: block;
            font-size: 1.5rem;
            margin-bottom: 5px;
        }
        
        .next-door-hint .door-text {
            display: block;
            font-size: 1rem;
            font-weight: 500;
            color: var(--gold);
            letter-spacing: 0.05em;
        }

        /* Locations hint - visual link to panel below */
        .locations-hint {
            display: block;
            margin-top: 15px;
            padding: 15px 20px;
            background: linear-gradient(135deg, rgba(212, 165, 116, 0.15), rgba(212, 165, 116, 0.05));
            border: 1px solid rgba(212, 165, 116, 0.3);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .locations-hint:hover {
            background: linear-gradient(135deg, rgba(212, 165, 116, 0.25), rgba(212, 165, 116, 0.1));
        }
        
        .locations-hint .hint-arrow {
            display: block;
            font-size: 1.2rem;
            color: var(--gold);
            animation: bounce-arrow 1.5s ease-in-out infinite;
        }
        
        .locations-hint .hint-text {
            display: block;
            font-size: 0.9rem;
            color: var(--cream);
            margin: 5px 0 3px;
            font-weight: 500;
        }
        
        .locations-hint .hint-count {
            display: block;
            font-size: 0.75rem;
            color: var(--gold);
            opacity: 0.8;
        }
        
        @keyframes bounce-arrow {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(4px); }
        }

        @media (max-width: 768px) {
            .panel-close-link {
                display: block;
            }
            
            .locations-hint {
                display: block;
            }
        }

        /* Location list */
        .location-list {
            position: fixed;
            left: 2rem;
            top: 50%;
            transform: translateY(-50%);
            z-index: 100;
            max-height: 60vh;
            overflow-y: auto;
        }

        .left-copyright {
            position: fixed;
            left: 2rem;
            bottom: 2rem;
            z-index: 100;
            font-size: 0.65rem;
            color: rgba(245, 240, 232, 0.3);
            letter-spacing: 0.05em;
        }

        .location-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 1rem;
            margin-bottom: 0.25rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.02);
        }

        .location-item:hover {
            background: rgba(212, 165, 116, 0.1);
        }

        .location-item.door {
            background: rgba(212, 165, 116, 0.08);
        }

        .location-item .icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, 
                rgba(212, 165, 116, 0.3), 
                rgba(224, 122, 95, 0.2));
            backdrop-filter: blur(5px);
            border: 1px solid rgba(212, 165, 116, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            overflow: hidden;
        }
        
        .location-item .icon canvas {
            width: 100%;
            height: 100%;
        }

        .location-item.door .icon {
            width: 38px;
            height: 38px;
            font-size: 1.1rem;
            border: 2px solid rgba(212, 165, 116, 0.5);
            box-shadow: 0 0 15px rgba(212, 165, 116, 0.3);
        }

        .location-item .name {
            font-size: 0.85rem;
            color: var(--cream);
        }

        .location-item.door .name {
            color: var(--gold);
            font-weight: 500;
        }
        
        /* Icon style indicators */
        .location-item[data-style="deco"] .icon {
            border-color: rgba(212, 165, 116, 0.5);
            background: linear-gradient(135deg, rgba(212, 165, 116, 0.2), rgba(139, 105, 20, 0.2));
        }
        
        .location-item[data-style="minimal"] .icon {
            border-color: rgba(150, 180, 200, 0.4);
            background: linear-gradient(135deg, rgba(150, 180, 200, 0.15), rgba(96, 112, 128, 0.15));
        }
        
        .location-item[data-style="heritage"] .icon {
            border-color: rgba(139, 115, 85, 0.5);
            background: linear-gradient(135deg, rgba(139, 115, 85, 0.2), rgba(90, 74, 58, 0.2));
        }
        
        .location-item[data-style="paradise"] .icon {
            border-color: rgba(64, 224, 208, 0.4);
            background: linear-gradient(135deg, rgba(64, 224, 208, 0.15), rgba(74, 144, 160, 0.15));
        }
        
        .location-item[data-style="adventure"] .icon {
            border-color: rgba(96, 112, 128, 0.5);
            background: linear-gradient(135deg, rgba(96, 112, 128, 0.2), rgba(45, 55, 72, 0.2));
        }
        
        .location-item[data-style="culture"] .icon {
            border-color: rgba(224, 122, 95, 0.4);
            background: linear-gradient(135deg, rgba(224, 122, 95, 0.15), rgba(114, 47, 55, 0.15));
        }

        /* Scrollbar styling */
        /* Subtle scrollbar for location list */
        .location-list::-webkit-scrollbar {
            width: 4px;
        }

        .location-list::-webkit-scrollbar-track {
            background: transparent;
        }

        .location-list::-webkit-scrollbar-thumb {
            background: rgba(212, 165, 116, 0.15);
            border-radius: 2px;
        }
        
        .location-list::-webkit-scrollbar-thumb:hover {
            background: rgba(212, 165, 116, 0.3);
        }
        
        /* General scrollbar styling */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(212, 165, 116, 0.3);
            border-radius: 3px;
        }

        /* Stars background */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        /* Loading */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--navy);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            transition: opacity 0.5s ease;
        }

        .loading.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-text {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.5rem;
            color: var(--gold);
        }

        @media (max-width: 768px) {
            .header {
                padding: 1rem 1.5rem;
            }
            
            .logo {
                font-size: 1.5rem;
            }
            
            .tagline {
                font-size: 0.55rem;
            }

            .center-name a {
                font-size: 1.25rem;
            }
            
            .left-copyright {
                display: none; /* Hide on mobile - already in side panel */
            }
            
            .sidebar-scroll-hint {
                display: none; /* Hide on mobile */
            }
            
            /* Left menu - bottom sheet style */
            .location-list {
                position: fixed;
                left: 0;
                right: 0;
                bottom: 0;
                top: auto;
                width: 100%;
                height: auto;
                max-height: 50vh;
                background: linear-gradient(180deg, 
                    rgba(10, 22, 40, 0.98) 0%,
                    rgba(21, 34, 56, 0.98) 100%);
                backdrop-filter: blur(12px);
                -webkit-backdrop-filter: blur(12px);
                transform: translateY(100%);
                transition: transform 0.3s ease;
                padding: 20px 15px 30px;
                z-index: 200;
                border-top: 1px solid rgba(212, 165, 116, 0.3);
                border-radius: 20px 20px 0 0;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
                /* Force new stacking context to isolate backdrop-filter issues */
                isolation: isolate;
            }
            
            .location-list.open {
                transform: translateY(0);
            }
            
            /* Fix Android scroll flickering - force GPU layer for each item */
            .location-list .location-item {
                transform: translateZ(0);
                will-change: transform;
                backface-visibility: hidden;
            }
            
            .location-list .location-item .name {
                transform: translateZ(0);
                will-change: contents;
                backface-visibility: hidden;
            }
            
            /* Fallback: If backdrop-filter causes issues, use solid background */
            @supports not (backdrop-filter: blur(1px)) {
                .location-list {
                    background: linear-gradient(180deg, 
                        rgb(10, 22, 40) 0%,
                        rgb(21, 34, 56) 100%);
                }
            }
            
            .location-list::before {
                content: '';
                display: block;
                width: 40px;
                height: 4px;
                background: rgba(212, 165, 116, 0.5);
                border-radius: 2px;
                margin: 0 auto 15px;
            }
            
            /* Right panel - bottom sheet style, starts as preview */
            .side-panel {
                position: fixed !important;
                left: 0 !important;
                right: 0 !important;
                bottom: 0 !important;
                top: auto !important;
                width: 100% !important;
                height: 45vh;
                max-height: 45vh;
                border-radius: 20px 20px 0 0;
                border-left: none;
                border-top: 1px solid rgba(212, 165, 116, 0.3);
                transform: translateY(100%);
                overflow: hidden;
                z-index: 300 !important;
                background: linear-gradient(180deg, rgb(10, 22, 40) 0%, rgb(21, 34, 56) 100%) !important;
            }
            
            .side-panel.open {
                transform: translateY(0) !important;
            }
            
            .side-panel.expanded {
                height: 90vh;
                max-height: 90vh;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .panel-close {
                position: absolute;
                top: 0.75rem;
                right: 0.75rem;
                z-index: 300;
                width: 36px;
                height: 36px;
                background: rgba(10, 22, 40, 0.9);
                border: 2px solid var(--gold);
            }
            
            .panel-image {
                height: 120px;
            }
            
            .side-panel.expanded .panel-image {
                height: 200px;
            }
            
            .panel-content {
                padding: 1rem 1.5rem;
                padding-bottom: 30px;
            }
            
            .side-panel.expanded .panel-content {
                padding-bottom: 100px;
            }
            
            /* Show back link always */
            .back-to-globe {
                display: block;
            }
            
            /* Hide next door and locations hint in collapsed state */
            .next-door-hint,
            .locations-hint {
                display: none;
            }
            
            /* Show them when expanded */
            .side-panel.expanded .next-door-hint,
            .side-panel.expanded .locations-hint {
                display: block;
            }
            
            /* Hide swipe hint when expanded */
            .side-panel.expanded .swipe-hint {
                display: none;
            }
            
            .panel-title {
                font-size: 1.5rem;
                margin-bottom: 0.75rem;
            }
            
            .panel-text {
                display: none;
            }
            
            .side-panel.expanded .panel-text {
                display: block;
            }
            
            .side-panel.expanded .panel-content {
                padding-bottom: 100px;
            }
            
            .instructions {
                bottom: 1.5rem;
                left: 1rem;
                right: 1rem;
                transform: none;
                background: rgba(10, 22, 40, 0.8);
                padding: 0.5rem 1rem;
                border-radius: 20px;
            }
            
            .instructions p {
                font-size: 0.65rem;
            }
            
            /* Prevent page zoom on double-tap */
            * {
                touch-action: manipulation;
            }
        }
        
        /* Panel preview text - shown on mobile before expanding */
        .panel-preview {
            display: none;
        }
        
        .swipe-hint {
            display: none;
        }
        
        @media (max-width: 768px) {
            .panel-preview {
                display: block;
                font-family: 'Cormorant Garamond', serif;
                font-size: 1rem;
                line-height: 1.6;
                color: rgba(245, 240, 232, 0.85);
                margin-top: 0.5rem;
            }
            
            .side-panel.expanded .panel-preview {
                display: none;
            }
            
            .swipe-hint {
                display: block;
                text-align: center;
                font-size: 0.75rem;
                color: var(--gold);
                opacity: 0.7;
                margin-top: 1rem;
                animation: pulse-hint 2s ease-in-out infinite;
            }
            
            .side-panel.expanded .swipe-hint {
                display: none;
            }
            
            @keyframes pulse-hint {
                0%, 100% { opacity: 0.5; transform: translateY(0); }
                50% { opacity: 1; transform: translateY(-3px); }
            }
        }
        
        /* Hamburger Menu Button */
        .menu-toggle {
            position: fixed;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            z-index: 250;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, 
                rgba(212, 165, 116, 0.2), 
                rgba(224, 122, 95, 0.15));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(212, 165, 116, 0.3);
            cursor: pointer;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 5px;
            transition: all 0.3s ease;
        }
        
        .menu-toggle:hover {
            background: linear-gradient(135deg, 
                rgba(212, 165, 116, 0.3), 
                rgba(224, 122, 95, 0.25));
        }
        
        .menu-toggle span {
            display: block;
            width: 22px;
            height: 2px;
            background: var(--gold);
            border-radius: 2px;
            transition: all 0.3s ease;
        }
        
        .menu-toggle.open span:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }
        
        .menu-toggle.open span:nth-child(2) {
            opacity: 0;
        }
        
        .menu-toggle.open span:nth-child(3) {
            transform: rotate(-45deg) translate(5px, -5px);
        }
        
        @media (max-width: 768px) {
            .menu-toggle {
                display: flex !important;
                left: auto !important;
                right: 1rem !important;
                top: auto !important;
                bottom: 5rem !important;
                transform: none !important;
                background: rgba(212, 165, 116, 0.95) !important;
                border: 2px solid var(--gold) !important;
                box-shadow: 0 4px 20px rgba(0,0,0,0.4) !important;
                z-index: 350 !important;
            }
            
            .menu-toggle span {
                background: var(--navy) !important;
            }
        }
        
        /* Mobile overlay */
        .mobile-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 180;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .mobile-overlay.open {
            opacity: 1;
            pointer-events: auto;
        }
        
        /* Instructions switching */
        .mobile-instructions {
            display: none;
        }
        
        @media (max-width: 768px) {
            .desktop-instructions {
                display: none;
            }
            .mobile-instructions {
                display: block;
            }
        }
        
    </style>
</head>
<body>
    <!-- Loading screen -->
    <div class="loading" id="loading">
        <div class="loading-text">Loading globe...</div>
    </div>

    <!-- Stars background -->
    <canvas class="stars" id="stars"></canvas>
    
    <!-- Three.js Canvas -->
    <div id="canvas-container"></div>

    <!-- Header -->
    <div class="header">
        <div class="logo"><a href="https://derrickhudson.com" style="color: inherit; text-decoration: none;">Ship<span>life</span></a></div>
        <div class="tagline">12 Years at Sea â€¢ 60 Countries â€¢ Spanning All 7 Continents</div>
    </div>
    
    <!-- Centered name link at top -->
    <div class="center-name"><a href="https://derrickhudson.com"><span>Derrick</span>Hudson.com</a></div>

    <!-- Mobile Menu Toggle -->
    <button class="menu-toggle" id="menuToggle" onclick="toggleMobileMenu()">
        <span></span>
        <span></span>
        <span></span>
    </button>
    
    <!-- Mobile Overlay -->
    <div class="mobile-overlay" id="mobileOverlay" onclick="toggleMobileMenu()"></div>

    <!-- Location List -->
    <div class="location-list" id="locationList"></div>
    
    <!-- Sidebar Scroll Hint -->
    <div class="sidebar-scroll-hint" id="sidebarScrollHint">
        <span class="scroll-arrow">â†“</span>
        <span>Scroll for more locations</span>
    </div>
    
    <!-- Copyright below left panel -->
    <div class="left-copyright">Â© Derrick Hudson. All rights reserved.</div>

    <!-- Tooltip -->
    <div class="tooltip" id="tooltip">
        <div class="tooltip-tag" id="tooltipTag"></div>
        <div class="tooltip-title" id="tooltipTitle"></div>
        <div class="tooltip-desc" id="tooltipDesc"></div>
    </div>

    <!-- Side Panel -->
    <div class="side-panel" id="sidePanel">
        <button class="panel-close" onclick="closePanel()">Ã—</button>
        
        <!-- Three Doors Navigation -->
        <div class="three-doors-nav" id="threeDoorsNav">
            <div class="door-nav-item">
                <span class="door-nav-label" id="doorLabel1"></span>
                <button class="door-nav-btn" data-door="1" onclick="goToDoor(1)" title="Door #1: Escape">
                    ðŸšª
                    <span class="door-number">1</span>
                </button>
            </div>
            <div class="door-nav-item">
                <span class="door-nav-label" id="doorLabel2"></span>
                <button class="door-nav-btn" data-door="2" onclick="goToDoor(2)" title="Door #2: First Contract">
                    ðŸšª
                    <span class="door-number">2</span>
                </button>
            </div>
            <div class="door-nav-item">
                <span class="door-nav-label" id="doorLabel3"></span>
                <button class="door-nav-btn" data-door="3" onclick="goToDoor(3)" title="Door #3: Full Circle">
                    ðŸšª
                    <span class="door-number">3</span>
                </button>
            </div>
        </div>
        
        <div class="panel-image-container">
            <img class="panel-image" id="panelImage" src="" alt="">
            <div class="panel-image-caption" id="panelImageCaption"></div>
        </div>
        <div class="panel-content">
            <div class="panel-tag" id="panelTag"></div>
            <h2 class="panel-title" id="panelTitle"></h2>
            <div class="panel-preview" id="panelPreview"></div>
            <div class="panel-text" id="panelText"></div>
            <div class="swipe-hint">â†‘ Swipe up for full story</div>
            <div class="next-door-hint" id="nextDoorHint" onclick="goToNextDoor()">
                <span class="door-icon">ðŸšª</span>
                <span class="door-text" id="nextDoorText">Continue to Door #2</span>
            </div>
            <div class="locations-hint" onclick="viewAllLocations()">
                <span class="hint-arrow">â†“</span>
                <span class="hint-text">View All Locations</span>
                <span class="hint-count" id="locationsCount">24 places</span>
            </div>
            <a class="back-to-globe" onclick="closePanel()">back to globe</a>
            <div class="copyright">Â© Derrick Hudson. All rights reserved.</div>
        </div>
    </div>
    
    <!-- Scroll hint at bottom (outside panel for fixed positioning) -->
    <div class="scroll-hint-bottom" id="scrollHintBottom">
        <div class="scroll-hint-bottom-inner">
            <span class="scroll-arrow">â†“</span>
            <span>Scroll to read</span>
        </div>
    </div>

    <!-- Instructions -->
    <div class="instructions">
        <p class="desktop-instructions">Drag to rotate â€¢ Scroll to zoom â€¢ Click a location to explore</p>
        <p class="mobile-instructions">Drag to rotate â€¢ Pinch to zoom â€¢ Tap a location to explore</p>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // ============================================
        // CENTRALIZED PHOTO GALLERY SYSTEM
        // Add photos here for any location - they'll appear in the collapsible gallery
        // ============================================
        const locationGalleries = {
            // AMAZON RIVER / MANAUS
            "amazon": [
                { src: "v1768955858/IMG_6071_yay66j.jpg", caption: "Teatro Amazonas - the opera house in the jungle.", alt: "Teatro Amazonas exterior" },
                { src: "v1768952174/IMG_6136_bkdyes.jpg", caption: "Sunset over the Rio Negro bridge - Manaus, Brazil.", alt: "Bridge at sunset" },
                { src: "v1768961386/IMG_6160_ymulqf.jpg", caption: "Halfway to Manaus.", alt: "Amazon River journey" },
                { src: "v1768961331/IMG_6005_b0cdt2.jpg", caption: "Docked on the Amazon.", alt: "Docked" },
                { src: "v1768961199/IMG_6020_yyepgk.jpg", caption: "On the Amazon River.", alt: "Amazon River" },
                { src: "v1768955835/IMG_6083_wcbeq4.jpg", caption: "Inside the Teatro Amazonas.", alt: "Teatro interior" },
                { src: "v1768955810/IMG_6104_ve9cwn.jpg", caption: "Teatro Amazonas details.", alt: "Teatro interior details" },
                { src: "v1768955785/IMG_6112_vqplpw.jpg", caption: "At the Teatro Amazonas with the horse carriage.", alt: "Derrick at Teatro with carriage" },
                { src: "v1768955757/IMG_6129_hwafyh.jpg", caption: "Teatro Amazonas monument.", alt: "Teatro monument" },
                { src: "v1768951605/Screenshot_20260120_134633_Facebook_upegbd.jpg", caption: "Meeting the locals - a python around my neck.", alt: "Snake around neck" },
                { src: "v1768951523/Screenshot_20260120_142110_Facebook_sfqgia.jpg", caption: "Holding a sloth - 2012 tributary excursion.", alt: "Derrick holding sloth" },
                { src: "v1768951523/Screenshot_20260120_142041_Facebook_qa7xiz.jpg", caption: "The sloth wasn't in any hurry to leave.", alt: "Sloth closeup" },
                { src: "v1768951523/Screenshot_20260120_142055_Facebook_sdm2xc.jpg", caption: "Baby alligator - tributary wildlife.", alt: "Baby gator" },
                { src: "v1768951604/Screenshot_20260120_134644_Facebook_vooudq.jpg", caption: "Another young crocodilian friend.", alt: "Baby croc" },
                { src: "v1768951518/Screenshot_20260120_142140_Facebook_fladgt.jpg", caption: "A curious monkey in the Amazon.", alt: "Monkey" },
                { src: "v1768951516/Screenshot_20260120_142200_Facebook_m2ofot.jpg", caption: "Bird's nest in the canopy.", alt: "Tree with nest" },
                { src: "v1768951604/Screenshot_20260120_134703_Facebook_imcpbv.jpg", caption: "A floating market along the tributary.", alt: "Jungle market" },
                { src: "v1768962276/IMG_6023_l1kkqd.jpg", caption: "Lost in Manaus.", alt: "Lost in Manaus" },
                { src: "v1768962223/IMG_6027_ymbkko.jpg", caption: "Still lost in Manaus.", alt: "Still lost" },
                { src: "v1768962156/IMG_6032_rcjr8i.jpg", caption: "Lost some more.", alt: "Lost some more" }
            ],
            
            // RIO DE JANEIRO
            "rio": [
                { src: "v1768952763/IMG_6391_Large_kingel.jpg", caption: "The famous SelarÃ³n Steps - a mosaic tribute to Rio.", alt: "SelarÃ³n Steps" },
                { src: "v1768952612/IMG_6283_kikfgu.jpg", caption: "Made it to the top - Cristo Redentor.", alt: "Derrick at Christ the Redeemer" },
                { src: "v1768953058/IMG_6305_qqetec.jpg", caption: "The view from Corcovado.", alt: "View from Christ the Redeemer" },
                { src: "v1768952929/IMG_6333_gg6lzs.jpg", caption: "Heading into the heart of the favela.", alt: "Entering the favela" },
                { src: "v1768953014/IMG_6331_kvzk2o.jpg", caption: "Life in the favela.", alt: "Favela street scene" },
                { src: "v1768952486/IMG_6346_lcg34g.jpg", caption: "Taking a break with a popsicle.", alt: "Popsicle in favela" },
                { src: "v1768952860/IMG_6350_kjpilj.jpg", caption: "Another favela tour moment.", alt: "Favela tour" },
                { src: "v1768953816/IMG_6366_h1ih0q.jpg", caption: "Copacabana Beach - where the chaos finally stops.", alt: "Copacabana Beach" }
            ],
            
            // PHUKET
            "phuket": [
                { src: "w_400,q_auto,f_auto/v1768865557/PANO_20131118_134025_qd3r7o.jpg", caption: "Phuket beach panorama.", alt: "Beach panorama" },
                { src: "w_400,q_auto,f_auto/v1768865640/IMG_20131113_105615_yzzp1y.jpg", caption: "Temple gate in Phuket.", alt: "Temple gate" },
                { src: "w_400,q_auto,f_auto/v1768865556/IMG_20131118_135639_wcs0ae.jpg", caption: "Fresh fruit cart - Phuket streets.", alt: "Fruit cart" },
                { src: "w_400,q_auto,f_auto/v1768865556/IMG_20131118_164928_wge65r.jpg", caption: "Patong Beach entrance at evening.", alt: "Patong Beach" },
                { src: "w_400,q_auto,f_auto/v1768865557/PANO_20131118_182257_b9tvli.jpg", caption: "Sunset over Phuket.", alt: "Sunset panorama" },
                { src: "w_400,q_auto,f_auto/v1768865679/IMG_20131118_184137_1_toim78.jpg", caption: "Making friends with the local wildlife.", alt: "Derrick with iguana" },
                { src: "w_400,q_auto,f_auto/v1768866121/IMG_19700105_041151_dliaia.jpg", caption: "Martin and Yolonda - Martin found me and helped me get back to the ship.", alt: "Martin and Yolonda" },
                { src: "w_400,q_auto,f_auto/v1768865556/IMG_20131118_184140_zmbgko.jpg", caption: "Another day in paradise.", alt: "Phuket closing" }
            ],
            
            // SYDNEY (placeholder for Pacific Jewel maiden voyage)
            "sydney": [
                // Add photos here when ready
            ],
            
            // DARWIN - Crew Friends & Shiplife Moments
            "darwin": [
                { src: "v1768532646/IMG_0369_2020-10-19T20_30_13.806_ih39fd.jpg", caption: "Me and Dion.", alt: "Derrick and Dion" },
                { src: "v1768587330/IMG_2599_p9nrgz.jpg", caption: "Crew night out in Dubrovnik.", alt: "Crew night out Dubrovnik" },
                { src: "v1768866121/IMG_19700105_041151_dliaia.jpg", caption: "Martin and Yolonda - the best shipmates you could ask for.", alt: "Martin and Yolonda" },
                { src: "v1768951579/Screenshot_20260120_140051_Facebook_dvdyxx.jpg", caption: "Me and Daryl.", alt: "Derrick and Daryl" },
                { src: "v1768951579/Screenshot_20260120_135912_Facebook_ngnddd.jpg", caption: "My birthday party on the maiden voyage of the Pacific Eden.", alt: "Birthday party Pacific Eden" },
                { src: "v1768951592/Screenshot_20260120_135059_Facebook_dtukc0.jpg", caption: "Pacific Sun crew bar days.", alt: "Pac Sun crew bar" },
                { src: "v1768951592/Screenshot_20260120_135432_Facebook_orvrzt.jpg", caption: "Shipmates.", alt: "Shipmates" },
                { src: "v1768951593/Screenshot_20260120_134832_Facebook_qzqv7m.jpg", caption: "Party in my huge officer cabin on Deck 12 of the Pacific Pearl (2nd contract).", alt: "Officer cabin party Pacific Pearl" }
            ],
        };
        
        // Generate gallery HTML for a location
        function generateGallery(locationId, customTitle = "More Photos") {
            const photos = locationGalleries[locationId];
            if (!photos || photos.length === 0) return '';
            
            const cloudinaryBase = "https://res.cloudinary.com/de5jbyhxx/image/upload";
            
            let galleryHTML = `
                <div class="photo-gallery-section" id="${locationId}Gallery">
                    <div class="gallery-header" onclick="this.parentElement.classList.toggle('expanded')">
                        <span class="gallery-title">
                            <span class="gallery-icon">ðŸ“¸</span>
                            <span>${customTitle}</span>
                            <span class="gallery-count">${photos.length} images</span>
                        </span>
                        <span class="gallery-toggle">â–¼</span>
                    </div>
                    <div class="gallery-grid">`;
            
            photos.forEach(photo => {
                galleryHTML += `
                        <img src="${cloudinaryBase}/${photo.src}" class="gallery-thumb" data-caption="${photo.caption}" alt="${photo.alt}">`;
            });
            
            galleryHTML += `
                    </div>
                </div>`;
            
            return galleryHTML;
        }
        
        // ============================================
        // END GALLERY SYSTEM
        // ============================================

        // Location data
        const locations = [
            {
                id: 1,
                title: "Toledo, Ohio",
                coords: [41.6528, -83.5379],
                tag: "Door #1: Escape",
                icon: "ðŸšª",
                iconType: "door",
                iconSymbol: "steel-door",
                isDoor: true,
                shortDesc: "The cubicle wanted spreadsheets. I wanted music.",
                imagePosition: "center",
                imageCaption: "1983. Brothers of Badness playing our high school prom in Cuyahoga Falls.",
                useRichContent: true,
                richContent: `
                    <div class="demographics-strip">
                        <div class="demo-item">
                            <span class="demo-icon">ðŸ‘¥</span>
                            <span class="demo-value">265,638</span>
                        </div>
                        <div class="demo-item">
                            <span class="demo-icon">ðŸ“</span>
                            <span class="demo-value">NW Ohio</span>
                        </div>
                        <div class="demo-item">
                            <span class="demo-icon">ðŸ­</span>
                            <span class="demo-value">Glass City</span>
                        </div>
                        <div class="demo-item">
                            <span class="demo-icon">ðŸ“…</span>
                            <span class="demo-value">Est. 1833</span>
                        </div>
                    </div>
                    
                    <div class="story-section-panel">
                        <h3 class="section-title-panel">The Doghouse</h3>
                        <p>My mom would tell you I was singing before I could talk.</p>
                        <p>If you wanted to find me as a kid, all you had to do was listen. If I wasn't banging on a drum set, I was playing clarinet, or guitar, or singing for anyone who would listen. My mom, my grandma, my brother and sister. My great-grandma Gillette would hoist me up onto the doghouse and I would sing the Star Spangled Banner for her, pretending the apples on the trees around us were my audience.</p>
                        <p>I made up songs. I sang harmony with the radio. I daydreamed constantly, and it got me into a lot of trouble.</p>
                        <p>At age 7, when other kids were playing with Legos, I began playing my dad's Jazzmaster guitar.</p>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1767713693/9_yr_jazzmaster_square_r8uajm.jpg" class="story-image" data-caption="Eight years old with my dad's Jazzmaster." alt="Age 8 with dad's Jazzmaster">
                        <p class="photo-caption-inline">Eight years old with my dad's Jazzmaster.</p>
                        <p>By thirteen, I had my first real band. We called ourselves 5th Avenue, and we played anywhere that would have us - including the Stony Ridge Fair, right in the small town where I grew up.</p>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768520944/1000006615_kjgr2e.jpg" class="story-image" data-caption="Age 13. My first band, 5th Avenue, playing the Stony Ridge Fair." alt="5th Avenue at Stony Ridge Fair">
                        <p class="photo-caption-inline">Age 13. My first band, 5th Avenue, playing the Stony Ridge Fair.</p>
                        <p>When I wasn't lost in music, I'd disappear for hours into the woods, walking the train tracks that ran behind our house, exploring my small world. I imagined I could just keep walking until I'd seen all of it.</p>
                        <p>That would have to wait a few years.</p>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">The Band</span>
                        <h3 class="section-title-panel">Touched</h3>
                        <p>In 1989, I joined a band called Touched. We were hungry, and we were good. Through the early '90s we played high-end nightclubs and hotels to a few very questionable dive bars where I feel I narrowly escaped certain death a few times. The east coast was our circuit - Maine to Florida.</p>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768521382/1000006616_gt9tju.jpg" class="story-image" data-caption="Touched, 1991. That's me upper left with my dearest friends - Dave Gierke, Kevin Korecki, Phil Berg, Susan Korecki, Jill, and CJ." alt="The band Touched, 1991">
                        <p class="photo-caption-inline">Touched, 1991. That's me upper left with my dearest friends - Dave Gierke, Kevin Korecki, Phil Berg, Susan Korecki, Jill, and CJ.</p>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768520944/1000006613_as1tu6.jpg" class="story-image" data-caption="Touched at the 5 Seasons Hotel, Greensboro, NC. 1991." alt="Touched performing in Greensboro NC, 1991">
                        <p class="photo-caption-inline">Touched at the 5 Seasons Hotel, Greensboro, NC. 1991.</p>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">The Double Life</span>
                        <h3 class="section-title-panel">Fourteen Years</h3>
                        <p>A few years in, the bills started piling up. I needed a steady paycheck, so I got a day job. Customer service. Nothing glamorous, but it paid the rent.</p>
                        <p>The thing is - I never stopped playing. I was still gigging with Touched on nights and weekends, still playing around Toledo well into the 2000s. Music never stopped. It just... became the side hustle.</p>
                        <p>At first, the day job felt like a reasonable compromise. Stay home, pay the bills, play music when I could. But one year became five. Five became ten. Then I found myself in a credit collections department for an elevator company, screaming at people on the phone for a living.</p>
                        <p>After almost fourteen years of punching a clock, I looked around and realized something:</p>
                        <blockquote class="story-quote">I was wasting my time.</blockquote>
                        <p>The day job wasn't supporting my music career. It was slowly replacing it. And if I didn't do something about it, I'd spend the rest of my life in that cubicle.</p>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">The Spark</span>
                        <h3 class="section-title-panel">Visualizing the Escape</h3>
                        <p>In 2005, I worked up a few sets of guitar-vocal songs and played my first solo gig in years. It was a good start, but I had a ways to go. If I wanted to escape Toledo and make a living playing music - really make a living - I needed to be prepared.</p>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1767710239/vlcsnap-2026-01-06-08h32m21s251_aqec7t.png" class="story-image" data-caption="2005. The first solo gig in years. The spark." alt="First solo gig">
                        <p class="photo-caption-inline">2005. The first solo gig in years. The spark.</p>
                        <p>The most important thing I did was to begin to visualize where music could take me again. I started a scrapbook of exotic places and tried to imagine myself playing in grand hotels. Or cruise ships.</p>
                        <p>Then one night, late, I started searching for solo guitar gigs. Landed on a British talent website and found an ad that read something like:</p>
                        <blockquote class="story-quote">Vocalist/Guitarist wanted for employment opportunity on cruise ship.</blockquote>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">Door #1</span>
                        <h3 class="section-title-panel">The Escape</h3>
                        <p>Walking through the first door was the hardest thing I had ever done. I left everything behind. Everything I owned was shoved into a storage space and I left Toledo on July 6th, 2009.</p>
                        <blockquote class="story-quote final-quote">The lock fell away from Door #1 and opened to the possibility of everything that came after.</blockquote>
                    </div>
                    
                    <div class="more-info-container" onclick="this.classList.toggle('active')">
                        <button class="more-info-btn">
                            <span class="info-icon">ðŸ’¡</span>
                            <span>More about this location</span>
                        </button>
                        <div class="more-info-popup">
                            <div class="popup-title">
                                <span class="title-icon">ðŸ›ï¸</span>
                                <span>The Glass City</span>
                            </div>
                            <ul class="fun-facts-list">
                                <li><strong>Glass Capital:</strong> Toledo became the world's glass manufacturing hub when Edward Libbey moved his company here in 1888. The glass used in Apollo 11's mission was developed here.</li>
                                <li><strong>Jeep Heritage:</strong> The first Jeep was built in Toledo during WWII. The Wrangler and Gladiator are still made here today.</li>
                                <li><strong>Toledo War:</strong> In the 1830s, Ohio and Michigan nearly went to battle over Toledo. Michigan got the Upper Peninsula as a compromise.</li>
                                <li><strong>Tony Packo's:</strong> Made famous by Jamie Farr (Corporal Klinger) on M*A*S*H. Celebrities sign hot dog buns instead of guest books.</li>
                                <li><strong>Mud Hens:</strong> One of America's oldest minor league baseball teams (since 1896), also referenced on M*A*S*H.</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="photo-gallery-section" id="toledoGallery">
                        <div class="gallery-header" onclick="this.parentElement.classList.toggle('expanded')">
                            <span class="gallery-title">
                                <span class="gallery-icon">ðŸ“¸</span>
                                <span>More Photos</span>
                                <span class="gallery-count">7 images</span>
                            </span>
                            <span class="gallery-toggle">â–¼</span>
                        </div>
                        <div class="gallery-grid">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768520945/1000006610_rzhkon.jpg" class="gallery-thumb" data-caption="1983. Brothers of Badness playing our high school prom in Cuyahoga Falls." alt="Brothers of Badness 1983">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1767713693/9_yr_jazzmaster_square_r8uajm.jpg" class="gallery-thumb" data-caption="Eight years old with my dad's Jazzmaster." alt="Age 8 with Jazzmaster">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768520944/1000006615_kjgr2e.jpg" class="gallery-thumb" data-caption="Age 13. My first band, 5th Avenue, playing the Stony Ridge Fair." alt="5th Avenue">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768521382/1000006616_gt9tju.jpg" class="gallery-thumb" data-caption="Touched, 1991. That's me upper left with my dearest friends - Dave Gierke, Kevin Korecki, Phil Berg, Susan Korecki, Jill, and CJ." alt="Touched 1991">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768520944/1000006613_as1tu6.jpg" class="gallery-thumb" data-caption="Touched at the 5 Seasons Hotel, Greensboro, NC. 1991." alt="Greensboro 1991">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1767710239/vlcsnap-2026-01-06-08h32m21s251_aqec7t.png" class="gallery-thumb" data-caption="2005. The first solo gig in years. The spark." alt="First solo gig 2005">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1767710239/brothers_of_badness_waogg5.jpg" class="gallery-thumb" data-caption="Brothers of Badness - the early band days." alt="Brothers of Badness">
                        </div>
                    </div>
                `,
                fullDesc: "My mom would tell you I was singing before I could talk. If you wanted to find me as a kid, all you had to do was listen.\n\nI never stopped playing music. But after fourteen years of day jobs slowly replacing the dream, I realized I was wasting my time.\n\nThis was Door #1. The escape. This door opened the possibility of everything that came after.",
                image: "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768520945/1000006610_rzhkon.jpg"
            },
            {
                id: 21,
                title: "Brisbane, Australia",
                coords: [-27.4705, 153.0260],
                tag: "First Shore Leave",
                icon: "â˜€ï¸",
                isDoor: false,
                shortDesc: "First shore leave. The door stayed open.",
                fullDesc: "Brisbane was my first real port of call once we left Auckland. I had performed the previous two nights in the same club where the previous soloist had lasted exactly two days. I was told before I boarded that this is just how it was-so don't be shocked if things don't work out.\n\nI had prepared myself for a call from the cruise director's office saying \"Thanks, but no thanks\" as he handed me a plane ticket home.\n\nIt was an anxious morning. I remember having breakfast with a few random crewmates, thinking about my boss back home who said I could probably come back and work the phones for him if things didn't work out.\n\nBut eventually the crew was let off the ship. Myself included.\n\nI had my first shore leave.\n\nTurns out, this was my first of many shore leaves for the next 12 years of my life.\n\nThe door stayed open.",
                image: "https://images.unsplash.com/photo-1506973035872-a4ec16b8e8d9?w=1200"
            },
            {
                id: 22,
                title: "Darwin, Australia",
                coords: [-12.4634, 130.8456],
                tag: "Door #2: My First Contract",
                icon: "ðŸšª",
                isDoor: true,
                shortDesc: "If I could make it to Darwin, I could make it anywhere.",
                imagePosition: "center",
                imageCaption: "Somewhere in the first week - still figuring out the rhythm.",
                useRichContent: true,
                richContent: `
                    <div class="demographics-strip">
                        <div class="demo-item">
                            <span class="demo-icon">ðŸ‘¥</span>
                            <span class="demo-value">~150,000</span>
                        </div>
                        <div class="demo-item">
                            <span class="demo-icon">ðŸŒ</span>
                            <span class="demo-value">60+ Nationalities</span>
                        </div>
                        <div class="demo-item">
                            <span class="demo-icon">ðŸŽ‚</span>
                            <span class="demo-value">Youngest Capital</span>
                        </div>
                        <div class="demo-item">
                            <span class="demo-icon">ðŸ“</span>
                            <span class="demo-value">Northern Territory</span>
                        </div>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">The Proving Ground</span>
                        <h3 class="section-title-panel">The 14-Day Cruise</h3>
                        <p>I had two weeks. Two 7-day cruises. That was the industry standard - the unspoken trial period where the office watched to see if the new soloist would sink or swim. Past that 2-week window was a 14-day cruise to Darwin.</p>
                        <p>I knew that if I made it past that window, the home office would turn their attention to more pressing matters. You were left alone to succeed, fail, or burn out at your own pace.</p>
                        <p>I heard crew members whispering about the 14-day cruise to Darwin like it was a mystical place. Everyone was excited about an overnight stay. But to me, Darwin represented something else entirely.</p>
                        <p>If I could stay on and make it to Darwin without being handed a plane ticket home, I was good for at least my first 4-month contract. And who knows - maybe they would bring me back to do it again.</p>
                        <blockquote class="story-quote">I could make it anywhere if I could just get to Darwin.</blockquote>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1767645531/002_zzrowo.jpg" class="story-image" data-caption="Smugglers Lounge on the Pacific Sun - the proving ground." alt="Smugglers Lounge">
                        <p class="photo-caption-inline">Smugglers Lounge on the Pacific Sun - the proving ground.</p>
                        <p>Darwin marked the end of my probation. Five weeks into a four-month contract, we pulled into port and I realized something had shifted. The constant vigilance from management had eased. My name appeared in the daily entertainment schedule without revision.</p>
                        <blockquote class="story-quote">Pre Show Entertainment with the acoustic sounds of our Solo Guitarist - Derrick Hudson. Show Times: 7:30PM & 9:30PM.</blockquote>
                        <div class="story-gallery-grid">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1767645530/atlantis_brochure_kmknn5.jpg" class="story-image" data-caption="The Atlantis entertainment brochure - my name in print." alt="Atlantis entertainment brochure">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1767645531/577727_2891241418592_422943946_n_ffy5nv.jpg" class="story-image" data-caption="Soundcheck at the Atlantis Lounge before the doors opened." alt="Soundcheck at the Atlantis Lounge">
                        </div>
                        <p class="photo-caption-inline">The Atlantis Showlounge - my name in print, and the view from soundcheck before the doors opened.</p>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">Orientation Day</span>
                        <h3 class="section-title-panel">
                            A Life in Motion
                            <span class="directors-commentary">
                                <span class="commentary-trigger" onclick="openCommentaryModal()" title="A Quick Story...">
                                    <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768678993/ComfyUI_01292__jp0pvj.png" alt="Captain">
                                </span>
                                <svg class="click-me-text" viewBox="0 0 100 100">
                                    <defs>
                                        <path id="circlePath" d="M 50,50 m -38,0 a 38,38 0 1,1 76,0 a 38,38 0 1,1 -76,0"/>
                                    </defs>
                                    <text>
                                        <textPath href="#circlePath" startOffset="0%">CLICK ME â€¢ CLICK ME â€¢</textPath>
                                    </text>
                                </svg>
                            </span>
                        </h3>
                        <p>On my first day aboard, during orientation, the staff captain told us straight:</p>
                        <blockquote class="story-quote">
                            "Ship life will fulfill you, drain you, or wreck you emotionally. You can tell a lot about a person based on how they conduct themselves aboard a ship."
                            <cite>- Staff Captain, Pacific Sun</cite>
                        </blockquote>
                        <p>I remember sitting there thinking - am I ready for this? Am I ready to become the best version of myself? Because that's what this is going to take.</p>
                        <p>Those first weeks were a blur. Learning the sets, the venues, the politics of ship entertainment. Learning the rhythm of a life in motion. You wake up in one country. Perform in another. Sleep somewhere in between.</p>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768526570/IMG_0109_dvahoj.jpg" class="story-image" data-caption="Pacific Sun docked in New Caledonia." alt="Pacific Sun in New Caledonia">
                        <p class="photo-caption-inline">Pacific Sun docked in New Caledonia.</p>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">Shore Leave</span>
                        <h3 class="section-title-panel">The Pacific Run</h3>
                        <p>The Pacific run took us through places I'd only seen in documentaries. Turquoise water so clear you could count fish from the tender. Churches older than any building I'd ever entered. Islands where time moved differently.</p>
                        <div class="story-gallery-grid">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768526487/Isle_of_Pines_tddsqy.jpg" class="story-image" data-caption="Isle of Pines, New Caledonia." alt="Isle of Pines">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768526493/134_cwcuy0.jpg" class="story-image" data-caption="Pool party in Bali." alt="Pool party in Bali">
                        </div>
                        <p class="photo-caption-inline">Isle of Pines, New Caledonia. Pool party in Bali.</p>
                        <div class="story-gallery-grid">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768526496/bora_bora_z03zsr.jpg" class="story-image" data-caption="Bora Bora, French Polynesia." alt="Bora Bora">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768527359/DSC00357_et8mzd.jpg" class="story-image" data-caption="Semarang temple, Indonesia." alt="Semarang temple">
                        </div>
                        <p class="photo-caption-inline">Bora Bora, French Polynesia. Semarang temple, Indonesia.</p>
                        <div class="story-gallery-grid">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1767645531/darwin_star_jseq6c.jpg" class="story-image" data-caption="The Star Picture Theatre in Darwin." alt="Darwin Star Picture Theatre">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1767645531/DSC00286_ikuq8x.jpg" class="story-image" data-caption="Brisbane lit up at night." alt="Brisbane at night">
                        </div>
                        <p class="photo-caption-inline">The Star Picture Theatre in Darwin, and Brisbane lit up at night.</p>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">Shipmates</span>
                        <h3 class="section-title-panel">Witnesses to the Strange</h3>
                        <p>They weren't just colleagues. They were professionals, as dedicated to their work as I was to mine. But more than that, we were all witnesses to this strange experience we'd signed on to.</p>
                        <p>There was humor and irony in every story told at sea. It just happened that way - so many people from such different places, bumping into each other's unfamiliar ways.</p>
                        <div class="story-gallery-grid">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768530243/Screen_Shot_2026-01-15_at_9.24.29_PM_tlievd.png" class="story-image" data-caption="Goofing off in crew bar with shipmates." alt="Goofing off in crew bar">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768528418/crew_bar_urzrll.jpg" class="story-image" data-caption="Goofing off in crew bar with shipmates." alt="Goofing off in crew bar">
                        </div>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768528676/Screen_Shot_2026-01-15_at_8.58.48_PM_gtsbkw.png" class="story-image" data-caption="Goofing off in crew bar with shipmates." alt="Goofing off in crew bar">
                        <p class="photo-caption-inline">Goofing off in crew bar with shipmates.</p>
                        <div class="story-gallery-grid">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768531847/008-3_zkgv14.jpg" class="story-image" data-caption="Aussie passengers know how to party." alt="Aussie passengers know how to party">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768531863/011-6_t1i6uf.jpg" class="story-image" data-caption="Aussie passengers know how to party." alt="Aussie passengers know how to party">
                        </div>
                        <p class="photo-caption-inline">Aussie passengers know how to party.</p>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">The Stage</span>
                        <h3 class="section-title-panel">Playing With Friends</h3>
                        <p>Some of the best nights were when I got to share the stage. My good friend Hayden Smith would jump in with me at Smugglers Lounge and the Atlantis Lounge. Lars too. Those were the gigs that reminded me why I was here.</p>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768528859/Screen_Shot_2026-01-15_at_9.01.50_PM_buvpyi.png" class="story-image" data-caption="Playing with my friend Hayden Smith in Smugglers Lounge." alt="Playing with Hayden Smith">
                        <p class="photo-caption-inline">Playing with my friend Hayden Smith in Smugglers Lounge.</p>
                        <div class="story-gallery-grid">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768528813/Screen_Shot_2026-01-15_at_9.00.59_PM_i6usqj.png" class="story-image" data-caption="Hayden and I performing in Atlantis Lounge." alt="Hayden and I in Atlantis">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768528773/Screen_Shot_2026-01-15_at_9.00.21_PM_ood4z7.png" class="story-image" data-caption="Hayden and I performing in Atlantis Lounge." alt="Hayden and I in Atlantis">
                        </div>
                        <p class="photo-caption-inline">Hayden and I performing in Atlantis Lounge.</p>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768528580/Screen_Shot_2026-01-15_at_8.57.09_PM_eibhfs.png" class="story-image" data-caption="Playing with my friend Lars in Smugglers Lounge." alt="Playing with Lars">
                        <p class="photo-caption-inline">Playing with my friend Lars in Smugglers Lounge.</p>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">Ship Celebrity</span>
                        <h3 class="section-title-panel">Cruise Director's Corner</h3>
                        <p>One day the cruise director invited me onto his daily TV show - broadcast to every cabin on the ship. I sat down, feeling pretty good about myself.</p>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768530105/Screen_Shot_2026-01-15_at_9.20.01_PM_yujfq8.png" class="story-image" data-caption="Cruise Director's Corner. Cool, calm, collected." alt="TV show relaxed">
                        <p class="photo-caption-inline">Cool. Calm. Collected.</p>
                        <p>Then I realized 2,000 passengers were watching me live and I completely forgot how humans sit.</p>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768530034/Screen_Shot_2026-01-15_at_9.21.22_PM_kazerc.png" class="story-image" data-caption="Cruise Director's Corner. Where do hands go? What are hands? Why do I have hands?" alt="TV show nervous">
                        <p class="photo-caption-inline">Where do hands go? What are hands? Why do I have hands?</p>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">Door #2</span>
                        <h3 class="section-title-panel">The Door That Opened Everything</h3>
                        <p>Darwin was the door that opened onto my future. From there, it was only a matter of time before the entire world opened up.</p>
                    </div>
                    
                    ${generateGallery('darwin', 'Crew Friends & Shiplife Moments')}
                    
                    <div class="more-info-container" onclick="this.classList.toggle('active')">
                        <button class="more-info-btn">
                            <span class="info-icon">ðŸ’¡</span>
                            <span>More about this location</span>
                        </button>
                        <div class="more-info-popup">
                            <div class="popup-title">
                                <span class="title-icon">ðŸ¦˜</span>
                                <span>Australia's Top End</span>
                            </div>
                            <ul class="fun-facts-list">
                                <li><strong>Named After Darwin:</strong> The city was named after Charles Darwin, who sailed into the harbor aboard HMS Beagle in 1839.</li>
                                <li><strong>WWII Bombing:</strong> Darwin was bombed 64 times during WWII - more than Pearl Harbor. The first attack killed 235 people.</li>
                                <li><strong>Beer Can Regatta:</strong> Every year Darwin hosts a regatta where boats must be made entirely of beer cans. Very Darwin.</li>
                                <li><strong>Closer to Bali:</strong> Darwin is closer to Bali, Indonesia than it is to Sydney. It's Australia's gateway to Asia.</li>
                                <li><strong>Youngest Capital:</strong> With a median age of 34.6, Darwin is Australia's youngest capital city.</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="photo-gallery-section" id="darwinGallery">
                        <div class="gallery-header" onclick="this.parentElement.classList.toggle('expanded')">
                            <span class="gallery-title">
                                <span class="gallery-icon">ðŸ“¸</span>
                                <span>More Photos</span>
                                <span class="gallery-count">34 images</span>
                            </span>
                            <span class="gallery-toggle">â–¼</span>
                        </div>
                        <div class="gallery-grid">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1767645531/002_zzrowo.jpg" class="gallery-thumb" data-caption="Smugglers Lounge on the Pacific Sun - the proving ground." alt="Smugglers Lounge">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1767645530/atlantis_brochure_kmknn5.jpg" class="gallery-thumb" data-caption="The Atlantis entertainment brochure - my name in print." alt="Atlantis brochure">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1767645531/577727_2891241418592_422943946_n_ffy5nv.jpg" class="gallery-thumb" data-caption="Soundcheck at the Atlantis Lounge before the doors opened." alt="Atlantis soundcheck">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768526570/IMG_0109_dvahoj.jpg" class="gallery-thumb" data-caption="Pacific Sun docked in New Caledonia." alt="Pacific Sun New Caledonia">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768526487/Isle_of_Pines_tddsqy.jpg" class="gallery-thumb" data-caption="Isle of Pines, New Caledonia." alt="Isle of Pines">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768526493/134_cwcuy0.jpg" class="gallery-thumb" data-caption="Pool party in Bali." alt="Bali pool party">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768526496/bora_bora_z03zsr.jpg" class="gallery-thumb" data-caption="Bora Bora, French Polynesia." alt="Bora Bora">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768527359/DSC00357_et8mzd.jpg" class="gallery-thumb" data-caption="Semarang temple, Indonesia." alt="Semarang temple">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1767645531/darwin_star_jseq6c.jpg" class="gallery-thumb" data-caption="The Star Picture Theatre in Darwin." alt="Darwin Star">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1767645531/DSC00286_ikuq8x.jpg" class="gallery-thumb" data-caption="Brisbane lit up at night." alt="Brisbane">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768530243/Screen_Shot_2026-01-15_at_9.24.29_PM_tlievd.png" class="gallery-thumb" data-caption="Goofing off in crew bar with shipmates." alt="Goofing off crew bar">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768528418/crew_bar_urzrll.jpg" class="gallery-thumb" data-caption="Goofing off in crew bar with shipmates." alt="Goofing off crew bar">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768528676/Screen_Shot_2026-01-15_at_8.58.48_PM_gtsbkw.png" class="gallery-thumb" data-caption="Goofing off in crew bar with shipmates." alt="Goofing off crew bar">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768531847/008-3_zkgv14.jpg" class="gallery-thumb" data-caption="Aussie passengers know how to party." alt="Aussie passengers">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768531863/011-6_t1i6uf.jpg" class="gallery-thumb" data-caption="Aussie passengers know how to party." alt="Aussie passengers">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768526483/mark_cristian_iwhziq.jpg" class="gallery-thumb" data-caption="The crew bar - where the real stories got told. With friends." alt="Crew bar friends">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768528859/Screen_Shot_2026-01-15_at_9.01.50_PM_buvpyi.png" class="gallery-thumb" data-caption="Playing with my friend Hayden Smith in Smugglers Lounge." alt="Hayden Smith">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768528813/Screen_Shot_2026-01-15_at_9.00.59_PM_i6usqj.png" class="gallery-thumb" data-caption="Hayden and I performing in Atlantis Lounge." alt="Hayden Atlantis">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768528773/Screen_Shot_2026-01-15_at_9.00.21_PM_ood4z7.png" class="gallery-thumb" data-caption="Hayden and I performing in Atlantis Lounge." alt="Hayden Atlantis 2">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768528580/Screen_Shot_2026-01-15_at_8.57.09_PM_eibhfs.png" class="gallery-thumb" data-caption="Playing with my friend Lars in Smugglers Lounge." alt="Lars">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768530105/Screen_Shot_2026-01-15_at_9.20.01_PM_yujfq8.png" class="gallery-thumb" data-caption="Cruise Director's Corner. Cool, calm, collected." alt="TV show relaxed">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768530034/Screen_Shot_2026-01-15_at_9.21.22_PM_kazerc.png" class="gallery-thumb" data-caption="Cruise Director's Corner. Where do hands go? What are hands? Why do I have hands?" alt="TV show nervous">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768527425/IMG_0200_lgitre.jpg" class="gallery-thumb" data-caption="Shipmates." alt="Shipmates">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768527430/IMG_0198_v6fil7.jpg" class="gallery-thumb" data-caption="Crew sign." alt="Crew sign">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1767643122/013_pzswfa.jpg" class="gallery-thumb" data-caption="Somewhere in the first week - still figuring out the rhythm." alt="First week">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768532411/037_sgoss3.jpg" class="gallery-thumb" data-caption="Pacific Sun days." alt="Pacific Sun">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768532320/SANY2959_wrkayt.jpg" class="gallery-thumb" data-caption="Shore leave." alt="Shore leave">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768532586/IMG_0503_d8y8ux.jpg" class="gallery-thumb" data-caption="More adventures." alt="Adventures">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768532591/IMG_0505_u3ofup.jpg" class="gallery-thumb" data-caption="On the road." alt="On the road">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768532608/IMG_0375_2020-10-19T20_30_15.551_ng52kh.jpg" class="gallery-thumb" data-caption="Exploring." alt="Exploring">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768532638/IMG_0390_2020-10-19T20_30_25.484_lmm8za.jpg" class="gallery-thumb" data-caption="Crew adventures." alt="Crew adventures">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768532646/IMG_0369_2020-10-19T20_30_13.806_ih39fd.jpg" class="gallery-thumb" data-caption="More memories." alt="Memories">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768529189/Screen_Shot_2026-01-15_at_9.07.19_PM_cqqwpq.png" class="gallery-thumb" data-caption="Ship life." alt="Ship life">
                        </div>
                    </div>
                `,
                fullDesc: "I heard crew members whispering about the 14-day cruise to Darwin like it was a mystical place. To me, Darwin represented something else entirely: if I could make it there, I would be staying onboard for a full contract.\n\nDarwin was the door that opened onto my future. From there, it was only a matter of time before the entire world opened up.",
                image: "https://res.cloudinary.com/de5jbyhxx/image/upload/v1767643122/013_pzswfa.jpg"
            },
            {
                id: 4,
                title: "Auckland, New Zealand",
                coords: [-36.8509, 174.7645],
                tag: "Door #3: Full Circle",
                icon: "ðŸšª",
                isDoor: true,
                shortDesc: "2013: Joining the ship I once only dreamed about.",
                imagePosition: "center",
                imageCaption: "Seabourn Quest in Antarctica.",
                useRichContent: true,
                richContent: `
                    <div class="story-section-panel">
                        <span class="section-tag-panel">A Brief Digression</span>
                        <h3 class="section-title-panel">Before We Continue...</h3>
                        <p>Before we go any further into the story, I must digress.</p>
                        <p>We need to go back to 2009 - my first ship contract.</p>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">Seeing My Future</span>
                        <h3 class="section-title-panel">Cairns, 2009</h3>
                        <p>Riding bikes with shipmates. A white ship in the harbor.</p>
                        <p>Someone said, "That's Seabourn. Top cruise line in the world."</p>
                        <p>I watched it for a while. Got a little closer and snapped a photo.</p>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1767729026/IMG_0220_r8svvx.jpg" class="story-image" alt="Seabourn Odyssey in Cairns">
                        <p class="photo-caption-inline">The Seabourn Odyssey in Cairns. I was on the Pacific Sun, already dreaming about this strange, elegant ship in front of me.</p>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">Three Fun-Filled, Island-Hopping Years Later...</span>
                        <h3 class="section-title-panel">Akaroa, New Zealand. November 2012.</h3>
                        <p>A note slipped under my door.</p>
                        <blockquote class="story-quote">Please contact your agent when ashore.</blockquote>
                        <p>I made the call standing on the dock. C. Blackburn - the same agent who got me my first ship - delivered the news.</p>
                        <p>I had been offered a position on the very same ship I had seen in Cairns three years earlier. I was going to be working for Seabourn as a solo guitarist/vocalist!</p>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1767729047/IMG_0830_pv7td9.jpg" class="story-image" alt="Akaroa Harbor">
                        <p class="photo-caption-inline">Akaroa Harbor. The moment everything changed.</p>
                        <p>An hour later I was eating oysters with my shipmates. Gagging. Laughing. Trying not to throw up.</p>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768532532/IMG_0833_dul2vl.jpg" class="story-image" alt="Eating oysters">
                        <p class="photo-caption-inline">Oysters with shipmates. Not my finest moment.</p>
                        <p>The door had just slid open.</p>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">The Rest of It</span>
                        <h3 class="section-title-panel">A Different Universe</h3>
                        <p>The first two doors I had to push open myself.</p>
                        <p>This one just... opened.</p>
                        <p>P&O gave me the Pacific. Four years of Australia, New Zealand, Fiji, Tahiti, Papua New Guinea. I thought I'd seen the world.</p>
                        <blockquote class="story-quote">Seabourn gave me the rest of it.</blockquote>
                        <p>Three vessels. Four years. Odyssey. Sojourn. Quest. 60+ countries.</p>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">Embarkation</span>
                        <h3 class="section-title-panel">Auckland, January 2013</h3>
                        <p>Same port where I boarded my first P&O ship in 2009.</p>
                        <p>Same gangway. Different universe.</p>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1767732747/IMG_0159_nx39vl.jpg" class="story-image" alt="Auckland Harbor from Seabourn">
                        <p class="photo-caption-inline">Auckland Harbor from the Odyssey. Pulling away from where it all started.</p>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1767729034/IMG_0169_nnzkhu.jpg" class="story-image" alt="Leaving Auckland">
                        <p class="photo-caption-inline">Sky Tower fading behind us. A new chapter beginning.</p>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">The Seabourn Experience</span>
                        <h3 class="section-title-panel">Not Your Average Cruise Ship</h3>
                        <div class="story-gallery-grid">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1767729030/IMG_0202_igk8i4.jpg" class="story-image" alt="Seabourn funnel">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1767733813/IMG_0218_azftb2.jpg" class="story-image" alt="The Club">
                        </div>
                        <p class="photo-caption-inline">The iconic Seabourn funnel. The Club on Deck 5 - my new stage.</p>
                        <div class="story-gallery-grid">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1767728099/IMG_0201_jrd2av.jpg" class="story-image" alt="Seabourn schedule">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1767727964/Screen_Shot_2026-01-06_at_2.33.27_PM_v6kw7e.png" class="story-image" alt="Derrick at the piano">
                        </div>
                        <p class="photo-caption-inline">Saturday, March 2, 2013. My name in print on Seabourn. And yes, they always put me by the food.</p>
                        <p>Seabourn ships are more like huge luxury yachts than cruise ships. The guests were amazing. Doctors. Lawyers. Dignitaries. CEOs. Experts in horticulture, ancient history, penguins - you name it.</p>
                        <p>And the crew knew how to party.</p>
                        <p>Everyone was friendly. Everyone was professional.</p>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">Door #3</span>
                        <h3 class="section-title-panel">The Entire Globe</h3>
                        <p>Door #3 opened to the entire world.</p>
                        <p>I had sat in my little yellow house back in Toledo and, by sheer force of will, conjured a dream into reality.</p>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">The World</span>
                        <h3 class="section-title-panel">Seabourn Gave Me the Rest of It</h3>
                        <div class="world-carousel" id="worldCarousel">
                            <div class="carousel-slide active">
                                <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1767734543/IMG_3093_p55z1r.jpg" alt="Milos, Greece">
                                <div class="carousel-caption"><span>Milos, Greece</span></div>
                            </div>
                            <div class="carousel-slide">
                                <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1767737978/IMG_6712_bmwcxi.jpg" alt="Lemaire Channel, Antarctica">
                                <div class="carousel-caption"><span>Lemaire Channel, Antarctica</span></div>
                            </div>
                            <div class="carousel-slide">
                                <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1767739780/IMG_6538_tolutk.jpg" alt="Antarctica">
                                <div class="carousel-caption"><span>Antarctica</span></div>
                            </div>
                            <div class="carousel-slide">
                                <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1767738529/IMG_5536_ipjhwy.jpg" alt="St. Tropez">
                                <div class="carousel-caption"><span>St. Tropez</span></div>
                            </div>
                            <div class="carousel-slide">
                                <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1767736180/IMG_0914_u5kskn.jpg" alt="Mumbai">
                                <div class="carousel-caption"><span>Mumbai</span></div>
                            </div>
                            <div class="carousel-slide">
                                <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1767735553/IMG_1717_ggcmyu.jpg" alt="Kotor, Montenegro">
                                <div class="carousel-caption"><span>Kotor, Montenegro</span></div>
                            </div>
                            <div class="carousel-slide">
                                <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1767737741/IMG_6834_ytmj8n.jpg" alt="South Georgia">
                                <div class="carousel-caption"><span>South Georgia</span></div>
                            </div>
                            <div class="carousel-slide">
                                <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1767738680/IMG_20140610_113551_fvskrb.jpg" alt="Ibiza, Spain">
                                <div class="carousel-caption"><span>Ibiza, Spain</span></div>
                            </div>
                            <div class="carousel-slide">
                                <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1767735952/IMG_0854_wmukmp.jpg" alt="Tel Aviv">
                                <div class="carousel-caption"><span>Tel Aviv</span></div>
                            </div>
                            <div class="carousel-slide">
                                <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1767736004/IMG_0687_znjvkv.jpg" alt="Egypt">
                                <div class="carousel-caption"><span>Egypt</span></div>
                            </div>
                            <div class="carousel-slide">
                                <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1767738205/IMG_6691_g9fekn.jpg" alt="Ushuaia, Argentina">
                                <div class="carousel-caption"><span>Ushuaia, Argentina</span></div>
                            </div>
                            <div class="carousel-slide">
                                <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1767734745/IMG_1778_fw5ihj.jpg" alt="Piran, Slovenia">
                                <div class="carousel-caption"><span>Piran, Slovenia</span></div>
                            </div>
                            <div class="carousel-slide">
                                <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1767738333/IMG_5961_m85dyt.jpg" alt="Salem, Massachusetts">
                                <div class="carousel-caption"><span>Salem, Massachusetts</span></div>
                            </div>
                            <div class="carousel-slide">
                                <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1767735863/IMG_1155_qtda7b.jpg" alt="Malta">
                                <div class="carousel-caption"><span>Malta</span></div>
                            </div>
                            <div class="carousel-slide">
                                <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1767738440/IMG_20140811_122138_cqwjid.jpg" alt="Barcelona, Spain">
                                <div class="carousel-caption"><span>Barcelona, Spain</span></div>
                            </div>
                            <div class="carousel-slide">
                                <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1767735639/IMG_1240_swdpx7.jpg" alt="Syracuse, Sicily">
                                <div class="carousel-caption"><span>Syracuse, Sicily</span></div>
                            </div>
                            <div class="carousel-slide">
                                <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768587596/IMG_1656_afip0q.jpg" alt="Seabourn Odyssey in Kotor, Montenegro">
                                <div class="carousel-caption"><span>Seabourn Odyssey in Kotor, Montenegro</span></div>
                            </div>
                            <div class="carousel-slide">
                                <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768587199/IMG_3004_uyulft.jpg" alt="Seabourn Odyssey in Nafplion, Greece">
                                <div class="carousel-caption"><span>Seabourn Odyssey in Nafplion, Greece</span></div>
                            </div>
                            <div class="carousel-slide">
                                <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1768587674/IMG_1278_urf1yi.jpg" alt="Seabourn Sojourn in Itea, Greece">
                                <div class="carousel-caption"><span>Seabourn Sojourn in Itea, Greece</span></div>
                            </div>
                            <div class="carousel-dots"></div>
                        </div>
                    </div>
                `,
                fullDesc: "The first two doors I had to push open myself. This one just... opened.\n\nP&O gave me the Pacific. Four years of Australia, New Zealand, Fiji, Tahiti, Papua New Guinea. I thought I'd seen the world.\n\nSeabourn gave me the rest of it.\n\nThree vessels. Four years. Odyssey. Sojourn. Quest. 60+ countries.",
                image: "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768586585/IMG_6563_ggigfv.jpg"
            },
            {
                id: 2,
                title: "Reithi Rah, Maldives",
                coords: [4.2925, 73.3670],
                tag: "Shark-Infested Paradise",
                icon: "ðŸ¦ˆ",
                isDoor: false,
                shortDesc: "A month as resident musician in an oligarch's playground.",
                fullDesc: "Ah...the Maldives. A shark-infested paradise.\n\nDaily walks through dense tropical forest. One day, the largest man I'd seen in my life came running towards me on the narrow path-one of the oligarchs' bodyguards. They were here for Christmas, and the island was flooded with them.\n\nReef sharks by the restaurant door. Millions bet on beach card games. At some point I had to stop myself from saying wow all the time.",
                image: "https://images.unsplash.com/photo-1514282401047-d79a71a590e8?w=1200"
            },
            {
                id: 3,
                title: "Queen Victoria (Cunard)",
                coords: [50.90, -1.40],
                tag: "Luxury & Grandeur",
                icon: "ðŸ‘‘",
                isDoor: false,
                shortDesc: "Queen's Room Vocalist with a 9-piece orchestra.",
                fullDesc: "In 2019, I accepted a prestigious position on the iconic Queen Victoria.\n\nThe Queen's Room was unlike anything I had experienced before. A grand ballroom where couples would waltz beneath crystal chandeliers while I performed with a nine-piece orchestra.\n\nThis was old-world elegance at sea-white gloves, formal attire, and the kind of sophistication that harked back to the golden age of ocean travel.",
                image: "https://images.unsplash.com/photo-1559599238-308793637427?w=1200"
            },
            {
                id: 116,
                title: "Amsterdam, Netherlands",
                coords: [52.38, 4.90],
                tag: "Canals & Culture",
                icon: "ðŸš²",
                isDoor: false,
                shortDesc: "Where bicycles rule and canals connect everything.",
                fullDesc: "Amsterdam is a city that flows.\n\nThe canals wind through centuries of history-gabled houses leaning into each other, houseboats lined up along the banks, bicycles everywhere. The museums are world-class, the brown cafÃ©s are cozy, and the city has a tolerance and openness that's refreshing.",
                image: ""
            },
            {
                id: 5,
                title: "Dubrovnik, Croatia",
                coords: [42.6507, 18.0944],
                tag: "Time Travel",
                icon: "ðŸ°",
                isDoor: false,
                shortDesc: "Stepping through ancient gates into the Middle Ages.",
                fullDesc: "I had heard it was a walled city. By the time we arrived, I had seen a fair share of ancient ruins along both shores of the Adriatic.\n\nBut nothing prepared me for walking through those gates and being transported back into the Middle Ages. It wasn't just the architecture-it was the feeling. As if centuries collapsed the moment I stepped through that stone archway.",
                image: "https://images.unsplash.com/photo-1555990538-1e6c3c10617e?w=1200"
            },
            {
                id: 6,
                title: "Bali, Indonesia",
                coords: [-8.4095, 115.1889],
                tag: "Temples & Jungles",
                icon: "ðŸ¥­",
                isDoor: false,
                shortDesc: "Spiritual awakenings and monkey forests.",
                fullDesc: "We did a 14-day cruise around the Indonesian archipelago on Seabourn.\n\nBali was somehow different from how I'd imagined it. More spiritual. The temples seemed to breathe. The rice terraces looked hand-painted. And the monkey forest was exactly as chaotic as promised.",
                image: "https://images.unsplash.com/photo-1537996194471-e657df975ab4?w=1200"
            },
            {
                id: 7,
                title: "Ushuaia, Argentina",
                coords: [-54.8019, -68.3030],
                tag: "End of the World",
                icon: "ðŸ—ºï¸",
                isDoor: false,
                shortDesc: "The southernmost city on Earth.",
                fullDesc: "At the end of the world, you reflect on how you got here.\n\nUshuaia is dramatic in every sense-the jagged mountains, the fierce winds, the knowledge that Antarctica lies just beyond the horizon. We stayed here overnight, which is rare. I walked the streets feeling like an explorer at the edge of a map.\n\nI saw passionately-worded signs about the Falkland Islands-'Las Malvinas Son Argentinas.' Little did I know I'd be visiting those contested shores just days later.",
                image: "https://images.unsplash.com/photo-1551632811-561732d1e306?w=1200"
            },
            {
                id: 8,
                title: "Portofino, Italy",
                coords: [44.3046, 9.2094],
                tag: "Italian Riviera",
                icon: "ðŸš£",
                isDoor: false,
                shortDesc: "A postcard come to life.",
                fullDesc: "I've never seen such concentrated beauty in such a small space.\n\nPortofino is tiny-you can walk the entire town in 15 minutes. But every corner is a photograph. Pastel buildings, super-yachts in the harbor, and espresso that costs as much as a meal anywhere else.",
                image: "https://images.unsplash.com/photo-1516483638261-f4dbaf036963?w=1200"
            },
            {
                id: 9,
                title: "Ephesus, Turkey",
                coords: [37.9394, 27.3417],
                tag: "Ancient Echoes",
                icon: "ðŸ›ï¸",
                isDoor: false,
                shortDesc: "Walking where emperors walked.",
                fullDesc: "These ruins felt different.\n\nMaybe it was the scale-the Library of Celsus towering overhead. Or maybe it was knowing that this was once one of the largest cities in the Roman Empire. Either way, Ephesus made ancient history feel immediate.",
                image: "https://images.unsplash.com/photo-1524231757912-21f4fe3a7200?w=1200"
            },
            {
                id: 10,
                title: "Rome, Italy",
                coords: [41.9028, 12.4964],
                tag: "Colosseum Dreams",
                icon: "ðŸŸï¸",
                isDoor: false,
                shortDesc: "The eternal city never disappoints.",
                fullDesc: "Every time I visited Rome, I found something new.\n\nThe Colosseum at sunset. A hidden trattoria in Trastevere. The way the light hits the Spanish Steps in the early morning. Rome rewards those who explore.",
                image: "https://images.unsplash.com/photo-1552832230-c0197dd311b5?w=1200"
            },
            {
                id: 11,
                title: "Sydney, Australia",
                coords: [-33.8688, 151.2093],
                tag: "The Transformation",
                icon: "ðŸŽ¹",
                isDoor: false,
                shortDesc: "The guitarist who had to become a pianist. Overnight.",
                imagePosition: "center",
                imageCaption: "Darling Harbour, December 2009. The day before everything changed.",
                useRichContent: true,
                richContent: `
                    <div class="demographics-strip">
                        <div class="demo-item">
                            <span class="demo-icon">ðŸš¢</span>
                            <span class="demo-value">Pacific Jewel</span>
                        </div>
                        <div class="demo-item">
                            <span class="demo-icon">ðŸ“…</span>
                            <span class="demo-value">December 2009</span>
                        </div>
                        <div class="demo-item">
                            <span class="demo-icon">ðŸŽ¹</span>
                            <span class="demo-value">The Orient Bar</span>
                        </div>
                        <div class="demo-item">
                            <span class="demo-icon">ðŸŽ­</span>
                            <span class="demo-value">Inaugural Voyage</span>
                        </div>
                    </div>

                    <div class="story-section-panel">
                        <span class="section-tag-panel">The Call</span>
                        <h3 class="section-title-panel">"You Do Play Piano, Right?"</h3>
                        <p>My first contract on the Pacific Sun had ended. I was home for a month. Waiting.</p>
                        <p>During my last week at sea, I'd gotten word that P&O wanted me back. But nobody said which ship. Nobody said what I'd be doing.</p>
                        <p>Then the phone rang.</p>
                        <p>My agent. P&O wanted me in Singapore in four weeks. Dry dock. A "new" ship called the Pacific Jewel. But there was a catch.</p>
                        <p>They didn't want me as a guitarist.</p>
                        <p>They wanted me in something called "The Orient Bar."</p>
                        <p>At the piano.</p>
                        <blockquote class="story-quote">"You do play piano, right?"</blockquote>
                        <p>Well. Yeah. Kind of.</p>
                        <p>I'd worked a piano bar once. Back in 1984. I was 18. Didn't last the summer.</p>
                        <p>I play by ear. I knew I could get through all the Billy Joel and Elton John I'd ever need. But was I a <em>pianist</em>?</p>
                        <p>Not really.</p>
                        <p>Not yet.</p>
                    </div>

                    <div class="story-section-panel">
                        <span class="section-tag-panel">Singapore</span>
                        <h3 class="section-title-panel">The Construction Zone</h3>
                        <p>I boarded the Pacific Jewel with about a month left of dry dock.</p>
                        <p>The ship was not a ship. It was a construction site that happened to float.</p>
                        <div class="story-gallery-grid">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1769037282/058_yjvfcg.jpg" class="story-image" data-caption="Pacific Jewel in dry dock, Singapore." alt="Pacific Jewel in dry dock">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1769037276/102_ly7caf.jpg" class="story-image" data-caption="The Jewel getting her name - one of the last things they do before leaving dry dock." alt="Jewel getting its name">
                        </div>
                        <p class="photo-caption-inline">Pacific Jewel in dry dock. Workers everywhere. Scaffolding. Chaos. This was home now.</p>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1769031185/060_mhyxga.jpg" class="story-image" data-caption="The Orient Bar during dry dock. Under construction." alt="Orient Bar under construction">
                        <p class="photo-caption-inline">The Orient Bar. Under construction. Plastic sheeting. Sawdust. Half-finished fixtures. But the piano worked.</p>
                        <p>Contractors everywhere. People yelling in languages I didn't recognize. Cafeteria lines a mile long â€” project managers, welders, electricians, us.</p>
                        <p>We ate with them. Partied with them. Sweated through the sticky Singapore heat with them. Tripped over them.</p>
                        <p>The musicians got close fast. We had chores during the day â€” nothing too bad â€” but we escaped whenever we could.</p>
                    </div>

                    <div class="story-section-panel">
                        <span class="section-tag-panel">Exploring</span>
                        <h3 class="section-title-panel">Getting Off The Ship</h3>
                        <p>I got to know the Singapore MRT. I got to know the malls.</p>
                        <blockquote class="story-quote">Malls meant two things: food and wifi.</blockquote>
                        <div class="story-gallery-grid">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1769037282/072-2_hxubqq.jpg" class="story-image" data-caption="The Singapore MRT. Our escape route." alt="Singapore MRT">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1769037282/073_jozbht.jpg" class="story-image" data-caption="The MRT station." alt="Singapore MRT">
                        </div>
                        <p class="photo-caption-inline">The MRT. Our escape route to air conditioning and wifi.</p>
                        <div class="story-gallery-grid">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1769037276/012-2_m4xovl.jpg" class="story-image" data-caption="The electronics mall. My favorite spot in Singapore." alt="Electronics mall">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1769037276/081_rjivqx.jpg" class="story-image" data-caption="The new hotel that wasn't yet finished - Marina Bay Sands." alt="Marina Bay Sands">
                        </div>
                        <p class="photo-caption-inline">The electronics mall â€” my favorite spot in Singapore. And the new hotel that wasn't even finished yet. Everything felt under construction.</p>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1769037257/Singapore_Panorama_ryrlix.jpg" class="story-image" data-caption="Singapore panorama." alt="Singapore panorama">
                        <p class="photo-caption-inline">Singapore. A city that never stopped building.</p>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1769037266/028-4_vgjdyu.jpg" class="story-image" data-caption="Musicians bonding in Singapore: Richard, Ashley, and Thomas." alt="Musicians bonding">
                        <p class="photo-caption-inline">Richard, Ashley, and Thomas â€” we were in this together.</p>
                        <div class="story-gallery-grid">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1769037275/039_bn8ed8.jpg" class="story-image" data-caption="The royal palace and park." alt="Royal palace">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1769037276/029-3_dz16wt.jpg" class="story-image" data-caption="Exploring Singapore." alt="Singapore park">
                        </div>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1769037268/017_ngcz3a.jpg" class="story-image" data-caption="The royal park." alt="Royal park">
                        <p class="photo-caption-inline">The royal palace and park. We explored every chance we got.</p>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1769037266/021-3_viiyxk.jpg" class="story-image" data-caption="A sign to obey. Singaporean law was clear." alt="Singapore warning sign">
                        <p class="photo-caption-inline">Singaporean law was clear. Don't say they didn't warn you.</p>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1769037267/049-2_utq92i.jpg" class="story-image" data-caption="My passenger cabin on the Jewel." alt="Passenger cabin">
                        <p class="photo-caption-inline">My cabin. A passenger cabin. All to myself for four months.</p>
                        <p>That was the escape. But underneath it all â€” underneath the exploring and the jokes and the long walks through the city â€” there was worry.</p>
                        <p>I wasn't ready.</p>
                    </div>

                    <div class="story-section-panel">
                        <span class="section-tag-panel">The Preparation</span>
                        <h3 class="section-title-panel">Pounding the Keys</h3>
                        <p>Every night, I worked in the Orient Bar until late. I had over a hundred songs on my list.</p>
                        <p>But when I sat down to play? I kept falling back on the same 30.</p>
                        <p>That was a problem.</p>
                        <p>There were two other pianists in our group. Ashley â€” our band master. And Alexander â€” a child prodigy type, pure Liberace energy. Both were incredibly supportive. They had to be.</p>
                        <p>I was nervous as hell.</p>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1769030580/025_yqujzb.jpg" class="story-image" data-caption="The Orient Bar, finished." alt="The Orient Bar">
                        <p class="photo-caption-inline">The Orient Bar. Finished. Elegant. Intimidating. The room that terrified me.</p>
                        <p>The first time I saw the finished Orient Bar â€” the elegant room, the beautiful baby grand, the view out to sea â€” my fear didn't go away.</p>
                        <p>It grew.</p>
                        <p>But I was with the Food & Beverage Manager. He was giving me the tour. I couldn't let it show.</p>
                        <p>Only my second contract at sea. But I'd already learned the importance of chain of command.</p>
                        <p>You don't let them see you sweat.</p>
                    </div>

                    <div class="story-section-panel">
                        <span class="section-tag-panel">The Stakes</span>
                        <h3 class="section-title-panel">Oh Holy Shit</h3>
                        <p>The Jewel wasn't doing the short runs like the Sun.</p>
                        <p>These were longer cruises. Sometimes 18 days at sea.</p>
                        <p>And this wasn't just any cruise.</p>
                        <p>This was the <em>inaugural</em> voyage.</p>
                        <p>There would be dignitaries on board.</p>
                        <p>VIPs.</p>
                        <p>The Governor.</p>
                        <blockquote class="story-quote">Oh holy shit.</blockquote>
                        <p>Yeah.</p>
                        <p>I was nervous.</p>
                        <p>Would you be?</p>
                    </div>

                    <div class="story-section-panel">
                        <span class="section-tag-panel">Darling Harbour</span>
                        <h3 class="section-title-panel">The Red Carpet</h3>
                        <p>December 12th, 2009.</p>
                        <p>Darling Harbour, Sydney.</p>
                        <div class="story-gallery-grid">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1769030579/030_lzogz2.jpg" class="story-image" data-caption="Standing in front of the Pacific Jewel at Darling Harbour." alt="Derrick at Darling Harbour">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1769037257/008-2_yeieuu.jpg" class="story-image" data-caption="Embarkation day." alt="Embarkation day">
                        </div>
                        <p class="photo-caption-inline">I felt like a movie star. I was terrified.</p>
                        <p>That's me. Standing in front of the Pacific Jewel. Opera House in the background. Black suit. Big smile.</p>
                        <p>The smile was real. So was the terror underneath it.</p>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1769031021/026-5_r4ehv3.jpg" class="story-image" data-caption="Sydney Harbour panorama." alt="Sydney Harbour">
                        <p class="photo-caption-inline">Sydney Harbour. This was a big deal.</p>
                        <p>That night: the inaugural party. Pink Hummer limos pulling up. Crowds everywhere. A stage on the dock. Fireworks planned for midnight.</p>
                        <div class="story-gallery-grid">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1769030579/035_lhmdeq.jpg" class="story-image" data-caption="The inaugural party setup. Pink Hummer limos." alt="Inaugural party setup">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1769037257/043-3_qkjmjo.jpg" class="story-image" data-caption="Musos waiting for the sky to clear. Would it rain?" alt="Waiting for fireworks">
                        </div>
                        <p class="photo-caption-inline">The setup. The anticipation. Musos waiting for the sky to clear. Would it rain?</p>
                        <div class="story-gallery-grid">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1769037256/016-5_pqce0o.jpg" class="story-image" data-caption="Famous Australian talent showed up for the party." alt="Australian celebrity">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1769037242/006-9_vgsu3k.jpg" class="story-image" data-caption="Musician friends: Adriano Moreira and Fabio." alt="Musician friends">
                        </div>
                        <p class="photo-caption-inline">Big Australian talent showed up for the party. My musician friends Adriano and Fabio.</p>
                        <p>I was either going to sink or swim in the days ahead.</p>
                        <p>No in-between.</p>
                    </div>

                    <div class="story-section-panel">
                        <span class="section-tag-panel">Sailing Out</span>
                        <h3 class="section-title-panel">The Opera House at Night</h3>
                        <p>We pulled away from the dock.</p>
                        <p>The Opera House slid past. Lit up. Glowing against the dark.</p>
                        <div class="story-gallery-grid">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1769035906/03-opera-house-dusk_b5zehq.jpg" class="story-image" data-caption="The Opera House at dusk." alt="Opera House at dusk">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1769030580/060_dczkem.jpg" class="story-image" data-caption="Opera House at night as we sailed away." alt="Opera House at night">
                        </div>
                        <p class="photo-caption-inline">Through the porthole. Then past us. Then gone.</p>
                        <div class="story-gallery-grid">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1769031099/046-2_csspcp.jpg" class="story-image" data-caption="The deck party at night." alt="Deck party">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1769030579/045_ngolea.jpg" class="story-image" data-caption="Sydney Showboat escorting us out." alt="Sydney Showboat">
                        </div>
                        <p class="photo-caption-inline">The deck party. Hundreds of people. Sydney Showboat escorting us into the night.</p>
                        <p>Somewhere in that harbor, the guitarist I used to be stayed behind.</p>
                        <p>The pianist I was about to become?</p>
                        <p>He sailed out into the dark.</p>
                    </div>

                    <div class="story-section-panel">
                        <span class="section-tag-panel">The Transformation</span>
                        <h3 class="section-title-panel">The First Night</h3>
                        <p>I wasn't scheduled to play until the ship started pulling away from Darling Harbour.</p>
                        <p>By then it was late. Guests were still in their cabins after their first afternoon on board, still finding their way around. The Orient Bar was on Deck 7, towards the back of the ship. Not everyone would find it right away.</p>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1769030580/025_yqujzb.jpg" class="story-image" data-caption="The Orient Bar. Elegant. Intimidating. Mostly empty." alt="Orient Bar empty">
                        <p class="photo-caption-inline">The Orient Bar. Elegant. Intimidating. Mostly windows. Mostly empty.</p>
                        <p>A few people came in and sat down at first.</p>
                        <p>I played. The sound of a baby grand piano in a mostly empty room that was mostly windows â€” it was jarring. Every note hung in the air. Every squeak of the foot pedals. Every plink of my fingers on the keys.</p>
                        <p>Then, mid-ballad â€” what I thought was one of my most impassioned performances of the evening â€” a couple walked up and asked if I could take their photo.</p>
                        <blockquote class="story-quote">Sure. Of course.</blockquote>
                        <p>Things settled into a cozy routine after that. I adjusted to the sound of the room. To the quiet.</p>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1769037243/011-8_soq3q6.jpg" class="story-image" data-caption="The Orient Bar starting to fill." alt="Orient Bar inaugural">
                        <p class="photo-caption-inline">The bar starting to fill. A few guests finding their way in.</p>
                        <p>And then suddenly, people started walking in from both sides of the bar. Fifty of them. Maybe more.</p>
                        <p>The Orient Bar came alive.</p>
                        <div class="story-gallery-grid">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1769037243/005-7_muz86f.jpg" class="story-image" data-caption="My first night in the Orient." alt="First night Orient Bar">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1769037243/003-7_vqkbd8.jpg" class="story-image" data-caption="Me with guests in the Orient Bar." alt="With guests">
                        </div>
                        <p class="photo-caption-inline">The room came alive. Guests everywhere.</p>
                        <div class="story-gallery-grid">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1769037257/002-7_bmhskm.jpg" class="story-image" data-caption="More guests in the Orient." alt="More guests">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1769037256/001-5_exb3r6.jpg" class="story-image" data-caption="The bar full of life." alt="Orient Bar guests">
                        </div>
                        <p class="photo-caption-inline">This was what I'd been terrified of. This was what I'd been waiting for.</p>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/v1769037243/004-6_gfk1p1.jpg" class="story-image" data-caption="My first performance in the Orient." alt="First performance">
                        <p class="photo-caption-inline">My first performance in the Orient Bar.</p>
                        <p>For the next four months, I often wished for that quiet piano room again â€” the one where I could hear each squeak of the pedals, each plink of the keys.</p>
                        <p>But that's when it hit me. There's a rhythm to certain things on a ship. A coordinated effort between all the elements of life at sea â€” the dining, the entertainment, the shore excursions, even the sea days. The entire crew works together to achieve that rhythm. And to keep it going through good and bad.</p>
                        <blockquote class="story-quote">I wasn't drowning.</blockquote>
                        <blockquote class="story-quote">I was swimming.</blockquote>
                        <p>The ship had been transformed in Singapore. Stripped down to the hull and rebuilt into something new.</p>
                        <p>So had I.</p>
                    </div>

                    <div class="more-info-container" onclick="this.classList.toggle('active')">
                        <button class="more-info-btn">
                            <span class="info-icon">ðŸ’¡</span>
                            <span>More about this moment</span>
                        </button>
                        <div class="more-info-popup">
                            <div class="popup-title">
                                <span class="title-icon">ðŸŽ¹</span>
                                <span>The Numbers</span>
                            </div>
                            <ul class="fun-facts-list">
                                <li><strong>The Ship:</strong> Pacific Jewel was originally Crown Princess (1990). Rebuilt and renamed for P&O Australia in 2009.</li>
                                <li><strong>The Room:</strong> The Orient Bar. Deck 7. Asian-inspired decor. One beautiful baby grand piano.</li>
                                <li><strong>The Setlist:</strong> 1,127 songs in my repertoire book. Billy Joel. Elton John. Broadway. Classical. Ragtime. Country. About 30 of them actually ready.</li>
                                <li><strong>The Date:</strong> December 12, 2009. Inaugural voyage. Governor of New South Wales on board.</li>
                                <li><strong>The Cruises:</strong> Up to 18 days at sea. No hiding if you weren't ready. No faking it for that long.</li>
                            </ul>
                        </div>
                    </div>
                `,
                fullDesc: "My agent called with a catch: P&O wanted me back, but not as a guitarist. They wanted me at the piano.\n\n'You do play piano, right?'\n\nWell. Yeah. Kind of.\n\nThe ship was transformed in Singapore. So was I.",
                image: "https://res.cloudinary.com/de5jbyhxx/image/upload/v1769030579/030_lzogz2.jpg"
            },
            {
                id: 12,
                title: "Milford Sound, New Zealand",
                coords: [-44.6414, 167.8974],
                tag: "Eighth Wonder",
                icon: "â›°ï¸",
                isDoor: false,
                shortDesc: "Fjords that defy description.",
                fullDesc: "Rudyard Kipling called it the eighth wonder of the world.\n\nHe wasn't wrong. We sailed slowly through the sound as waterfalls cascaded down sheer cliffs into the dark water. Dolphins played in our wake. It was one of those rare moments where everyone on deck just fell silent.",
                image: "https://images.unsplash.com/photo-1508882189859-4d570e7b4030?w=1200"
            },
            {
                id: 13,
                title: "Akaroa, New Zealand",
                coords: [-43.8037, 172.9686],
                tag: "French Corner",
                icon: "ðŸ·",
                isDoor: false,
                shortDesc: "A slice of France in New Zealand.",
                fullDesc: "This tiny town on Banks Peninsula has French street names and French bakeries.\n\nIt's the result of a quirky colonial history-French settlers arrived just days after the British claimed the islands. The French decided to stay anyway. Good choice.",
                image: "https://images.unsplash.com/photo-1504275107627-0c2ba7a43dba?w=1200"
            },
            {
                id: 14,
                title: "Wellington, New Zealand",
                coords: [-41.2865, 174.7762],
                tag: "Coolest Little Capital",
                icon: "ðŸŽ‰",
                isDoor: false,
                shortDesc: "The cool little capital.",
                fullDesc: "New Zealand's capital lived up to its nickname-the coolest little capital in the world.\n\nCompact, walkable, with a thriving arts scene and some of the best craft beer in the Southern Hemisphere. Wellington felt like home.",
                image: "https://images.unsplash.com/photo-1563806951900-5853e5e4fb06?w=1200"
            },
            {
                id: 15,
                title: "Picton, New Zealand",
                coords: [-41.2930, 174.0079],
                tag: "Rolling Green Hills",
                icon: "ðŸ‡",
                isDoor: false,
                shortDesc: "Gateway to wine country.",
                fullDesc: "To get here, we sailed through the stunning Queen Charlotte Sound.\n\nPicton itself is small, but it's the gateway to Marlborough-New Zealand's premier wine region. Sauvignon Blanc country, with rolling hills that glow golden in the afternoon light.",
                image: "https://images.unsplash.com/photo-1589328223253-9a3b65d64827?w=1200"
            },
            {
                id: 16,
                title: "Napier, New Zealand",
                coords: [-39.4928, 176.9120],
                tag: "Classic Cars",
                icon: "ðŸš—",
                isDoor: false,
                shortDesc: "Vintage architecture and classic automobiles.",
                fullDesc: "Napier is famous for its Art Deco architecture, rebuilt after an earthquake in 1931.\n\nWalking these streets feels like stepping back into the Great Gatsby era. Classic cars line the boulevards. The whole town is a time capsule.",
                image: "https://images.unsplash.com/photo-1581489067667-27a695e20603?w=1200"
            },
            {
                id: 17,
                title: "Tauranga, New Zealand",
                coords: [-37.6878, 176.1651],
                tag: "Bay of Plenty",
                icon: "ðŸŽ¸",
                isDoor: false,
                shortDesc: "Mount Maunganui and white sand beaches.",
                fullDesc: "A short drive from the port takes you to Mount Maunganui.\n\nWe would hike to the top for incredible views or just relax on some of the best beaches in New Zealand. The Bay of Plenty earned its name.",
                image: "https://images.unsplash.com/photo-1596503920704-585573420077?w=1200"
            },
            {
                id: 18,
                title: "Tonga",
                coords: [-21.1393, -175.2018],
                tag: "The King's Palace",
                icon: "ðŸ°",
                isDoor: false,
                shortDesc: "Kingdom of Tonga.",
                fullDesc: "Arriving in Nuku'alofa, you feel the deep Polynesian culture immediately.\n\nIt is one of the few places where Sunday is strictly observed as a day of rest and church. The pace is different here-slower, more intentional.",
                image: "https://images.unsplash.com/photo-1589871162799-a864708764b8?w=1200"
            },
            {
                id: 19,
                title: "Bora Bora",
                coords: [-16.5004, -151.7415],
                tag: "Jetski Paradise",
                icon: "ðŸš¤",
                isDoor: false,
                shortDesc: "The pearl of the Pacific.",
                fullDesc: "The water here is a color I didn't know existed.\n\nWe anchored in the lagoon and the view of Mount Otemanu is something I will never forget. Bora Bora is the kind of place that feels too beautiful to be real.",
                image: "https://images.unsplash.com/photo-1532408840135-2d8f2b3e8964?w=1200"
            },
            {
                id: 20,
                title: "Port Vila",
                coords: [-17.7333, 168.3273],
                tag: "The Cursed Maiden Voyage",
                icon: "ðŸŒ€",
                isDoor: false,
                shortDesc: "Sandwiched between two cyclones. The night everything went wrong.",
                imagePosition: "center",
                imageCaption: "The morning after. That horizontal scratch runs right past where my cabin was.",
                useRichContent: true,
                richContent: `
                    <div class="demographics-strip">
                        <div class="demo-item">
                            <span class="demo-icon">ðŸ“</span>
                            <span class="demo-value">Vanuatu</span>
                        </div>
                        <div class="demo-item">
                            <span class="demo-icon">ðŸš¢</span>
                            <span class="demo-value">Pacific Pearl</span>
                        </div>
                        <div class="demo-item">
                            <span class="demo-icon">ðŸ“…</span>
                            <span class="demo-value">December 2010</span>
                        </div>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">The Setup</span>
                        <h3 class="section-title-panel">Fresh Out of Dry Dock</h3>
                        <p>The Pacific Pearl had just come out of a month-long refit in Singapore. All crew were onboard as we sailed her out of dry dock - a sweltering month of work with little to no air conditioning and plenty of alcohol for the musicians.</p>
                        <p>I was about two years into my contracted life at sea by then. The ship was being transformed from Ocean Village into P&O Australia's newest vessel. New restaurants, new bars, new everything.</p>
                        <p>Including a massive chandelier in the atrium.</p>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">The Chandelier</span>
                        <h3 class="section-title-panel">We Watched Them Hang It</h3>
                        <p>Me and another crew member watched them install that chandelier. A huge iron and steel structure, several hundred pounds, suspended three stories above the atrium floor.</p>
                        <p>They didn't do any load testing. Nothing. They were rushing to get the old girl ready for launch.</p>
                        <p>We joked that it wasn't going to last an entire cruise.</p>
                        <p>On the maiden voyage out of Sydney, just hours after a massive party in the atrium - all the musicians jamming, passengers running around everywhere, champagne flowing - it fell.</p>
                        <p>Three stories. Middle of the night. Crashed into the cafÃ© area below.</p>
                        <p>An hour earlier, we'd all been standing right under it.</p>
                        <p>P&O's official statement said "the reassuring thing was that there were no passengers or crew anywhere near the area when it happened." Yeah - because it was 3 AM.</p>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">The Storm</span>
                        <h3 class="section-title-panel">Sandwiched Between Two Cyclones</h3>
                        <p>That was just the beginning.</p>
                        <p>A bad storm hit on our first night out of Sydney. Then the captain made an announcement that would have been funny if it wasn't terrifying:</p>
                        <p>We had somehow ended up sandwiched between two cyclones.</p>
                        <p>The original itinerary - Isle of Pines, maybe Mystery Island - was scrapped. We were making an emergency overnight stop at Port Vila instead.</p>
                        <p>The 2010-2011 South Pacific cyclone season was brutal. Cyclone Vania. Cyclone Yasi. Cyclone Atu. We were caught in the middle of all of it.</p>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">The Impact</span>
                        <h3 class="section-title-panel">"You Were Lucky"</h3>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_800,q_auto,f_auto/v1768966739/IMG_0357_uylflq.jpg" class="story-image" data-caption="Engineering crew hosing off the hull the morning after. My cabin was just below the last porthole on deck 5, right where the scratch begins." alt="Hull damage on Pacific Pearl">
                        <p class="photo-caption-inline">The morning after. That horizontal scratch runs right past deck 5 - right past my cabin.</p>
                        <p>The captain put the boat into the dock at Port Vila with enough force that it knocked me off my bed. I was changing my guitar strings at the time.</p>
                        <p>When I stood up and got my bearings, I noticed two things:</p>
                        <p>First, my floor had buckled upward.</p>
                        <p>Second, there was a crack running all the way up my cabin wall. Through that crack, I could see what looked like the hull of the ship.</p>
                        <p>For a few days after that, I was famous. The staff captain, head engineer - and it felt like all 700 crew onboard - wanted to peek inside my cabin. After a while I just left my door open for a few days.</p>
                        <p>Then I was moved temporarily to a passenger cabin while they made "repairs."</p>
                        <p>I never did go back to that cabin. But my good friend Daryl Stevenette did a contract a year later on the Pearl - and the floor was still buckled. The bathroom door didn't quite shut right.</p>
                        <p>The staff captain looked at me and said: "You were lucky."</p>
                        <p>I could have been crushed by a cruise ship.</p>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">The Aftermath</span>
                        <h3 class="section-title-panel">The Unluckiest Maiden Voyage</h3>
                        <p>The Pacific Pearl's maiden voyage became legendary for all the wrong reasons:</p>
                        <p>â€¢ Chandelier falls 3 stories (hours after party underneath)<br>
                        â€¢ Caught between two cyclones<br>
                        â€¢ Emergency diversion to Port Vila<br>
                        â€¢ Hull damage during docking<br>
                        â€¢ Medical evacuation near Great Barrier Island<br>
                        â€¢ Non-flushing toilets<br>
                        â€¢ No drinking water during the storm</p>
                        <p>As crew, we were forbidden to talk about most of it. The chandelier incident especially.</p>
                        <p>But the ship no longer exists. P&O Australia no longer exists. And this is my story to tell.</p>
                    </div>
                    
                    <div class="more-info-container" onclick="this.classList.toggle('active')">
                        <button class="more-info-btn">
                            <span class="info-icon">ðŸ’¡</span>
                            <span>More about this incident</span>
                        </button>
                        <div class="more-info-popup">
                            <div class="popup-title">
                                <span class="title-icon">ðŸŒ€</span>
                                <span>The Cursed Maiden Voyage</span>
                            </div>
                            <ul class="fun-facts-list">
                                <li><strong>The Ship:</strong> Pacific Pearl was formerly Ocean Village, refitted in Singapore in late 2010 at Sembawang Shipyard.</li>
                                <li><strong>Maiden Voyage:</strong> December 22, 2010, from Auckland.</li>
                                <li><strong>The Cyclones:</strong> The 2010-11 South Pacific cyclone season included Vania (Jan 12-13), Yasi (Jan 30), and Atu (Feb 21).</li>
                                <li><strong>Confirmed:</strong> The chandelier incident was reported by Cruise Compare: "a large 3 metre wide chandelier fell through the ships open atrium three storeys down."</li>
                                <li><strong>Ship's Fate:</strong> Pacific Pearl was sold in 2017, renamed Columbus, and later scrapped after CMV went into administration in 2020.</li>
                            </ul>
                        </div>
                    </div>
                `,
                fullDesc: "Port Vila was supposed to be Isle of Pines. But when you're sandwiched between two cyclones on the maiden voyage of the Pacific Pearl - a voyage already marked by a falling chandelier - you take whatever safe harbor you can get. The captain docked with enough force to crack my cabin wall. The staff captain said I was lucky. I think I know what he meant.",
                image: "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768966739/IMG_0357_uylflq.jpg"
            },
            {
                id: 111,
                title: "New Caledonia",
                coords: [-22.2711, 166.4416],
                tag: "French Pacific",
                icon: "ðŸ‡«ðŸ‡·",
                isDoor: false,
                shortDesc: "France in the South Pacific.",
                fullDesc: "New Caledonia is a surreal mashup of French culture and Pacific island life.\n\nBaguettes and lagoons. CafÃ©s au lait and coral reefs. The Isle of Pines nearby is one of the most beautiful places I've ever seen.",
                image: "https://images.unsplash.com/photo-1589179899630-5bd2b312b5a8?w=1200"
            },
            {
                id: 117,
                title: "Lifou",
                coords: [-20.9167, 167.2833],
                tag: "The Guardian Spider",
                icon: "ðŸ•·ï¸",
                isDoor: false,
                shortDesc: "A church on a hill, a spider in a fence, and the clearest water I've ever seen.",
                imagePosition: "center",
                imageCaption: "The church on Lifou. I climbed this hill more times than I can count.",
                useRichContent: true,
                richContent: `
                    <div class="demographics-strip">
                        <div class="demo-item">
                            <span class="demo-icon">ðŸ“</span>
                            <span class="demo-value">Loyalty Islands</span>
                        </div>
                        <div class="demo-item">
                            <span class="demo-icon">ðŸ‡«ðŸ‡·</span>
                            <span class="demo-value">New Caledonia</span>
                        </div>
                        <div class="demo-item">
                            <span class="demo-icon">ðŸš¢</span>
                            <span class="demo-value">P&O Australia</span>
                        </div>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">The Island</span>
                        <h3 class="section-title-panel">Picture Perfect</h3>
                        <p>Lifou was one of those places that felt like a secret. A tender port on the regular P&O rotation through the South Pacific - NoumÃ©a, Isle of Pines, Port Vila, and here.</p>
                        <p>On the far side of the island was a swimming and snorkeling spot with water so clear it barely looked real. The kind of place you'd see in a travel brochure and assume was photoshopped.</p>
                        <p>But it was the church on the hill that kept drawing me back.</p>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">The Church</span>
                        <h3 class="section-title-panel">Churches Older Than Any I'd Ever Entered</h3>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_800,q_auto,f_auto/v1768963793/New_Caldonia_church_t4pfw4.jpg" class="story-image" data-caption="The church on Lifou - I visited this spot every time we called here." alt="Lifou church">
                        <p class="photo-caption-inline">The church on Lifou. A quiet place at the top of a dusty road.</p>
                        <p>Every time we called at Lifou, I'd make the climb up to this church. It became a ritual. The walk was hot and dusty, but there was something peaceful about that little building at the top of the hill.</p>
                        <p>The Pacific run took us through places I'd only seen in documentaries. Turquoise water so clear you could count fish from the tender. Churches older than any building I'd ever entered. Islands where time moved differently.</p>
                        <p>This was one of those churches.</p>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">The Spider</span>
                        <h3 class="section-title-panel">My Little Landmark Friend</h3>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_800,q_auto,f_auto/v1768963050/Screen_Shot_2026-01-20_at_9.35.22_PM_x1xnpi.png" class="story-image" data-caption="The guardian spider of Lifou." alt="Spider on Lifou">
                        <p class="photo-caption-inline">The guardian of the path to the church.</p>
                        <p>One day, walking up to the church, I noticed him. A spider - and not a small one - nestled in a wooden fence that separated someone's property from the road.</p>
                        <p>He seemed almost like a pet. Just sitting there in his web, unbothered by the world passing by.</p>
                        <p>After that, every time we visited Lifou, I'd look for him as I climbed up to the church. He became my little landmark. A familiar face - all eight eyes of it - on an island far from home.</p>
                        <p>And then one visit, he was gone.</p>
                        <p>I don't know what happened to him. Maybe he moved on. Maybe something got him. But I still looked for him every time after that, just in case.</p>
                    </div>
                    
                    <div class="more-info-container" onclick="this.classList.toggle('active')">
                        <button class="more-info-btn">
                            <span class="info-icon">ðŸ’¡</span>
                            <span>More about this location</span>
                        </button>
                        <div class="more-info-popup">
                            <div class="popup-title">
                                <span class="title-icon">ðŸï¸</span>
                                <span>Lifou</span>
                            </div>
                            <ul class="fun-facts-list">
                                <li><strong>Largest Loyalty Island:</strong> Lifou is the biggest of the Loyalty Islands, with about 10,000 residents.</li>
                                <li><strong>Raised Coral Atoll:</strong> The island is a former coral atoll, now raised above sea level. The interior is flat (an old lagoon) surrounded by limestone cliffs.</li>
                                <li><strong>Tender Port:</strong> No dock - cruise ships anchor offshore and passengers take lifeboats (tenders) to reach the island.</li>
                                <li><strong>French Territory:</strong> Part of New Caledonia, an overseas territory of France in the South Pacific.</li>
                                <li><strong>Six Tribes:</strong> Six of the 19 different tribes of the Loyalty Islands live on Lifou.</li>
                            </ul>
                        </div>
                    </div>
                `,
                fullDesc: "Lifou was one of those places that felt like a secret. On the far side of the island was a swimming spot with water so clear it barely looked real. But it was the church on the hill that kept drawing me back - and the spider in the wooden fence who became my unlikely landmark friend.",
                image: "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768963793/New_Caldonia_church_t4pfw4.jpg"
            },
            {
                id: 23,
                title: "Airlie Beach, Australia",
                coords: [-20.2688, 148.7166],
                tag: "Climate Anxiety",
                icon: "ðŸŒ¡ï¸",
                isDoor: false,
                shortDesc: "The Whitsundays-where beauty meets foreboding.",
                fullDesc: "I worried a lot. Every time I jumped onto the catamaran tender until the moment I left, a constant feeling droned its way around my brain. Something doesn't feel right.\n\nAgain I imagined an earlier time. When walking in the sand didn't burn my toes. When the glare of the sun while at sea wasn't so offensive. When one might have been able to take a deep breath of the world around them and be grateful, instead of being pulled in two directions by the beauty and the foreboding evidence of climate change.\n\nI've never been anywhere so consistently uncomfortable temperature-wise. You just know that something is going terribly wrong with the planet.",
                image: "https://images.unsplash.com/photo-1559827260-dc66d52bef19?w=1200"
            },
            {
                id: 24,
                title: "Falkland Islands",
                coords: [-51.7963, -59.5236],
                tag: "Contested Territory",
                icon: "ðŸº",
                isDoor: false,
                shortDesc: "Half a day in rough seas, a pub, and someone's problems.",
                fullDesc: "We stopped here for half a day during rough seas. Had a beer in one of the pubs and listened to a friend tell me all of her woes.\n\nUnique, memorable, and exhausting.\n\nThe irony wasn't lost on me-just days earlier in Ushuaia, I'd been reading those passionate anti-British posters about this very place. Now here I was, having a pint on the disputed ground itself.",
                image: "https://images.unsplash.com/photo-1564760290292-23341e4df6ec?w=1200"
            },
            {
                id: 25,
                title: "Milos, Greece",
                coords: [36.74, 24.42],
                tag: "Volcanic Beauty",
                icon: "ðŸ›ï¸",
                isDoor: false,
                shortDesc: "Where the Venus de Milo was found.",
                fullDesc: "Milos is what happens when a volcano meets the Aegean.\n\nThe beaches here aren't just beautiful-they're otherworldly. Sarakiniko looks like the surface of the moon. Kleftiko's sea caves glow turquoise. This island doesn't get the crowds of Santorini, and that's exactly why I loved it.",
                image: "https://res.cloudinary.com/de5jbyhxx/image/upload/v1767734543/IMG_3093_p55z1r.jpg"
            },
            {
                id: 41,
                title: "Santorini, Greece",
                coords: [36.39, 25.46],
                tag: "Iconic Caldera",
                icon: "ðŸ›ï¸",
                isDoor: false,
                shortDesc: "The postcard of the Aegean.",
                fullDesc: "Santorini needs no introduction.\n\nThe white-washed buildings cascading down volcanic cliffs, the blue domes, the sunsets that stop you in your tracks. It's touristy for a reason-some places really are as beautiful as the postcards suggest. Watching the sun sink into the caldera from Oia is something I'll never forget.",
                image: "https://images.unsplash.com/photo-1613395877344-13d4a8e0d49e?w=1200"
            },
            {
                id: 26,
                title: "Piran, Slovenia",
                coords: [45.53, 13.57],
                tag: "Hidden Adriatic",
                icon: "â›µ",
                isDoor: false,
                shortDesc: "Slovenia's tiny slice of coastline.",
                fullDesc: "Slovenia has only 47 kilometers of coastline. Piran is the jewel of it.\n\nVenetian architecture, narrow winding streets, and none of the crowds of nearby Croatia. We walked the sea wall at sunset and watched the fishing boats come in. Perfect.",
                image: "https://res.cloudinary.com/de5jbyhxx/image/upload/v1767734745/IMG_1778_fw5ihj.jpg"
            },
            {
                id: 27,
                title: "Kotor, Montenegro",
                coords: [42.42, 18.77],
                tag: "Fortress Walls",
                icon: "ðŸ°",
                isDoor: false,
                shortDesc: "Medieval walls climbing impossible mountains.",
                fullDesc: "The fjord approach to Kotor is dramatic enough. Then you see the walls.\n\nThey climb straight up the mountain behind the old town-1,350 steps to the fortress at the top. I made the climb. The view was worth every step.",
                image: "https://res.cloudinary.com/de5jbyhxx/image/upload/v1767735553/IMG_1717_ggcmyu.jpg"
            },
            {
                id: 28,
                title: "Syracuse, Sicily",
                coords: [37.07, 15.29],
                tag: "Ancient Greece in Italy",
                icon: "ðŸ›ï¸",
                isDoor: false,
                shortDesc: "Where Archimedes ran naked through the streets.",
                fullDesc: "Syracuse was once the most powerful city in the Greek world-bigger than Athens.\n\nThe ancient theater still hosts performances. The ear of Dionysius still echoes. And somewhere in these streets, Archimedes shouted 'Eureka!' and changed history.",
                image: "https://res.cloudinary.com/de5jbyhxx/image/upload/v1767735639/IMG_1240_swdpx7.jpg"
            },
            {
                id: 29,
                title: "Valletta, Malta",
                coords: [35.90, 14.51],
                tag: "Knights and Fortresses",
                icon: "âš“",
                isDoor: false,
                shortDesc: "The fortress island.",
                fullDesc: "Malta sits at the crossroads of the Mediterranean. Everyone wanted it. The Knights of St. John held it.\n\nValletta is built on a grid-unusual for a medieval city. The Grand Harbour is one of the most impressive approaches in the world. History seeps from every stone.",
                image: "https://res.cloudinary.com/de5jbyhxx/image/upload/v1767735863/IMG_1155_qtda7b.jpg"
            },
            {
                id: 30,
                title: "Tel Aviv, Israel",
                coords: [32.08, 34.78],
                tag: "Bauhaus by the Beach",
                icon: "ðŸŒ…",
                isDoor: false,
                shortDesc: "Ancient history meets beach culture.",
                fullDesc: "Tel Aviv is two cities in one.\n\nThere's the White City-4,000 Bauhaus buildings, more than anywhere else on Earth. And there's the beach scene-surfboards, cafes, and a energy that doesn't stop when the sun goes down. The contrast with nearby Jerusalem couldn't be starker.",
                image: "https://res.cloudinary.com/de5jbyhxx/image/upload/v1767735952/IMG_0854_wmukmp.jpg"
            },
            {
                id: 31,
                title: "Alexandria, Egypt",
                coords: [31.20, 29.92],
                tag: "Cleopatra's City",
                icon: "ðŸ«",
                isDoor: false,
                shortDesc: "Where the ancient library once stood.",
                fullDesc: "Alexandria was founded by Alexander the Great and ruled by Cleopatra.\n\nThe famous lighthouse is gone. The library burned. But the city endures-chaotic, loud, and utterly captivating. Standing on the corniche, you feel the weight of all that history pushing up through the pavement.",
                image: "https://res.cloudinary.com/de5jbyhxx/image/upload/v1767736004/IMG_0687_znjvkv.jpg"
            },
            {
                id: 32,
                title: "Mumbai, India",
                coords: [19.08, 72.88],
                tag: "Gateway to India",
                icon: "ðŸ•Œ",
                isDoor: false,
                shortDesc: "Sensory overload in the best way.",
                fullDesc: "Nothing prepares you for Mumbai.\n\nThe crowds. The colors. The sounds. The smells. It's overwhelming and exhilarating all at once. We visited the Gateway of India at sunset and watched the city come alive. Bollywood dreams and colonial grandeur, street food and skyscrapers-all crammed together.",
                image: "https://res.cloudinary.com/de5jbyhxx/image/upload/v1767736180/IMG_0914_u5kskn.jpg"
            },
            {
                id: 114,
                title: "Mormugao, Goa",
                coords: [15.41, 73.80],
                tag: "Portuguese India",
                icon: "ðŸ–ï¸",
                isDoor: false,
                shortDesc: "Where Portugal left its mark on India.",
                fullDesc: "Goa is unlike anywhere else in India.\n\nFour centuries of Portuguese rule left behind baroque churches, whitewashed villas, and a laid-back attitude that feels more Mediterranean than subcontinental. The beaches are beautiful, the seafood is incredible, and the pace is wonderfully slow.",
                image: ""
            },
            {
                id: 115,
                title: "New Mangalore, India",
                coords: [12.92, 74.81],
                tag: "Spice Coast",
                icon: "ðŸŒ¶ï¸",
                isDoor: false,
                shortDesc: "Gateway to Karnataka's coast.",
                fullDesc: "New Mangalore is the maritime gateway to Karnataka.\n\nThe port sits where the Western Ghats meet the Arabian Sea. Inland, the hills are carpeted with spice plantations-cardamom, pepper, coffee. The temples here are unique, with their own distinct Dravidian style.",
                image: ""
            },
            {
                id: 33,
                title: "South Georgia",
                coords: [-54.25, -36.75],
                tag: "The Edge of the World",
                icon: "ðŸ§",
                isDoor: false,
                shortDesc: "Where Shackleton rests. Where nature reclaims.",
                imagePosition: "center",
                imageCaption: "The whale catcher Petrel, now home to elephant seals.",
                useRichContent: true,
                richContent: `
                    <div class="demographics-strip">
                        <div class="demo-item">
                            <span class="demo-icon">ðŸ“</span>
                            <span class="demo-value">54Â°S, 36Â°W</span>
                        </div>
                        <div class="demo-item">
                            <span class="demo-icon">ðŸ‘¥</span>
                            <span class="demo-value">~30 residents</span>
                        </div>
                        <div class="demo-item">
                            <span class="demo-icon">ðŸ§</span>
                            <span class="demo-value">Millions of Penguins</span>
                        </div>
                        <div class="demo-item">
                            <span class="demo-icon">ðŸš¢</span>
                            <span class="demo-value">Seabourn Quest</span>
                        </div>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">The Approach</span>
                        <h3 class="section-title-panel">To the Edge of the World</h3>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_800,q_auto,f_auto/v1768799519/IMG_6763_sxyz76.jpg" class="story-image" data-caption="Approaching South Georgia by zodiac - the Seabourn Quest anchored in the bay." alt="Seabourn Quest at South Georgia">
                        <p class="photo-caption-inline">The Seabourn Quest anchored in the bay as we headed to shore by zodiac.</p>
                        <p>South Georgia is one of those places that exists more as legend than destination. A remote British territory in the South Atlantic, closer to Antarctica than anywhere else. No airport. No permanent population beyond a handful of scientists and museum staff.</p>
                        <p>To get here, you cross the Drake Passage - the roughest stretch of ocean on Earth. But when you finally see those jagged peaks rising from the sea, you understand why explorers risked everything to reach this place.</p>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">The Lecture</span>
                        <h3 class="section-title-panel">The Penguin Expert</h3>
                        <p>Before we reached South Georgia, a penguin expert gave a series of talks aboard ship. He was brilliant - the kind of scientist who could make you care deeply about something you'd never thought twice about.</p>
                        <p>One evening in the lounge, he showed us a map that tracked the history of commercial whaling. It started in the Northern Atlantic, then moved to the Pacific as those populations collapsed. When there was nothing left up north, the industry pushed south - all the way to these waters.</p>
                        <blockquote class="story-quote">They hunted whale populations to near extinction in the north, then chased the survivors to the bottom of the world.</blockquote>
                        <p>He hung out with us musicians in the lounge several nights after his talks. He'd request Dan Fogelberg and Cat Stevens songs while we talked about the wildlife we'd see. I wish I'd gotten a photo with him.</p>
                        
                        <div class="whaling-info-box" style="background: rgba(0,0,0,0.3); border-radius: 12px; padding: 1.5rem; margin: 1.5rem 0; border-left: 3px solid var(--coral);">
                            <h4 style="color: var(--gold); margin-bottom: 0.75rem; font-family: 'Cormorant Garamond', serif;">The Decimation</h4>
                            <p style="font-size: 0.9rem; margin-bottom: 0.75rem;">Between 1900 and 1999, an estimated <strong>2.9 million whales</strong> were killed by industrial whaling. The Blue Whale population fell from 340,000 to just 5,000 - a 98.5% decline.</p>
                            <p style="font-size: 0.85rem; color: rgba(245, 240, 232, 0.7);">South Georgia's Grytviken station alone processed over 175,000 whales between 1904 and 1965.</p>
                            <p style="font-size: 0.75rem; margin-top: 0.75rem;"><a href="https://ourworldindata.org/whaling" target="_blank" style="color: var(--gold);">Source: Our World in Data â†’</a></p>
                        </div>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">Grytviken</span>
                        <h3 class="section-title-panel">What Remains</h3>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_800,q_auto,f_auto/v1768798857/IMG_6834_fx0gdi.jpg" class="story-image" data-caption="The whale catcher Petrel, rusting where she was abandoned. Elephant seals now lounge on the beach." alt="Petrel whale catcher with elephant seals">
                        <p class="photo-caption-inline">The whale catcher <em>Petrel</em>, rusting where she was abandoned. Elephant seals now lounge on the beach.</p>
                        <p>Grytviken was once the largest whaling station in the world. Norwegian whalers built it in 1904, and for sixty years it processed the bodies of hundreds of thousands of whales - blue, fin, humpback, right, sei. Everything.</p>
                        <div class="story-gallery-grid">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_400,q_auto,f_auto/v1768799893/IMG_6827_sichau.jpg" class="story-image" data-caption="Mountains of anchor chain and a rotting boat hull - remnants of the whaling industry." alt="Anchor chains and wrecked boat">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_400,q_auto,f_auto/v1768799322/IMG_6818_qwfqd8.jpg" class="story-image" data-caption="The whalers' church, framed by rusted industrial buildings." alt="Church behind rust">
                        </div>
                        <p class="photo-caption-inline">Mountains of anchor chain, rotting hulls, and the whalers' church still standing among the ruins.</p>
                        <p>I thought it was ironic to see a church here. This place caused so much misery for so many years. But I suppose the men who worked here needed something to hold onto as well.</p>
                        <div class="story-gallery-grid">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_400,q_auto,f_auto/v1768800003/IMG_6822_bz1res.jpg" class="story-image" data-caption="Interpretive sign: The Petrel and Workshops at Grytviken." alt="Infographic: Petrel and Workshops">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_400,q_auto,f_auto/v1768799273/IMG_6824_icgv5s.jpg" class="story-image" data-caption="Interpretive sign: The Meal Plant where whale carcasses were processed." alt="Infographic: Meal Plant">
                        </div>
                        <p class="photo-caption-inline">Interpretive signs explain what each building was used for. The details are hard to read.</p>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">Nature Reclaims</span>
                        <h3 class="section-title-panel">The Wildlife Returns</h3>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_800,q_auto,f_auto/v1768799381/IMG_6796_dvoe4m.jpg" class="story-image" data-caption="A king penguin and fur seal in front of the abandoned whaling station." alt="King penguin and seal with ruins">
                        <p class="photo-caption-inline">A king penguin and fur seal, completely unbothered, with the ruins of the whaling station behind them.</p>
                        <p>The station closed in 1965. In the sixty years since, the wildlife has returned with a vengeance. King penguins waddle through the ruins. Fur seals sprawl on the beaches where whale carcasses were once dragged ashore. Elephant seals sleep in the grass, oblivious to the history beneath them.</p>
                        <div class="story-gallery-grid">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_400,q_auto,f_auto/v1768799349/IMG_6805_mzyioi.jpg" class="story-image" data-caption="An Antarctic fur seal, completely at ease." alt="Fur seal portrait">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_400,q_auto,f_auto/v1768799182/IMG_6830_copy_s3qmyz.jpg" class="story-image" data-caption="King penguin near the old pier, with an elephant seal resting behind." alt="King penguin with pier">
                        </div>
                        <p class="photo-caption-inline">Fur seals and king penguins have made Grytviken their home.</p>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_800,q_auto,f_auto/v1768799215/IMG_6825_copy_llb0iz.jpg" class="story-image" data-caption="Baby elephant seal. Those eyes." alt="Baby elephant seal">
                        <p class="photo-caption-inline">A baby elephant seal looked up at me with those eyes. How could anyone harm such a creature?</p>
                        <p>Standing there, looking at that baby seal, I felt physically sick. I understood the economics. I understood the historical context. But in that moment, I hated being part of the human race.</p>
                        <blockquote class="story-quote">What the fuck were we thinking?</blockquote>
                        <div class="story-gallery-grid">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_400,q_auto,f_auto/v1768799453/IMG_6776_iwumrm.jpg" class="story-image" data-caption="Elephant seal enjoying a mud bath." alt="Elephant seal in mud">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_400,q_auto,f_auto/v1768799428/IMG_6779_ustje1.jpg" class="story-image" data-caption="A young fur seal in the tussock grass, looking for its mother." alt="Baby seal in grass">
                        </div>
                        <p class="photo-caption-inline">An elephant seal enjoying a mud bath, and a young fur seal looking for its mother.</p>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">Shackleton</span>
                        <h3 class="section-title-panel">An Accidental Pilgrimage</h3>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_800,q_auto,f_auto/v1768799406/IMG_6787_uceutk.jpg" class="story-image" data-caption="Standing at Shackleton's grave. I stumbled upon it by accident." alt="At Shackleton's grave">
                        <p class="photo-caption-inline">Standing at Ernest Shackleton's grave. I look pale because I was.</p>
                        <p>I didn't plan to find Shackleton's grave. I was walking around the island, trying to process everything I'd seen, when I stumbled onto the small cemetery.</p>
                        <p>And there he was. Ernest Henry Shackleton. Explorer. The man who led the most incredible survival story in history - 28 men stranded on the ice for over a year, every single one brought home alive.</p>
                        <p>He died here in 1922, at the start of another expedition. His wife asked that he be buried on South Georgia, the island where he'd achieved his greatest triumph. Sailors who visit leave whisky at his grave and toast to "The Boss."</p>
                        <blockquote class="story-quote">I was frankly stunned. It took the rest of the day for my mind to catch up with where my body was standing.</blockquote>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">The Edge</span>
                        <h3 class="section-title-panel">Reflection</h3>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_800,q_auto,f_auto/v1768799478/IMG_6773_qijzm5.jpg" class="story-image" data-caption="Our excursion group exploring the island." alt="Excursion group">
                        <p class="photo-caption-inline">Our group exploring the island, navigating between wildlife and history.</p>
                        <p>South Georgia sits at the edge of everything. The edge of the map. The edge of human habitation. The edge of what we're capable of - both the worst and the best.</p>
                        <p>We came here to see wildlife, and we saw it in abundance. But we also saw what happens when humans decide something is a resource to be extracted. And we saw what happens when we finally stop.</p>
                        <p>The penguins don't know about the history. The seals don't care about the rusted machinery. They've simply moved back in. Maybe that's the only redemption available - not forgiveness, just the patient work of time and nature reclaiming what was taken.</p>
                    </div>
                    
                    <div class="more-info-container" onclick="this.classList.toggle('active')">
                        <button class="more-info-btn">
                            <span class="info-icon">ðŸ’¡</span>
                            <span>More about this location</span>
                        </button>
                        <div class="more-info-popup">
                            <div class="popup-title">
                                <span class="title-icon">ðŸ§</span>
                                <span>South Georgia Island</span>
                            </div>
                            <ul class="fun-facts-list">
                                <li><strong>Shackleton's Crossing:</strong> In 1916, Shackleton crossed the island's uncharted mountains in 36 hours to reach help - a feat not repeated for another 40 years.</li>
                                <li><strong>King Penguin Capital:</strong> South Georgia is home to over 400,000 breeding pairs of king penguins - one of the largest colonies on Earth.</li>
                                <li><strong>Whaling History:</strong> Between 1904-1965, over 175,000 whales were processed at Grytviken alone.</li>
                                <li><strong>Rat Eradication:</strong> A massive project from 2011-2015 successfully removed all invasive rats from the island, allowing seabirds to return.</li>
                                <li><strong>British Territory:</strong> Officially the "South Georgia and the South Sandwich Islands," it's a British Overseas Territory with no permanent population.</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="photo-gallery-section" id="southGeorgiaGallery">
                        <div class="gallery-header" onclick="this.parentElement.classList.toggle('expanded')">
                            <span class="gallery-title">
                                <span class="gallery-icon">ðŸ“¸</span>
                                <span>Photo Gallery</span>
                                <span class="gallery-count">15 images</span>
                            </span>
                            <span class="gallery-toggle">â–¼</span>
                        </div>
                        <div class="gallery-grid">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_400,q_auto,f_auto/v1768798857/IMG_6834_fx0gdi.jpg" class="gallery-thumb" data-caption="The whale catcher Petrel with elephant seals on the beach." alt="Petrel and seals">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_400,q_auto,f_auto/v1768799519/IMG_6763_sxyz76.jpg" class="gallery-thumb" data-caption="Seabourn Quest anchored at South Georgia." alt="Seabourn Quest">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_400,q_auto,f_auto/v1768799478/IMG_6773_qijzm5.jpg" class="gallery-thumb" data-caption="Our excursion group exploring the island." alt="Excursion group">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_400,q_auto,f_auto/v1768799453/IMG_6776_iwumrm.jpg" class="gallery-thumb" data-caption="Elephant seal enjoying a mud bath." alt="Elephant seal">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_400,q_auto,f_auto/v1768799428/IMG_6779_ustje1.jpg" class="gallery-thumb" data-caption="Young fur seal in the tussock grass." alt="Baby seal">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_400,q_auto,f_auto/v1768799406/IMG_6787_uceutk.jpg" class="gallery-thumb" data-caption="Standing at Shackleton's grave." alt="Shackleton's grave">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_400,q_auto,f_auto/v1768799381/IMG_6796_dvoe4m.jpg" class="gallery-thumb" data-caption="King penguin and fur seal with the ruins behind." alt="Penguin and seal">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_400,q_auto,f_auto/v1768799349/IMG_6805_mzyioi.jpg" class="gallery-thumb" data-caption="Antarctic fur seal portrait." alt="Fur seal">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_400,q_auto,f_auto/v1768799322/IMG_6818_qwfqd8.jpg" class="gallery-thumb" data-caption="The whalers' church among the rust." alt="Church">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_400,q_auto,f_auto/v1768800003/IMG_6822_bz1res.jpg" class="gallery-thumb" data-caption="Interpretive sign: Petrel and Workshops." alt="Infographic Petrel">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_400,q_auto,f_auto/v1768799273/IMG_6824_icgv5s.jpg" class="gallery-thumb" data-caption="Interpretive sign: Meal Plant." alt="Infographic Meal Plant">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_400,q_auto,f_auto/v1768799215/IMG_6825_copy_llb0iz.jpg" class="gallery-thumb" data-caption="Baby elephant seal - those eyes." alt="Baby elephant seal">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_400,q_auto,f_auto/v1768799893/IMG_6827_sichau.jpg" class="gallery-thumb" data-caption="Anchor chains and wrecked boat." alt="Chains and wreck">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_400,q_auto,f_auto/v1768799182/IMG_6830_copy_s3qmyz.jpg" class="gallery-thumb" data-caption="King penguin near the old pier." alt="King penguin">
                        </div>
                    </div>
                `,
                fullDesc: "South Georgia is one of the most remote places on Earth. We visited Shackleton's grave at Grytviken and toasted with whisky, as is tradition. But the real experience was confronting the ruins of the whaling industry - and watching nature slowly reclaim what was taken.\n\nStanding among elephant seals and king penguins, in the shadow of rusting whale catchers, I felt the weight of what humans are capable of. The worst and the best.",
                image: "https://res.cloudinary.com/de5jbyhxx/image/upload/w_800,q_auto,f_auto/v1768798857/IMG_6834_fx0gdi.jpg"
            },
            {
                id: 34,
                title: "Lemaire Channel, Antarctica",
                coords: [-65.05, -63.95],
                tag: "Kodak Gap",
                icon: "ðŸ§Š",
                isDoor: false,
                shortDesc: "The most beautiful passage in Antarctica.",
                fullDesc: "They call it Kodak Gap because everyone reaches for their camera.\n\nThe Lemaire Channel is barely wide enough for the ship. Ice cliffs tower on both sides. Penguins porpoise through water so still it mirrors the mountains. Time stops here.",
                image: "https://res.cloudinary.com/de5jbyhxx/image/upload/v1767737978/IMG_6712_bmwcxi.jpg"
            },
            {
                id: 35,
                title: "Port Lockroy, Antarctica",
                coords: [-64.82, -63.49],
                tag: "Penguin Post Office",
                icon: "ðŸ§",
                isDoor: false,
                shortDesc: "The southernmost post office in the world.",
                fullDesc: "Port Lockroy is surreal.\n\nA tiny British base from the 1940s, now a museum and gift shop staffed by four people each summer. You can send postcards that take months to arrive. But the real attraction is the gentoo penguins-completely unafraid, waddling between visitors like we're the attraction.",
                image: "https://res.cloudinary.com/de5jbyhxx/image/upload/v1767739780/IMG_6538_tolutk.jpg"
            },
            {
                id: 37,
                title: "Barcelona, Spain",
                coords: [41.38, 2.17],
                tag: "GaudÃ­'s Playground",
                icon: "ðŸŽ­",
                isDoor: false,
                shortDesc: "Where art and architecture collide.",
                fullDesc: "Barcelona is GaudÃ­'s city.\n\nThe Sagrada FamÃ­lia defies description-a cathedral that's been under construction for 140 years and still isn't finished. Park GÃ¼ell is a fever dream in tile. La Rambla pulses with energy day and night. This city knows how to live.",
                image: "https://res.cloudinary.com/de5jbyhxx/image/upload/v1767738440/IMG_20140811_122138_cqwjid.jpg"
            },
            {
                id: 38,
                title: "St. Tropez, France",
                coords: [43.27, 6.64],
                tag: "Riviera Glamour",
                icon: "â›±ï¸",
                isDoor: false,
                shortDesc: "Where the beautiful people play.",
                fullDesc: "St. Tropez was a fishing village until Brigitte Bardot showed up.\n\nNow it's superyachts and champagne, designer boutiques and paparazzi. But wander away from the port and you find quiet squares, excellent rosÃ©, and that golden ProvenÃ§al light that painters have chased for centuries.",
                image: "https://res.cloudinary.com/de5jbyhxx/image/upload/v1767738529/IMG_5536_ipjhwy.jpg"
            },
            {
                id: 39,
                title: "Ibiza, Spain",
                coords: [38.91, 1.43],
                tag: "Island of Two Faces",
                icon: "ðŸŽ‰",
                isDoor: false,
                shortDesc: "Party island with a secret peaceful side.",
                fullDesc: "Everyone knows Ibiza for the clubs. But the island has another side.\n\nThe old town is a UNESCO World Heritage site. The beaches in the north are quiet and pristine. Sunset at CafÃ© del Mar is a spiritual experience. Ibiza is whatever you need it to be.",
                image: "https://res.cloudinary.com/de5jbyhxx/image/upload/v1767738680/IMG_20140610_113551_fvskrb.jpg"
            },
            // New locations - January 2026
            {
                id: 41,
                title: "Tierra del Fuego",
                coords: [-54.80, -68.30],
                tag: "End of the World",
                icon: "ðŸ”ï¸",
                isDoor: false,
                shortDesc: "Where the land runs out and the wind takes over.",
                fullDesc: "The name means 'Land of Fire' but it feels more like the edge of everything.\n\nMagellan named it for the fires of the indigenous people he saw burning along the shore. Today it's a windswept wilderness at the bottom of South America, where the Andes finally surrender to the sea.",
                image: ""
            },
            {
                id: 42,
                title: "Melbourne, Australia",
                coords: [-37.81, 144.96],
                tag: "Australia's Cultural Capital",
                icon: "â˜•",
                isDoor: false,
                shortDesc: "Coffee, culture, and hidden laneways.",
                fullDesc: "Melbourne takes its coffee seriously. Very seriously.\n\nThe city's famous laneways hide street art, tiny bars, and some of the best food in the Southern Hemisphere. It's Australia's answer to Europe-cultured, cosmopolitan, and endlessly interesting.",
                image: ""
            },
            {
                id: 43,
                title: "Amazon River",
                coords: [-3.1190, -60.0217],
                tag: "Opera in the Jungle",
                icon: "ðŸŒ¿",
                isDoor: false,
                shortDesc: "Manaus - where the Amazon meets high culture.",
                imagePosition: "center",
                imageCaption: "Sunset over the Rio Negro. Manaus glows at the edge of the jungle.",
                useRichContent: true,
                richContent: `
                    <div class="demographics-strip">
                        <div class="demo-item">
                            <span class="demo-icon">ðŸ“</span>
                            <span class="demo-value">Manaus, Brazil</span>
                        </div>
                        <div class="demo-item">
                            <span class="demo-icon">ðŸ›ï¸</span>
                            <span class="demo-value">Teatro Amazonas</span>
                        </div>
                        <div class="demo-item">
                            <span class="demo-icon">ðŸš¢</span>
                            <span class="demo-value">Two Visits</span>
                        </div>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">The River Sea</span>
                        <h3 class="section-title-panel">"Like a River We Journey to the Sea"</h3>
                        <p>1,000 miles up the Amazon River is a city of two million people called Manaus.</p>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_800,q_auto,f_auto/v1768955757/IMG_6129_hwafyh.jpg" class="story-image" data-caption="Teatro Amazonas - the opera house in the jungle." alt="Teatro Amazonas exterior">
                        <p class="photo-caption-inline">Teatro Amazonas. They built this in the middle of the Amazon.</p>
                        <p>In that city is an opera house.</p>
                        <p>The Teatro Amazonas was built during the rubber boom, when Manaus was one of the richest cities on Earth. Italian marble, French chandeliers, English steel - all shipped up the river to this unlikely outpost of European grandeur.</p>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">The Opera House</span>
                        <h3 class="section-title-panel">European Grandeur in the Jungle</h3>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_800,q_auto,f_auto/v1768955858/IMG_6071_yay66j.jpg" class="story-image" data-caption="Teatro Amazonas from the front." alt="Teatro Amazonas front">
                        <div class="story-gallery-grid">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_400,q_auto,f_auto/v1768955835/IMG_6083_wcbeq4.jpg" class="story-image" data-caption="Inside the Teatro Amazonas." alt="Teatro Amazonas interior">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_400,q_auto,f_auto/v1768955810/IMG_6104_ve9cwn.jpg" class="story-image" data-caption="Teatro Amazonas details." alt="Teatro Amazonas interior details">
                        </div>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_800,q_auto,f_auto/v1768955785/IMG_6112_vqplpw.jpg" class="story-image" data-caption="At the Teatro Amazonas with the horse carriage." alt="Derrick at Teatro Amazonas with carriage">
                        <p class="photo-caption-inline">The full opera house experience.</p>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">The River</span>
                        <h3 class="section-title-panel">The Mightiest River on Earth</h3>
                        <p>The Amazon carries more water than the next seven largest rivers combined.</p>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_800,q_auto,f_auto/v1768961199/IMG_6020_yyepgk.jpg" class="story-image" data-caption="On the Amazon River." alt="Amazon River">
                        <p>Sailing up it feels like entering another world. The river is so wide in places you can't see the other side. Pink dolphins surface beside the ship. The jungle presses in from both banks, alive with sounds you've never heard.</p>
                        <p>The meeting of the waters nearby - where the black Rio Negro meets the sandy Amazon - they flow side by side without mixing for miles. Like two worlds refusing to blend.</p>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">First Visit</span>
                        <h3 class="section-title-panel">Into the Tributary</h3>
                        <p>I visited Manaus twice, two years apart. The first time, a few of us took a tributary excursion deep into the jungle - the kind of day you don't forget.</p>
                        
                        <div class="story-gallery-grid">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_400,q_auto,f_auto/v1768951523/Screenshot_20260120_142110_Facebook_sfqgia.jpg" class="story-image" data-caption="Holding a sloth - 2012 tributary excursion." alt="Derrick holding sloth">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_400,q_auto,f_auto/v1768951523/Screenshot_20260120_142041_Facebook_qa7xiz.jpg" class="story-image" data-caption="The sloth wasn't in any hurry to leave." alt="Sloth closeup">
                        </div>
                        <p class="photo-caption-inline">These guys move at their own pace. I respect that.</p>
                        
                        <div class="story-gallery-grid">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_400,q_auto,f_auto/v1768951523/Screenshot_20260120_142055_Facebook_sdm2xc.jpg" class="story-image" data-caption="Baby alligator - tributary wildlife." alt="Baby gator">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_400,q_auto,f_auto/v1768951604/Screenshot_20260120_134644_Facebook_vooudq.jpg" class="story-image" data-caption="Another young crocodilian friend." alt="Baby croc">
                        </div>
                        <p class="photo-caption-inline">The little ones are cute. The big ones... less so.</p>
                        
                        <div class="story-gallery-grid">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_400,q_auto,f_auto/v1768951518/Screenshot_20260120_142140_Facebook_fladgt.jpg" class="story-image" data-caption="A curious monkey in the Amazon." alt="Monkey">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_400,q_auto,f_auto/v1768951516/Screenshot_20260120_142200_Facebook_m2ofot.jpg" class="story-image" data-caption="Bird's nest in the canopy." alt="Tree with nest">
                        </div>
                        
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_800,q_auto,f_auto/v1768951604/Screenshot_20260120_134703_Facebook_imcpbv.jpg" class="story-image" data-caption="A floating market along the tributary." alt="Jungle market">
                        <p class="photo-caption-inline">Commerce finds a way, even in the middle of the Amazon.</p>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">Second Visit</span>
                        <h3 class="section-title-panel">Getting Lost</h3>
                        <p>The second time was different. I stayed aboard until late afternoon, then ventured out alone into the west dock area.</p>
                        <p>My GPS went nuts. Took me somewhere I definitely wasn't supposed to be.</p>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_800,q_auto,f_auto/v1768962276/IMG_6023_l1kkqd.jpg" class="story-image" data-caption="Lost in Manaus." alt="Lost in Manaus">
                        <p class="photo-caption-inline">This is the part where you start questioning your decisions.</p>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_800,q_auto,f_auto/v1768962223/IMG_6027_ymbkko.jpg" class="story-image" data-caption="Still lost in Manaus." alt="Still lost">
                        <p class="photo-caption-inline">Still lost.</p>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_800,q_auto,f_auto/v1768962156/IMG_6032_rcjr8i.jpg" class="story-image" data-caption="Lost some more in Manaus." alt="Lost some more">
                        <p class="photo-caption-inline">Lost some more. It felt like this - but worse.</p>
                        <p>That uneasy feeling of being somewhere you shouldn't be, not knowing which way leads back to safety.</p>
                        <p>Eventually I found a port. The wrong end. But at least I knew the ship was <em>somewhere</em> along this water.</p>
                        <p>Finding the ship again was one of the better moments of that trip.</p>
                    </div>
                    
                    <div class="more-info-container" onclick="this.classList.toggle('active')">
                        <button class="more-info-btn">
                            <span class="info-icon">ðŸ’¡</span>
                            <span>More about this location</span>
                        </button>
                        <div class="more-info-popup">
                            <div class="popup-title">
                                <span class="title-icon">ðŸŒ¿</span>
                                <span>Manaus & The Amazon</span>
                            </div>
                            <ul class="fun-facts-list">
                                <li><strong>River Volume:</strong> The Amazon discharges more water than the next seven largest rivers combined - about 20% of all freshwater that flows into the world's oceans.</li>
                                <li><strong>Meeting of the Waters:</strong> Near Manaus, the black Rio Negro meets the sandy Rio SolimÃµes. They flow side by side without mixing for over 3 miles due to differences in temperature, speed, and density.</li>
                                <li><strong>Rubber Boom:</strong> In the late 1800s, Manaus was one of the wealthiest cities on Earth. The rubber barons sent their laundry to Europe and built an opera house in the jungle.</li>
                                <li><strong>Teatro Amazonas:</strong> Opened in 1896 with materials imported from Europe - Italian marble, Scottish steel, French tiles. The dome features 36,000 tiles in the colors of the Brazilian flag.</li>
                                <li><strong>Pink Dolphins:</strong> The Amazon river dolphin (boto) is the largest freshwater dolphin species. Local legend says they transform into handsome men at night.</li>
                            </ul>
                        </div>
                    </div>
                    
                    ${generateGallery('amazon')}
                `,
                fullDesc: "1,000 miles up the Amazon River is a city of two million people called Manaus. In that city is an opera house - the Teatro Amazonas, built during the rubber boom. I visited twice - the first time on a tributary excursion deep into the jungle, the second time I got lost in the west docks.",
                image: "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768952174/IMG_6136_bkdyes.jpg"
            },
            {
                id: 44,
                title: "Quebec City, Canada",
                coords: [46.81, -71.21],
                tag: "New France",
                icon: "ðŸ°",
                isDoor: false,
                shortDesc: "A piece of Europe in North America.",
                fullDesc: "Quebec City is the only walled city north of Mexico.\n\nThe old town feels transported from France-cobblestone streets, sidewalk cafÃ©s, the imposing ChÃ¢teau Frontenac watching over it all. In winter, it transforms into a snow-covered fairy tale.",
                image: ""
            },
            {
                id: 45,
                title: "Rio de Janeiro, Brazil",
                coords: [-22.91, -43.17],
                tag: "Cidade Maravilhosa",
                icon: "ðŸŽ­",
                isDoor: false,
                shortDesc: "The marvelous city between mountains and sea.",
                imagePosition: "center",
                useRichContent: true,
                richContent: `
                    <div class="demographics-strip">
                        <div class="demo-item">
                            <span class="demo-icon">ðŸ“</span>
                            <span class="demo-value">Guanabara Bay</span>
                        </div>
                        <div class="demo-item">
                            <span class="demo-icon">ðŸ–ï¸</span>
                            <span class="demo-value">Copacabana</span>
                        </div>
                        <div class="demo-item">
                            <span class="demo-icon">âœï¸</span>
                            <span class="demo-value">Cristo Redentor</span>
                        </div>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">The Marvelous City</span>
                        <h3 class="section-title-panel">A City That Keeps You</h3>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_800,q_auto,f_auto/v1768952763/IMG_6391_Large_kingel.jpg" class="story-image" data-caption="The famous SelarÃ³n Steps - a mosaic tribute to Rio." alt="SelarÃ³n Steps with RIO letters">
                        <p class="photo-caption-inline">The SelarÃ³n Steps. Rio wants you to know where you are.</p>
                        <p>Every time I disembarked in Rio, I got lost.</p>
                        <p>Something about this city seemed to want to keep me there. Nothing was ever easy - until I finally reached the beach.</p>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">The Standoff</span>
                        <h3 class="section-title-panel">Trapped in Copacabana</h3>
                        <p>I wandered deep into Copacabana and found a little cafeteria with servers - not quite a restaurant, but close enough. I ordered, ate, and went to pay.</p>
                        <p>My credit card wouldn't work.</p>
                        <p>No cash. No Portuguese. The guy at the register didn't speak English. Someone next to him started translating. I called my bank - they said it wasn't their fault. <em>Yada yada.</em></p>
                        <p>Here's the thing: this must happen often at this particular place, because they had a thick metal gate across the doors. To keep people from running.</p>
                        <p>After several frantic minutes of explaining, gesturing, phone calls, and what I can only describe as <em>international panic</em>... he punched my number in manually.</p>
                        <p><strong>Bingo.</strong> I was free.</p>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">The Ascent</span>
                        <h3 class="section-title-panel">Cristo Redentor</h3>
                        <p>Another time, I took the tram up to Christ the Redeemer. Got held up on the return trip. Because of course I did.</p>
                        <p>But I made it to the top.</p>
                        <div class="story-gallery-grid">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_400,q_auto,f_auto/v1768952612/IMG_6283_kikfgu.jpg" class="story-image" data-caption="Made it to the top - Cristo Redentor." alt="Derrick at Christ the Redeemer">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_400,q_auto,f_auto/v1768953058/IMG_6305_qqetec.jpg" class="story-image" data-caption="The view from Corcovado." alt="View from Christ the Redeemer">
                        </div>
                        <p class="photo-caption-inline">Christ the Redeemer watches over everything. Including lost musicians.</p>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">The Favela</span>
                        <h3 class="section-title-panel">Into the Hills</h3>
                        <p>We took a tour into the favelas - a side of Rio most tourists don't see.</p>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_800,q_auto,f_auto/v1768952929/IMG_6333_gg6lzs.jpg" class="story-image" data-caption="Heading into the heart of the favela." alt="Entering the favela">
                        <p class="photo-caption-inline">Heading into the heart of the favela.</p>
                        <div class="story-gallery-grid">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_400,q_auto,f_auto/v1768953014/IMG_6331_kvzk2o.jpg" class="story-image" data-caption="Life in the favela." alt="Favela street scene">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_400,q_auto,f_auto/v1768952486/IMG_6346_lcg34g.jpg" class="story-image" data-caption="Taking a break with a popsicle." alt="Derrick eating popsicle in favela">
                        </div>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_800,q_auto,f_auto/v1768952860/IMG_6350_kjpilj.jpg" class="story-image" data-caption="Another favela tour moment." alt="Favela tour">
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">The Reward</span>
                        <h3 class="section-title-panel">Finally, the Beach</h3>
                        <p>Nothing was easy in Rio. Until I reached the beach and had a Corona.</p>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_800,q_auto,f_auto/v1768953816/IMG_6366_h1ih0q.jpg" class="story-image" data-caption="Copacabana Beach - where the chaos finally stops." alt="Copacabana Beach">
                        <p class="photo-caption-inline">Copacabana. Worth every wrong turn.</p>
                    </div>
                    
                    ${generateGallery('rio')}
                `,
                fullDesc: "Every time I disembarked in Rio, I got lost. Something about this city wanted to keep me there. Credit cards that wouldn't work, trams that got held up, metal gates across restaurant doors. Nothing was easy - until I finally reached Copacabana and had a Corona.",
                image: ""
            },
            {
                id: 46,
                title: "Portovenere, Italy",
                coords: [44.05, 9.84],
                tag: "Poet's Paradise",
                icon: "ðŸ›ï¸",
                isDoor: false,
                shortDesc: "Where Byron swam to visit Shelley.",
                fullDesc: "Portovenere sits at the tip of a rugged peninsula, guarding the entrance to the Cinque Terre.\n\nLord Byron loved this place so much he swam across the bay to visit Shelley. The grotto where he contemplated the waves is now named for him. Pastel houses stack up the hillside, and the Church of St. Peter perches dramatically on the rocks.",
                image: ""
            },
            {
                id: 47,
                title: "Hobart, Tasmania",
                coords: [-42.88, 147.33],
                tag: "Island at the Edge",
                icon: "ðŸ”ï¸",
                isDoor: false,
                shortDesc: "Australia's southern outpost, gateway to Antarctica.",
                fullDesc: "Hobart sits in the shadow of Mount Wellington, looking out toward the pole.\n\nThis is where Antarctic expeditions provision and where the cleanest air on Earth blows in from the Southern Ocean. The Saturday Salamanca Market is legendary. MONA, the underground art museum, is unlike anything else on the planet.",
                image: ""
            },
            {
                id: 48,
                title: "Saguenay, Canada",
                coords: [48.43, -71.07],
                tag: "The Fjord",
                icon: "ðŸŒ²",
                isDoor: false,
                shortDesc: "Where whales come to the river.",
                fullDesc: "The Saguenay Fjord cuts deep into the Canadian Shield.\n\nBeluga whales gather where the cold fjord waters meet the St. Lawrence. The cliffs rise hundreds of feet on either side. In autumn, the forests explode in red and gold.",
                image: ""
            },
            {
                id: 49,
                title: "Hong Kong",
                coords: [22.32, 114.17],
                tag: "Fragrant Harbour",
                icon: "ðŸŒƒ",
                isDoor: false,
                shortDesc: "Where East meets West in a forest of towers.",
                fullDesc: "Hong Kong's skyline is the most dramatic on Earth.\n\nBy day, the harbor bustles with ferries and junks. By night, the Symphony of Lights turns the waterfront into a laser show. Dim sum carts rattle through morning restaurants. The Peak Tram climbs impossibly steep streets. Tradition and modernity collide on every corner.",
                image: ""
            },
            {
                id: 50,
                title: "Florence, Italy",
                coords: [43.77, 11.25],
                tag: "Birthplace of the Renaissance",
                icon: "ðŸŽ¨",
                isDoor: false,
                shortDesc: "Where art and beauty were reinvented.",
                fullDesc: "Every street corner in Florence holds a masterpiece.\n\nMichelangelo's David. Brunelleschi's dome. The Uffizi's treasures. The Medici built this city into a monument to human achievement. Walking across the Ponte Vecchio at sunset, you understand why artists have been coming here for six hundred years.",
                image: ""
            },
            {
                id: 51,
                title: "Stromboli, Italy",
                coords: [38.79, 15.21],
                tag: "Lighthouse of the Mediterranean",
                icon: "ðŸŒ‹",
                isDoor: false,
                shortDesc: "The volcano that never sleeps.",
                fullDesc: "Stromboli has been erupting continuously for over 2,000 years.\n\nSailors have used its glow to navigate these waters since ancient times. We anchored offshore at night and watched the orange explosions light up the sky every few minutes. The island itself is just the volcano-a few hundred people living on its slopes, trusting it to behave.",
                image: ""
            },
            {
                id: 52,
                title: "San Remo, Italy",
                coords: [43.82, 7.78],
                tag: "City of Flowers",
                icon: "ðŸŒ¸",
                isDoor: false,
                shortDesc: "Riviera glamour and the Italian Song Festival.",
                fullDesc: "San Remo is where Italy comes to vacation.\n\nThe Casino is legendary. The flower market supplies much of Europe. Every February, the Sanremo Music Festival launches Italian pop careers. The old town climbs the hillside in a tangle of medieval streets.",
                image: ""
            },
            {
                id: 53,
                title: "Roses, Spain",
                coords: [42.26, 3.18],
                tag: "DalÃ­'s Coast",
                icon: "ðŸŽ¨",
                isDoor: false,
                shortDesc: "Where Catalonia meets the sea.",
                fullDesc: "Roses sits on the Costa Brava-the 'wild coast'-near where Salvador DalÃ­ made his home.\n\nThe bay is one of the most beautiful in the Mediterranean. The Greek ruins at EmpÃºries are nearby. El Bulli, once the world's best restaurant, was just down the road. This corner of Catalonia punches above its weight.",
                image: ""
            },
            {
                id: 54,
                title: "Propriano, Corsica",
                coords: [41.68, 8.90],
                tag: "Napoleon's Island",
                icon: "â›µ",
                isDoor: false,
                shortDesc: "Wild beauty on the Isle of Beauty.",
                fullDesc: "Corsica is France, but barely.\n\nThe island has its own language, its own cuisine, its own fierce sense of identity. Propriano sits in the Gulf of Valinco, backed by mountains that drop straight to the sea. Napoleon was born just up the coast. The maquis-the fragrant scrubland-perfumes the air.",
                image: ""
            },
            {
                id: 55,
                title: "Marseille, France",
                coords: [43.30, 5.37],
                tag: "France's Port",
                icon: "âš“",
                isDoor: false,
                shortDesc: "Gritty, gorgeous, and unapologetically itself.",
                fullDesc: "Marseille is France's oldest city and its most diverse.\n\nThe Old Port has welcomed ships for 2,600 years. The bouillabaisse is non-negotiable. The Calanques-limestone cliffs plunging into turquoise water-rival any coastline in the world. This isn't Paris. Marseille doesn't care.",
                image: ""
            },
            {
                id: 56,
                title: "Le Lavandou, France",
                coords: [43.14, 6.37],
                tag: "Twelve Beaches",
                icon: "ðŸ–ï¸",
                isDoor: false,
                shortDesc: "A dozen different beaches on one small stretch.",
                fullDesc: "Le Lavandou is named for the lavender that once grew on these hills.\n\nThe town claims twelve distinct beaches, each with its own character. The ÃŽles d'HyÃ¨res float offshore. The light here attracted painters long before the tourists came.",
                image: ""
            },
            {
                id: 57,
                title: "Monte Carlo, Monaco",
                coords: [43.74, 7.43],
                tag: "Playground of the Rich",
                icon: "ðŸŽ°",
                isDoor: false,
                shortDesc: "Where fortunes are won and lost in style.",
                fullDesc: "Monaco is two square kilometers of concentrated wealth.\n\nThe Casino is palatial. The Grand Prix tears through the streets every May. The yachts in the harbor cost more than most neighborhoods. It's absurd and glamorous and nothing quite like anywhere else.",
                image: ""
            },
            {
                id: 58,
                title: "Corfu, Greece",
                coords: [39.62, 19.92],
                tag: "The Venetian Island",
                icon: "ðŸ›ï¸",
                isDoor: false,
                shortDesc: "Greek island with an Italian accent.",
                fullDesc: "Corfu was Venetian for four hundred years, and it shows.\n\nThe old town has more in common with Venice than Athens. The Liston arcade could be in Bologna. But the olive groves and the crystal water are unmistakably Greek. Gerald Durrell grew up here. The Empress Sissi built her palace on the hill.",
                image: ""
            },
            {
                id: 59,
                title: "Celukan Bawang, Indonesia",
                coords: [-8.15, 114.85],
                tag: "Hidden Bali",
                icon: "ðŸŒº",
                isDoor: false,
                shortDesc: "The Bali tourists don't see.",
                fullDesc: "On Bali's quiet north coast, life moves at a different pace.\n\nNo crowds, no clubs-just fishing villages, black sand beaches, and terraced rice paddies climbing the volcanic slopes. This is the Bali that existed before the tourists came.",
                image: ""
            },
            {
                id: 60,
                title: "Penang, Malaysia",
                coords: [5.42, 100.33],
                tag: "Pearl of the Orient",
                icon: "ðŸœ",
                isDoor: false,
                shortDesc: "Where cultures collide deliciously.",
                fullDesc: "Penang might have the best street food on Earth.\n\nChinese, Malay, Indian, Thai-all mixing in the hawker centers of George Town. The colonial architecture is UNESCO-protected. The temples are kaleidoscopic. Every meal is an adventure.",
                image: ""
            },
            {
                id: 61,
                title: "Dubai, UAE",
                coords: [25.20, 55.27],
                tag: "City of the Future",
                icon: "ðŸ™ï¸",
                isDoor: false,
                shortDesc: "Where ambition knows no limits.",
                fullDesc: "Dubai shouldn't exist, and yet it does.\n\nA forest of impossible towers rising from the desert. Indoor ski slopes and artificial islands. The tallest building on Earth watching over it all. It's a monument to what happens when money and ambition have no restraints.",
                image: ""
            },
            {
                id: 113,
                title: "Doha, Qatar",
                coords: [25.29, 51.53],
                tag: "Pearl of the Gulf",
                icon: "ðŸ’Ž",
                isDoor: false,
                shortDesc: "Where tradition meets limitless ambition.",
                fullDesc: "Doha rose from the desert like a mirage made real.\n\nThe skyline is a showcase of architectural ambition-towers twisting and curving in impossible shapes. But walk through Souq Waqif and you're back in old Arabia, haggling over spices and textiles. The Museum of Islamic Art alone is worth the visit.",
                image: ""
            },
            {
                id: 62,
                title: "Red Sea Transit",
                coords: [12.60, 43.30],
                tag: "Armed Escort",
                icon: "âš“",
                isDoor: false,
                shortDesc: "Military convoy through pirate waters.",
                fullDesc: "This is where the tension began.\n\nShips don't just cruise through the Gulf of Aden and Red Sea casually. The threat of Somali piracy meant armed escorts, convoy formations, and a few days of heightened alertness. Fire hoses at the ready, extra watches posted, and the surreal sight of naval vessels flanking a cruise ship full of passengers sipping cocktails.",
                image: ""
            },
            {
                id: 118,
                title: "Suez Canal, Egypt",
                coords: [30.45, 32.35],
                tag: "The Shortcut",
                icon: "ðŸš¢",
                isDoor: false,
                shortDesc: "The passage that changed world trade.",
                fullDesc: "The Suez Canal is 120 miles of engineering audacity.\n\nBefore it opened in 1869, ships had to sail around Africa. Now the desert slides past on both sides as you transit between the Mediterranean and the Red Sea. Camels watch from the banks. It's surreal.",
                image: ""
            },
            {
                id: 112,
                title: "Sharm El Sheikh, Egypt",
                coords: [27.92, 34.33],
                tag: "Red Sea Riviera",
                icon: "ðŸ¤¿",
                isDoor: false,
                shortDesc: "World-class diving at the tip of Sinai.",
                fullDesc: "Sharm El Sheikh sits at the southern tip of the Sinai Peninsula where the Gulf of Aqaba meets the Gulf of Suez.\n\nThe coral reefs here are legendary-Ras Mohammed National Park is considered one of the top dive sites in the world. Crystal clear water, walls of colorful fish, and dramatic drop-offs into the deep blue.",
                image: ""
            },
            {
                id: 63,
                title: "Istanbul, Turkey",
                coords: [41.01, 28.98],
                tag: "Where Continents Meet",
                icon: "ðŸ•Œ",
                isDoor: false,
                shortDesc: "Two continents, one magnificent city.",
                fullDesc: "Istanbul is the only city on Earth that spans two continents.\n\nThe Hagia Sophia. The Blue Mosque. The Grand Bazaar's endless warrens. The Bosphorus churning between Europe and Asia. Call to prayer mixing with ship horns. This city has been the center of empires for two thousand years, and it still feels like the center of something.",
                image: ""
            },
            {
                id: 64,
                title: "Panama Canal",
                coords: [9.08, -79.68],
                tag: "The Big Ditch",
                icon: "ðŸš¢",
                isDoor: false,
                shortDesc: "The shortcut between oceans.",
                fullDesc: "The Panama Canal is one of humanity's greatest engineering achievements.\n\nTransiting through the locks, rising and falling between oceans, you feel the scale of what they built here. Ships from every nation queue to pass through. The jungle presses in from both sides. Connecting two oceans changed the world.",
                image: ""
            },
            {
                id: 117,
                title: "San Juan, Puerto Rico",
                coords: [18.47, -66.12],
                tag: "Caribbean Colors",
                icon: "ðŸ°",
                isDoor: false,
                shortDesc: "Where Spanish colonial history meets Caribbean soul.",
                fullDesc: "Old San Juan is a living postcard.\n\nCobblestone streets wind between pastel buildings. El Morro fortress guards the harbor as it has for 500 years. The rum flows freely, the music spills out of every doorway, and the mix of Spanish, African, and TaÃ­no cultures creates something uniquely Puerto Rican.",
                image: ""
            },
            {
                id: 65,
                title: "Yalta, Ukraine",
                coords: [44.50, 34.17],
                tag: "Crimean Jewel",
                icon: "ðŸ°",
                isDoor: false,
                shortDesc: "Where history was made on the Black Sea.",
                fullDesc: "Yalta is where Roosevelt, Churchill, and Stalin divided up the post-war world.\n\nBut before the conference, it was the Russian Riviera-Tsars built palaces along this coast. The Swallow's Nest castle clings impossibly to its cliff. The Black Sea stretches to the horizon.",
                image: ""
            },
            {
                id: 66,
                title: "Muscat, Oman",
                coords: [23.59, 58.54],
                tag: "Arabia's Hidden Gem",
                icon: "ðŸ•Œ",
                isDoor: false,
                shortDesc: "Ancient Arabia with a modern soul.",
                fullDesc: "Muscat is what you hope the Middle East will be.\n\nThe Sultan Qaboos Grand Mosque is breathtaking. The old souks smell of frankincense. The mountains plunge to the sea. Oman has oil wealth but wears it lightly-this is Arabia without the excess.",
                image: ""
            },
            {
                id: 67,
                title: "Nessebar, Bulgaria",
                coords: [42.66, 27.73],
                tag: "The Black Sea Pearl",
                icon: "ðŸ›ï¸",
                isDoor: false,
                shortDesc: "Ancient city on a tiny peninsula.",
                fullDesc: "Nessebar packs 3,000 years of history onto a peninsula barely larger than a football field.\n\nGreek ruins, Byzantine churches, Ottoman houses-all crammed together on streets barely wide enough to walk. The Black Sea surrounds it on three sides. UNESCO calls it one of Europe's richest towns for historic buildings.",
                image: ""
            },
            {
                id: 68,
                title: "Venice, Italy",
                coords: [45.44, 12.32],
                tag: "La Serenissima",
                icon: "ðŸŽ­",
                isDoor: false,
                shortDesc: "The impossible city built on water.",
                fullDesc: "Venice shouldn't exist, but it does-and has for over a thousand years.\n\nNo cars, no roads-just canals, bridges, and the most beautiful decay you'll ever see. The Piazza San Marco floods with acqua alta and tourists alike. Gondoliers navigate waters their families have worked for generations. Every corner reveals another impossible view.",
                image: ""
            },
            {
                id: 69,
                title: "Perth, Australia",
                coords: [-31.95, 115.86],
                tag: "The Isolated City",
                icon: "ðŸŒ…",
                isDoor: false,
                shortDesc: "The most remote major city on Earth.",
                fullDesc: "Perth is closer to Singapore than to Sydney.\n\nThat isolation shapes everything about the place-the laid-back vibe, the pristine beaches, the feeling that you've reached the edge of the world. The Swan River cuts through the city, and the sunsets over the Indian Ocean are legendary.",
                image: ""
            },
            {
                id: 70,
                title: "Adelaide, Australia",
                coords: [-34.93, 138.60],
                tag: "City of Churches",
                icon: "ðŸ·",
                isDoor: false,
                shortDesc: "Wine country meets festival city.",
                fullDesc: "Adelaide was planned from the start-a grid of wide streets surrounded by parkland.\n\nThe Barossa Valley is just up the road, producing some of the world's best shiraz. The city transforms during festival season, punching well above its weight in arts and culture. It's Australia's most underrated city.",
                image: ""
            },
            {
                id: 71,
                title: "Broome, Australia",
                coords: [-17.96, 122.24],
                tag: "Pearl of the Kimberley",
                icon: "ðŸª",
                isDoor: false,
                shortDesc: "Where the outback meets the ocean.",
                fullDesc: "Broome was built on pearls and still has that frontier feel.\n\nCable Beach stretches for 22 kilometers of white sand. Camels walk the shoreline at sunset-a tradition from the Afghan cameleers who helped build the outback. The red pindan cliffs meet turquoise water. It's Australia at its most dramatic.",
                image: ""
            },
            {
                id: 72,
                title: "Izmir, Turkey",
                coords: [38.42, 27.14],
                tag: "Pearl of the Aegean",
                icon: "ðŸ›ï¸",
                isDoor: false,
                shortDesc: "Turkey's relaxed Aegean gem.",
                fullDesc: "Izmir has been a port city for three thousand years.\n\nThe ancient agora still stands in the city center. The waterfront promenade stretches for miles. The bazaar is less touristy than Istanbul's but just as atmospheric. This is Turkey's most progressive city, looking west across the Aegean toward Greece.",
                image: ""
            },
            {
                id: 73,
                title: "Haifa, Israel",
                coords: [32.79, 34.99],
                tag: "City on the Mountain",
                icon: "ðŸŒº",
                isDoor: false,
                shortDesc: "Where the BahÃ¡'Ã­ gardens cascade to the sea.",
                fullDesc: "Haifa climbs Mount Carmel in terraces.\n\nThe BahÃ¡'Ã­ Gardens are the showstopper-nineteen terraces of immaculate gardens cascading down the mountainside to the Mediterranean. Arabs and Jews live here in relative harmony. The German Colony serves excellent hummus. It's Israel's most liveable city.",
                image: ""
            },
            {
                id: 74,
                title: "Parga, Greece",
                coords: [39.28, 20.40],
                tag: "Hidden Riviera",
                icon: "ðŸ°",
                isDoor: false,
                shortDesc: "A colorful village on the Ionian coast.",
                fullDesc: "Parga tumbles down to its harbor in a cascade of pastel houses.\n\nThe Venetian castle watches over it all. The beaches nearby are some of Greece's best-kept secrets. Tour groups head to Corfu; those who know come here instead. It feels like the Greek islands, but it's on the mainland.",
                image: ""
            },
            {
                id: 75,
                title: "Hvar, Croatia",
                coords: [43.17, 16.44],
                tag: "Croatian Glamour",
                icon: "â›µ",
                isDoor: false,
                shortDesc: "Where yachts and lavender fields meet.",
                fullDesc: "Hvar has been famous since the ancient Greeks arrived.\n\nNow it's Croatia's answer to St. Tropez-superyachts in the harbor, beach clubs on the islands nearby, the beautiful and fashionable crowding the marble streets. But climb to the fortress above town and it's just you, the lavender-scented breeze, and views across a hundred islands.",
                image: ""
            },
            {
                id: 76,
                title: "ConstanÈ›a, Romania",
                coords: [44.18, 28.63],
                tag: "Black Sea Gateway",
                icon: "âš“",
                isDoor: false,
                shortDesc: "Romania's window to the Black Sea.",
                fullDesc: "Placeholder description for ConstanÈ›a.",
                image: ""
            },
            {
                id: 77,
                title: "Ã‡eÅŸme, Turkey",
                coords: [38.32, 26.31],
                tag: "Aegean Resort",
                icon: "âš“",
                isDoor: false,
                shortDesc: "Wind, waves, and Turkish hospitality.",
                fullDesc: "Placeholder description for Ã‡eÅŸme.",
                image: ""
            },
            {
                id: 78,
                title: "Katakolon, Greece",
                coords: [37.64, 21.32],
                tag: "Gateway to Olympia",
                icon: "ðŸ›ï¸",
                isDoor: false,
                shortDesc: "Where the Olympic flame begins its journey.",
                fullDesc: "Placeholder description for Katakolon.",
                image: ""
            },
            {
                id: 79,
                title: "Odessa, Ukraine",
                coords: [46.48, 30.73],
                tag: "Pearl of the Black Sea",
                icon: "âš“",
                isDoor: false,
                shortDesc: "Opera, architecture, and the famous steps.",
                fullDesc: "Placeholder description for Odessa.",
                image: ""
            },
            {
                id: 80,
                title: "KuÅŸadasÄ±, Turkey",
                coords: [37.86, 27.26],
                tag: "Near Ancient Ephesus",
                icon: "ðŸ›ï¸",
                isDoor: false,
                shortDesc: "Gateway to one of the ancient world's great cities.",
                fullDesc: "Placeholder description for KuÅŸadasÄ±.",
                image: ""
            },
            {
                id: 81,
                title: "Mykonos, Greece",
                coords: [37.45, 25.33],
                tag: "Cycladic Icon",
                icon: "ðŸ›ï¸",
                isDoor: false,
                shortDesc: "Windmills, whitewash, and legendary nightlife.",
                fullDesc: "Placeholder description for Mykonos.",
                image: ""
            },
            {
                id: 82,
                title: "Nafplio, Greece",
                coords: [37.57, 22.80],
                tag: "First Capital",
                icon: "ðŸ›ï¸",
                isDoor: false,
                shortDesc: "Greece's first capital, still charming.",
                fullDesc: "Placeholder description for Nafplio.",
                image: ""
            },
            {
                id: 83,
                title: "Pylos, Greece",
                coords: [36.91, 21.70],
                tag: "Nestor's Kingdom",
                icon: "ðŸ›ï¸",
                isDoor: false,
                shortDesc: "Homer wrote about this bay.",
                fullDesc: "Placeholder description for Pylos.",
                image: ""
            },
            {
                id: 84,
                title: "Ravenna, Italy",
                coords: [44.42, 12.20],
                tag: "Byzantine Mosaics",
                icon: "ðŸ›ï¸",
                isDoor: false,
                shortDesc: "The mosaics here will leave you speechless.",
                fullDesc: "Placeholder description for Ravenna.",
                image: ""
            },
            {
                id: 85,
                title: "Å ibenik, Croatia",
                coords: [43.73, 15.89],
                tag: "Cathedral City",
                icon: "â›µ",
                isDoor: false,
                shortDesc: "UNESCO-listed cathedral, Game of Thrones location.",
                fullDesc: "Placeholder description for Å ibenik.",
                image: ""
            },
            {
                id: 86,
                title: "Zakynthos, Greece",
                coords: [37.79, 20.90],
                tag: "Shipwreck Beach",
                icon: "ðŸ›ï¸",
                isDoor: false,
                shortDesc: "That famous beach with the rusted ship.",
                fullDesc: "Placeholder description for Zakynthos.",
                image: ""
            },
            {
                id: 87,
                title: "Itea, Greece",
                coords: [38.43, 22.42],
                tag: "Gateway to Delphi",
                icon: "ðŸ›ï¸",
                isDoor: false,
                shortDesc: "The port for the Oracle's mountain.",
                fullDesc: "Placeholder description for Itea.",
                image: ""
            },
            {
                id: 88,
                title: "Surabaya, Indonesia",
                coords: [-7.25, 112.75],
                tag: "Java's Second City",
                icon: "âš“",
                isDoor: false,
                shortDesc: "Indonesia's gritty, bustling port city.",
                fullDesc: "Placeholder description for Surabaya.",
                image: ""
            },
            {
                id: 89,
                title: "Semarang, Indonesia",
                coords: [-6.97, 110.42],
                tag: "Central Java",
                icon: "âš“",
                isDoor: false,
                shortDesc: "Gateway to Borobudur.",
                fullDesc: "Placeholder description for Semarang.",
                image: ""
            },
            {
                id: 90,
                title: "Christmas Island",
                coords: [-10.49, 105.63],
                tag: "Red Crab Migration",
                icon: "ðŸ¦€",
                isDoor: false,
                shortDesc: "Australia's remote island in the Indian Ocean.",
                fullDesc: "Placeholder description for Christmas Island.",
                image: ""
            },
            {
                id: 91,
                title: "Dili, East Timor",
                coords: [-8.56, 125.57],
                tag: "New Nation",
                icon: "âš“",
                isDoor: false,
                shortDesc: "The world's newest nation, just after the war ended.",
                fullDesc: "Placeholder description for Dili.",
                image: ""
            },
            {
                id: 92,
                title: "Phuket, Thailand",
                coords: [7.88, 98.39],
                tag: "A Lesson I'll Never Forget",
                icon: "ðŸï¸",
                isDoor: false,
                shortDesc: "Thailand's island jewel - and a close call.",
                imagePosition: "center",
                useRichContent: true,
                richContent: `
                    <div class="demographics-strip">
                        <div class="demo-item">
                            <span class="demo-icon">ðŸ“</span>
                            <span class="demo-value">Andaman Sea</span>
                        </div>
                        <div class="demo-item">
                            <span class="demo-icon">ðŸ–ï¸</span>
                            <span class="demo-value">Patong Beach</span>
                        </div>
                        <div class="demo-item">
                            <span class="demo-icon">ðŸ™</span>
                            <span class="demo-value">Thailand</span>
                        </div>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">Paradise</span>
                        <h3 class="section-title-panel">Thailand's Island Jewel</h3>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_800,q_auto,f_auto/v1768865640/IMG_20131113_105615_yzzp1y.jpg" class="story-image" data-caption="Temple gate in Phuket." alt="Temple gate, Phuket">
                        <p class="photo-caption-inline">Phuket's temples and traditions.</p>
                        <p>Phuket taught me a lesson I'll never forget.</p>
                        <p>The Cruise Director had given me the day off - a rare occurrence on an overnight. A walk through town. Looking for something to eat, maybe a drink.</p>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">The Night</span>
                        <h3 class="section-title-panel">One Beer. One Shot. One Roofie.</h3>
                        <p>I found a bar with giant jungle animals painted on the walls. Seemed friendly enough. I sat down and started chatting with the bloke next to me - a "shoe salesman from Croatia," or so he said.</p>
                        <p>A few minutes into our conversation, one of the girls from behind the bar got off work - or so she said - and sat down on my other side.</p>
                        <p>Just friendly conversation. My radar was up, and I didn't sense anything was off.</p>
                        <p>One beer. One shot.</p>
                        <p>Then the woman asked if I was alone. Something finally clicked. I waved to a bunch of random people in the corner like I knew them.</p>
                        <p>The next thing I remember, I'm stumbling toward the bathroom. Then nothing.</p>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">The Rescue</span>
                        <h3 class="section-title-panel">The Reason I'm Still Here</h3>
                        <p>I woke up slouched against a urinal. I couldn't stand. I couldn't think straight.</p>
                        <p>Then I heard a voice: "Hey - that's Derrick!"</p>
                        <p>A hand grabbed me. Pulled my arm over a shoulder. Got me out of there.</p>
                        <p>Martin Neese. A fellow musician. A friend. I may have had a few more minutes before I was robbed - or worse - when he walked in and saw me.</p>
                        <p>Here's the thing: I had walked around Phuket all day. Downtown, the beaches, everywhere. I hadn't run into a single crew member. Not one. And then, the one moment I really needed someone - there was Martin.</p>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_800,q_auto,f_auto/v1768866121/IMG_19700105_041151_dliaia.jpg" class="story-image" data-caption="My good friends Martin Neese and Yolonda Barber - Martin is the reason I'm still here to tell this story." alt="Martin Neese and Yolonda Barber">
                        <p class="photo-caption-inline">My good friends Martin Neese and Yolonda Barber. Martin is the reason I'm still here to tell this story.</p>
                        <p>He got me back to the ship safely. No incident report. No questions. Just back on board, alive, lesson learned the hard way.</p>
                        <p>Unreal, right? Close call.</p>
                    </div>
                    
                    <div class="story-section-panel">
                        <span class="section-tag-panel">The Beauty</span>
                        <h3 class="section-title-panel">What Phuket Should Be</h3>
                        <p>Despite everything, Phuket is beautiful. The beaches, the sunsets, the food carts on every corner. I went back to the island on later trips - carefully. And I saw the Phuket that most people see.</p>
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_800,q_auto,f_auto/v1768865557/PANO_20131118_134025_qd3r7o.jpg" class="story-image" data-caption="Beach day panorama - Phuket." alt="Phuket beach panorama">
                        <p class="photo-caption-inline">The Phuket you're supposed to remember.</p>
                        
                        <div class="story-gallery-grid">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_400,q_auto,f_auto/v1768865556/IMG_20131118_135639_wcs0ae.jpg" class="story-image" data-caption="Fresh fruit cart - Phuket streets." alt="Fruit cart">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_400,q_auto,f_auto/v1768865556/IMG_20131118_164928_wge65r.jpg" class="story-image" data-caption="Patong Beach entrance at evening." alt="Patong Beach entrance">
                        </div>
                        
                        <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_800,q_auto,f_auto/v1768865557/PANO_20131118_182257_b9tvli.jpg" class="story-image" data-caption="Sunset over Phuket." alt="Phuket sunset panorama">
                        <p class="photo-caption-inline">Sunset over the Andaman Sea.</p>
                        
                        <div class="story-gallery-grid">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_400,q_auto,f_auto/v1768865679/IMG_20131118_184137_1_toim78.jpg" class="story-image" data-caption="Making friends with the local wildlife." alt="Derrick with iguana">
                            <img src="https://res.cloudinary.com/de5jbyhxx/image/upload/w_400,q_auto,f_auto/v1768865556/IMG_20131118_184140_zmbgko.jpg" class="story-image" data-caption="Another day in paradise." alt="Phuket evening">
                        </div>
                    </div>
                    
                    <div class="more-info-container" onclick="this.classList.toggle('active')">
                        <button class="more-info-btn">
                            <span class="info-icon">ðŸ’¡</span>
                            <span>More about this location</span>
                        </button>
                        <div class="more-info-popup">
                            <div class="popup-title">
                                <span class="title-icon">ðŸï¸</span>
                                <span>Phuket, Thailand</span>
                            </div>
                            <ul class="fun-facts-list">
                                <li><strong>Thailand's Largest Island:</strong> Phuket is roughly the size of Singapore, with about 400,000 permanent residents and millions of tourists annually.</li>
                                <li><strong>The Andaman Pearl:</strong> Known as the "Pearl of the Andaman," Phuket sits in the Andaman Sea on Thailand's west coast.</li>
                                <li><strong>Patong Beach:</strong> The most famous and busiest beach on the island, known for its nightlife and tourist infrastructure.</li>
                                <li><strong>2004 Tsunami:</strong> Phuket was heavily impacted by the Boxing Day tsunami. Many memorials and warning systems now exist across the island.</li>
                                <li><strong>Drink Spiking Warning:</strong> Unfortunately common in tourist areas worldwide. Never leave drinks unattended, and travel with trusted friends.</li>
                            </ul>
                        </div>
                    </div>
                    
                    ${generateGallery('phuket')}
                `,
                fullDesc: "Phuket taught me a lesson I'll never forget. A night off, a bar with jungle animals painted on the walls, friendly strangers. One beer. One shot. Then nothing. I woke up in a strange room. My friend Martin is the reason I'm still here to tell this story.",
                image: "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768865557/PANO_20131118_134025_qd3r7o.jpg"
            },
            {
                id: 93,
                title: "Port Moresby, Papua New Guinea",
                coords: [-9.44, 147.18],
                tag: "PNG Capital",
                icon: "âš“",
                isDoor: false,
                shortDesc: "Where cultures collide in the Pacific.",
                fullDesc: "Placeholder description for Port Moresby.",
                image: ""
            },
            {
                id: 94,
                title: "Suva, Fiji",
                coords: [-18.14, 178.44],
                tag: "South Pacific Hub",
                icon: "ðŸï¸",
                isDoor: false,
                shortDesc: "Fiji's vibrant capital.",
                fullDesc: "Placeholder description for Suva.",
                image: ""
            },
            {
                id: 95,
                title: "Apia, Samoa",
                coords: [-13.83, -171.76],
                tag: "Polynesian Heart",
                icon: "ðŸï¸",
                isDoor: false,
                shortDesc: "Where Polynesian culture runs deep.",
                fullDesc: "Placeholder description for Apia.",
                image: ""
            },
            {
                id: 96,
                title: "Rarotonga, Cook Islands",
                coords: [-21.23, -159.78],
                tag: "Hidden Paradise",
                icon: "ðŸï¸",
                isDoor: false,
                shortDesc: "The jewel of the Cook Islands.",
                fullDesc: "Placeholder description for Rarotonga.",
                image: ""
            },
            {
                id: 97,
                title: "Honolulu, Hawaii",
                coords: [21.31, -157.86],
                tag: "Aloha Spirit",
                icon: "ðŸï¸",
                isDoor: false,
                shortDesc: "Where America meets the Pacific.",
                fullDesc: "Placeholder description for Honolulu.",
                image: ""
            },
            {
                id: 98,
                title: "Cartagena, Colombia",
                coords: [10.39, -75.51],
                tag: "Walled City",
                icon: "ðŸ›ï¸",
                isDoor: false,
                shortDesc: "Colonial splendor on the Caribbean.",
                fullDesc: "Placeholder description for Cartagena.",
                image: ""
            },
            {
                id: 99,
                title: "Lima, Peru",
                coords: [-12.05, -77.04],
                tag: "City of Kings",
                icon: "ðŸ›ï¸",
                isDoor: false,
                shortDesc: "Peru's sprawling capital on the Pacific.",
                fullDesc: "Placeholder description for Lima.",
                image: ""
            },
            {
                id: 100,
                title: "ValparaÃ­so, Chile",
                coords: [-33.05, -71.62],
                tag: "Bohemian Port",
                icon: "ðŸŽ¨",
                isDoor: false,
                shortDesc: "Chile's colorful, artistic port city.",
                fullDesc: "Placeholder description for ValparaÃ­so.",
                image: ""
            },
            {
                id: 101,
                title: "Santiago, Chile",
                coords: [-33.45, -70.67],
                tag: "Andean Capital",
                icon: "ðŸ›ï¸",
                isDoor: false,
                shortDesc: "Chile's capital beneath the mountains.",
                fullDesc: "Placeholder description for Santiago.",
                image: ""
            },
            {
                id: 102,
                title: "ConcepciÃ³n, Chile",
                coords: [-36.83, -73.05],
                tag: "University City",
                icon: "âš“",
                isDoor: false,
                shortDesc: "Chile's second city.",
                fullDesc: "Placeholder description for ConcepciÃ³n.",
                image: ""
            },
            {
                id: 103,
                title: "Valdivia, Chile",
                coords: [-39.81, -73.24],
                tag: "Rivers & Rain",
                icon: "âš“",
                isDoor: false,
                shortDesc: "Germany in the Chilean south.",
                fullDesc: "Placeholder description for Valdivia.",
                image: ""
            },
            {
                id: 104,
                title: "Puerto Montt, Chile",
                coords: [-41.47, -72.94],
                tag: "Gateway to Patagonia",
                icon: "âš“",
                isDoor: false,
                shortDesc: "Where the lakes meet the fjords.",
                fullDesc: "Placeholder description for Puerto Montt.",
                image: ""
            },
            {
                id: 105,
                title: "Punta Arenas, Chile",
                coords: [-53.16, -70.91],
                tag: "Edge of the World",
                icon: "ðŸ§",
                isDoor: false,
                shortDesc: "Chile's gateway to Antarctica.",
                fullDesc: "Placeholder description for Punta Arenas.",
                image: ""
            },
            {
                id: 106,
                title: "Montevideo, Uruguay",
                coords: [-34.90, -56.19],
                tag: "Laid-Back Capital",
                icon: "âš“",
                isDoor: false,
                shortDesc: "Uruguay's charming riverside capital.",
                fullDesc: "Placeholder description for Montevideo.",
                image: ""
            },
            {
                id: 107,
                title: "Buenos Aires, Argentina",
                coords: [-34.60, -58.38],
                tag: "Paris of the South",
                icon: "ðŸ’ƒ",
                isDoor: false,
                shortDesc: "Tango, steak, and faded grandeur.",
                fullDesc: "Placeholder description for Buenos Aires.",
                image: ""
            },
            {
                id: 108,
                title: "Salvador, Brazil",
                coords: [-12.97, -38.50],
                tag: "Afro-Brazilian Soul",
                icon: "ðŸŽ­",
                isDoor: false,
                shortDesc: "Where African and Brazilian cultures fuse.",
                fullDesc: "Placeholder description for Salvador.",
                image: ""
            },
            {
                id: 109,
                title: "Recife, Brazil",
                coords: [-8.05, -34.88],
                tag: "Venice of Brazil",
                icon: "âš“",
                isDoor: false,
                shortDesc: "Bridges, beaches, and colonial history.",
                fullDesc: "Placeholder description for Recife.",
                image: ""
            },
            {
                id: 110,
                title: "Fortaleza, Brazil",
                coords: [-3.72, -38.54],
                tag: "Northeast Sun",
                icon: "â˜€ï¸",
                isDoor: false,
                shortDesc: "Brazil's sun-drenched northeast coast.",
                fullDesc: "Placeholder description for Fortaleza.",
                image: ""
            }
        ];

        // Three.js setup
        let scene, camera, renderer, globe, markers = [], markerSprites = [];
        let raycaster, mouse;
        let hoveredMarker = null;
        let isUserInteracting = false;
        let targetRotationX = 0, targetRotationY = 0;
        let mouseXOnMouseDown = 0, mouseYOnMouseDown = 0;
        let targetRotationXOnMouseDown = 0, targetRotationYOnMouseDown = 0;
        
        // Intro animation state
        let introComplete = false;
        let introStartTime = null;
        const introDuration = 3000; // 3 seconds for the zoom in

        // Panel state - controls whether globe auto-rotates
        let panelIsOpen = false;
        
        // Flag to prevent auto-opening panel when navigating
        let skipPanelOpen = false;
        
        // Bounce animation for focused icon
        let bouncingMarkerId = null;
        let bounceStartTime = null;
        const bounceDuration = 350; // Quick single bounce

        // Zoom transition animation
        let isTransitioning = false;
        let transitionStartTime = null;
        let transitionPhase = 'none'; // 'zoom-out', 'zoom-in', 'none'
        let targetCameraZ = 1.8;
        const zoomOutDistance = 4.05; // Zoomed out
        const baseZoomInDistance = 2.16;  // Zoom for door icons (reference)
        let currentZoomInDistance = baseZoomInDistance; // Dynamic per-location
        const zoomOutDuration = 600;  // ms
        const zoomInDuration = 800;   // ms
        
        // Store density factors globally for zoom calculations
        let globalDensityFactors = null;

        const tooltip = document.getElementById('tooltip');
        const sidePanel = document.getElementById('sidePanel');
        
        // Background music controls
        let musicFadeInterval = null;
        const MUSIC_FADE_DURATION = 1500; // 1.5 second fade in/out
        const MUSIC_MAX_VOLUME = 0.36; // Max volume (0.0 - 1.0) - keep subtle for underscore
        
        // Audio tracks for each door (can be expanded)
        const doorAudioTracks = {
            1: 'https://res.cloudinary.com/de5jbyhxx/video/upload/v1768768186/pc_final_kqeaut.mp3', // Toledo - Pachelbel Canon
            // 2: './darwin-intro.mp3',  // Darwin (future)
            // 3: './auckland-intro.mp3' // Auckland (future)
        };
        
        function playBackgroundMusic(doorId) {
            const trackUrl = doorAudioTracks[doorId];
            const backgroundMusic = document.getElementById('backgroundMusic');
            
            if (!trackUrl || !backgroundMusic) {
                return;
            }
            
            // Stop any existing fade
            if (musicFadeInterval) {
                clearInterval(musicFadeInterval);
                musicFadeInterval = null;
            }
            
            // Set the source
            backgroundMusic.src = trackUrl;
            
            // Start at zero volume
            backgroundMusic.currentTime = 0;
            backgroundMusic.volume = 0;
            
            // Play and fade in
            backgroundMusic.play().then(() => {
                // Fade in
                const startTime = Date.now();
                musicFadeInterval = setInterval(() => {
                    const elapsed = Date.now() - startTime;
                    const progress = Math.min(elapsed / MUSIC_FADE_DURATION, 1);
                    backgroundMusic.volume = progress * MUSIC_MAX_VOLUME;
                    
                    if (progress >= 1) {
                        clearInterval(musicFadeInterval);
                        musicFadeInterval = null;
                    }
                }, 50);
            }).catch(err => {
                console.error('Audio playback failed:', err.name, err.message);
            });
        }
        
        function stopBackgroundMusic() {
            const backgroundMusic = document.getElementById('backgroundMusic');
            if (!backgroundMusic || backgroundMusic.paused) return;
            
            // Stop any existing fade
            if (musicFadeInterval) {
                clearInterval(musicFadeInterval);
                musicFadeInterval = null;
            }
            
            // Fade out
            const startVolume = backgroundMusic.volume;
            const startTime = Date.now();
            
            musicFadeInterval = setInterval(() => {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / MUSIC_FADE_DURATION, 1);
                backgroundMusic.volume = startVolume * (1 - progress);
                
                if (progress >= 1) {
                    clearInterval(musicFadeInterval);
                    musicFadeInterval = null;
                    backgroundMusic.pause();
                    backgroundMusic.currentTime = 0;
                }
            }, 50);
        }
        
        // AI-generated porthole textures
        const USE_AI_PORTHOLES = true; // Toggle between AI images and canvas-drawn
        let portholeFrameTexture = null;  // Empty frame for doors
        let portholeSceneTexture = null;  // Default fallback for locations
        
        // Per-location porthole images (add URLs as you create them!)
        const locationPortholeURLs = {
            // Completed locations
            "Port Vila": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1767934122/marcie_00842__xyvw5f.png",
            "Kotor, Montenegro": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1767934308/marcie_00795__dqtfrv.png",
            "Milford Sound, New Zealand": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1767934562/marcie_00848__lsqvc7.png",
            "Bora Bora": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1767934658/marcie_00863__d9cfov.png",
            "Picton, New Zealand": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1767934726/marcie_00859__hg41ls.png",
            "Akaroa, New Zealand": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1767934782/marcie_00856__shstqa.png",
            "Wellington, New Zealand": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1767934920/marcie_00854__ddnt6o.png",
            "Toledo, Ohio": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1767937260/marcie_00913__fvuzla.png",
            "Brisbane, Australia": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1767937320/marcie_00869__xtfnj3.png",
            "Portofino, Italy": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1767937437/marcie_00880__wrzehv.png",
            "Ephesus, Turkey": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1767937501/marcie_00884__glotfr.png",
            "Auckland, New Zealand": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1767950342/marcie_00954__cjlthw.png",
            "Darwin, Australia": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1767950354/marcie_00920__gymcoe.png",
            "Rome, Italy": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1767950310/marcie_01005__n4dbdz.png",
            "Piran, Slovenia": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1767950328/marcie_01050__qunmvg.png",
            "Sydney, Australia": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1767950196/marcie_00957__suiqhl.png",
            "Dubrovnik, Croatia": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1767950299/marcie_00998__uuyksn.png",
            "Ushuaia, Argentina": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1767952701/marcie_01044__d7wlbn.png",
            "Alexandria, Egypt": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1767954446/marcie_01091__g6f37b.png",
            "Milos, Greece": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1767954451/marcie_01087__tjhnoz.png",
            "South Georgia": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1767954452/marcie_01084__wkiyxh.png",
            "Bali, Indonesia": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1767954456/marcie_01078__lmxp7z.png",
            "Valletta, Malta": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1767954460/marcie_01076__naw5pw.png",
            "Ibiza, Spain": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768419427/ComfyUI_00974__skii8k.png",
            "Santorini, Greece": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768419411/ComfyUI_01097__hak9ts.png",
            // New locations - January 2026
            "Tierra del Fuego": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768419439/ComfyUI_00633__qqmezn.png",
            "Melbourne, Australia": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768511020/ComfyUI_01199__xsa0xi.png",
            "Amazon River": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768419439/ComfyUI_00694__gxxmvo.png",
            "Quebec City, Canada": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768419438/ComfyUI_00700__i4ru8q.png",
            "Rio de Janeiro, Brazil": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768419439/ComfyUI_00664__adibta.png",
            "Barcelona, Spain": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768419438/ComfyUI_00737__zthmxj.png",
            "Portovenere, Italy": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768419428/ComfyUI_00748__zuks5j.png",
            "Hobart, Tasmania": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768419438/ComfyUI_00693__bw21n8.png",
            "Saguenay, Canada": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768419438/ComfyUI_00709__desjzm.png",
            "Hong Kong": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768419428/ComfyUI_00787__rnq7fa.png",
            "Florence, Italy": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768419428/ComfyUI_00770__wxy82h.png",
            "Stromboli, Italy": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768419428/ComfyUI_00777__b33hq1.png",
            "San Remo, Italy": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768419428/ComfyUI_00757__cl8bge.png",
            "Roses, Spain": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768419413/ComfyUI_00985__lilp6z.png",
            "Propriano, Corsica": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768419427/ComfyUI_00956__dx6t6k.png",
            "Marseille, France": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768419427/ComfyUI_00864__u1i1nf.png",
            "Le Lavandou, France": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768419427/ComfyUI_00869__hehrgj.png",
            "Monte Carlo, Monaco": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768419427/ComfyUI_00947__th5kfz.png",
            "Syracuse, Sicily": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768419411/ComfyUI_01146__x2yqx0.png",
            "Corfu, Greece": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768419413/ComfyUI_01013__sbssuy.png",
            "Celukan Bawang, Indonesia": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768419413/ComfyUI_01041__vthddf.png",
            "Penang, Malaysia": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768419412/ComfyUI_01053__gndtyw.png",
            "Mumbai, India": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768419412/ComfyUI_01058__cz2too.png",
            "Dubai, UAE": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768419411/ComfyUI_01073__xbhngr.png",
            "Tel Aviv, Israel": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768419411/ComfyUI_01065__jwxuwx.png",
            "Suez Canal, Egypt": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768419411/ComfyUI_01077__v2gdly.png",
            "Istanbul, Turkey": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768419411/ComfyUI_01102__i1s5ok.png",
            "Panama Canal": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768419413/ComfyUI_01022__lqkdsf.png",
            "Yalta, Ukraine": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768511153/ComfyUI_01111__ydffje.png",
            "Muscat, Oman": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768419412/ComfyUI_01055__nn4tuv.png",
            "Nessebar, Bulgaria": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768419411/ComfyUI_01146__x2yqx0.png",
            // January 15, 2026 batch - Pacific & Australia
            "Christmas Island": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768511020/ComfyUI_01202__yd7eff.png",
            "Rarotonga, Cook Islands": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768511020/ComfyUI_01206__duz5ib.png",
            "Suva, Fiji": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768511020/ComfyUI_01208__pxkkdh.png",
            "Apia, Samoa": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768511021/ComfyUI_01218__asqixa.png",
            "Honolulu, Hawaii": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768511021/ComfyUI_01248__onhvwh.png",
            "Tonga": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768511020/ComfyUI_01211__atto6y.png",
            "Port Moresby, Papua New Guinea": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768511021/ComfyUI_01251__iagqxb.png",
            "Airlie Beach, Australia": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768511022/ComfyUI_01188__ooliee.png",
            "Broome, Australia": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768511022/ComfyUI_01189__khavtb.png",
            "Napier, New Zealand": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768511022/ComfyUI_01268__ydr8mk.png",
            "Adelaide, Australia": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768511022/ComfyUI_01197__qc3jjg.png",
            "New Caledonia": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768511021/ComfyUI_01275__iw0wwu.png",
            "Lifou": "https://res.cloudinary.com/de5jbyhxx/image/upload/v1768511021/ComfyUI_01275__iw0wwu.png",
            // Awaiting icons - add URLs when ready:
            // "Venice, Italy": "",
            // "Perth, Australia": "",
            // "Tauranga, New Zealand": "",
            // "Sharm El Sheikh, Egypt": "",
            // "Doha, Qatar": "",
            // "Mormugao, Goa": "",
            // "New Mangalore, India": "",
            // "Amsterdam, Netherlands": "",
            // "San Juan, Puerto Rico": "",
            // "Red Sea Transit": "",
            // "Izmir, Turkey": "",
            // "Haifa, Israel": "",
            // "Parga, Greece": "",
            // "Hvar, Croatia": "",
        };
        
        // Per-location ANIMATED porthole videos (Wan 2.1 exports)
        const locationVideoURLs = {
            // Add animated portholes here - these take priority over static images!
            "Toledo, Ohio": "https://res.cloudinary.com/de5jbyhxx/video/upload/v1767948217/Wan2.2_image_to_video_00008__vbdcww.mp4",
        };
        
        // Loaded textures stored here
        const locationTextures = {};
        
        // Video elements that need updating each frame
        const videoTextures = [];
        
        // Video elements mapped by location name for play/pause control
        const locationVideos = {};
        
        // Toledo: 41.6528Â° N, 83.5379Â° W
        // FOUND: Y = -0.10 shows Toledo (lon = -83.5Â°)
        // Formula: Y = -0.10 corresponds to -83.5Â° longitude
        // So: Y = (lon - (-83.5)) * (PI/180) + (-0.10)
        // Simplified: Y = (lon + 83.5) * (PI/180) - 0.10
        const TOLEDO_Y = -0.10;
        const TOLEDO_X = (41.6528 * Math.PI / 180); // positive for north

        // Load video as texture (does NOT autoplay - call video.play() when ready)
        function loadVideoTexture(url) {
            return new Promise((resolve) => {
                // Timeout after 8 seconds - iOS can hang indefinitely on video load
                const timeout = setTimeout(() => {
                    console.warn('Video load timeout:', url);
                    resolve(null);
                }, 8000);
                
                const video = document.createElement('video');
                video.crossOrigin = 'anonymous';
                video.loop = false; // Play once and stop on last frame
                video.muted = true;
                video.playsInline = true;
                video.preload = 'auto'; // Help iOS load video data
                // DON'T autoplay - wait for user interaction
                video.autoplay = false;
                
                video.onloadeddata = function() {
                    clearTimeout(timeout);
                    const texture = new THREE.VideoTexture(video);
                    texture.minFilter = THREE.LinearFilter;
                    texture.magFilter = THREE.LinearFilter;
                    // DON'T play yet - wait for user click
                    console.log('Loaded video texture (paused):', url);
                    
                    // Store reference for frame updates
                    videoTextures.push({ video, texture });
                    resolve({ texture, video });
                };
                
                video.onerror = () => {
                    clearTimeout(timeout);
                    console.error('Failed to load video:', url);
                    resolve(null);
                };
                
                video.src = url;
            });
        }

        // Load image and make black pixels transparent (only outside the circular porthole)
        function loadTextureWithTransparentBlack(url, threshold = 60) {
            return new Promise((resolve) => {
                // Timeout after 10 seconds
                const timeout = setTimeout(() => {
                    console.warn('Image load timeout:', url);
                    resolve(null);
                }, 10000);
                
                const img = new Image();
                img.crossOrigin = 'anonymous';
                img.onload = function() {
                    clearTimeout(timeout);
                    const canvas = document.createElement('canvas');
                    canvas.width = img.width;
                    canvas.height = img.height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0);
                    
                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    const data = imageData.data;
                    
                    const cx = canvas.width / 2;
                    const cy = canvas.height / 2;
                    // Porthole radius - assume it takes up ~88% of image width
                    const portholeRadius = Math.min(cx, cy) * 0.88;
                    
                    // Make dark pixels transparent ONLY if outside porthole circle
                    for (let y = 0; y < canvas.height; y++) {
                        for (let x = 0; x < canvas.width; x++) {
                            const i = (y * canvas.width + x) * 4;
                            const r = data[i];
                            const g = data[i + 1];
                            const b = data[i + 2];
                            
                            // Distance from center
                            const dx = x - cx;
                            const dy = y - cy;
                            const dist = Math.sqrt(dx * dx + dy * dy);
                            
                            // Only make transparent if:
                            // 1. Pixel is dark (near black)
                            // 2. AND pixel is outside the porthole circle
                            if (r < threshold && g < threshold && b < threshold && dist > portholeRadius) {
                                data[i + 3] = 0; // Set alpha to 0
                            }
                        }
                    }
                    
                    ctx.putImageData(imageData, 0, 0);
                    
                    const texture = new THREE.CanvasTexture(canvas);
                    texture.needsUpdate = true;
                    console.log('Loaded with circular transparency:', url);
                    resolve(texture);
                };
                img.onerror = () => {
                    clearTimeout(timeout);
                    console.error('Failed to load:', url);
                    resolve(null);
                };
                img.src = url;
            });
        }
        
        async function init() {
            // Preload AI porthole textures with black-to-transparent processing
            if (USE_AI_PORTHOLES) {
                try {
                    // Master timeout - if all textures don't load in 15s, continue anyway
                    const textureLoadPromise = (async () => {
                        // Load default textures
                        [portholeFrameTexture, portholeSceneTexture] = await Promise.all([
                            loadTextureWithTransparentBlack(
                                'https://res.cloudinary.com/de5jbyhxx/image/upload/v1767928093/marcie_00688__ntj67c.png',
                                65 // threshold for black background removal
                            ),
                            loadTextureWithTransparentBlack(
                                'https://res.cloudinary.com/de5jbyhxx/image/upload/v1767928140/marcie_00793__bhzemp.png',
                                65
                            )
                        ]);
                        
                        // Load per-location textures
                        const locationLoadPromises = Object.entries(locationPortholeURLs).map(async ([name, url]) => {
                            const texture = await loadTextureWithTransparentBlack(url, 65);
                            locationTextures[name] = texture;
                            console.log(`Loaded texture for: ${name}`);
                        });
                        await Promise.all(locationLoadPromises);
                        
                        // Load per-location VIDEO textures (these override static images)
                        const videoLoadPromises = Object.entries(locationVideoURLs).map(async ([name, url]) => {
                            const result = await loadVideoTexture(url);
                            if (result && result.texture) {
                                locationTextures[name] = result.texture; // Override any static image
                                locationVideos[name] = result.video; // Store video element for play/pause control
                                console.log(`Loaded VIDEO texture for: ${name}`);
                            }
                        });
                        await Promise.all(videoLoadPromises);
                    })();
                    
                    // Race against master timeout
                    await Promise.race([
                        textureLoadPromise,
                        new Promise((_, reject) => setTimeout(() => reject(new Error('Master timeout')), 15000))
                    ]);
                } catch (e) {
                    console.warn('Texture loading failed or timed out, continuing without some textures:', e);
                }
            }
            
            // Scene
            scene = new THREE.Scene();
            
            // Camera - start far away for intro
            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 8; // Start far away in space
            
            // Initialize rotation targets to Toledo
            targetRotationY = TOLEDO_Y;
            targetRotationX = TOLEDO_X;

            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            document.getElementById('canvas-container').appendChild(renderer.domElement);

            // Raycaster for interaction
            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();

            // Create globe
            createGlobe();
            
            // Create markers
            createMarkers();

            // Enhanced lighting for high-res globe
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.35);
            scene.add(ambientLight);

            // Main sun light - warm white, positioned for nice terminator line
            const sunLight = new THREE.DirectionalLight(0xfff5e6, 1.2);
            sunLight.position.set(5, 2, 5);
            scene.add(sunLight);
            
            // Subtle fill light from opposite side (simulates earth-shine/ambient)
            const fillLight = new THREE.DirectionalLight(0x4477aa, 0.25);
            fillLight.position.set(-5, -1, -5);
            scene.add(fillLight);
            
            // Rim light for atmosphere edge highlighting
            const rimLight = new THREE.DirectionalLight(0x88aaff, 0.15);
            rimLight.position.set(0, 5, -3);
            scene.add(rimLight);

            // Event listeners
            renderer.domElement.addEventListener('mousedown', onMouseDown, false);
            renderer.domElement.addEventListener('mousemove', onMouseMove, false);
            renderer.domElement.addEventListener('mouseup', onMouseUp, false);
            renderer.domElement.addEventListener('mouseleave', onMouseUp, false);
            renderer.domElement.addEventListener('wheel', onMouseWheel, false);
            renderer.domElement.addEventListener('click', onClick, false);
            window.addEventListener('resize', onWindowResize, false);

            // Touch events
            renderer.domElement.addEventListener('touchstart', onTouchStart, { passive: false });
            renderer.domElement.addEventListener('touchmove', onTouchMove, { passive: false });
            renderer.domElement.addEventListener('touchend', onTouchEnd, false);
            
            // Add tap detection for mobile marker selection
            let touchStartTime;
            let touchStartPos;
            renderer.domElement.addEventListener('touchstart', (e) => {
                touchStartTime = Date.now();
                touchStartPos = { x: e.touches[0].clientX, y: e.touches[0].clientY };
            }, false);
            renderer.domElement.addEventListener('touchend', (e) => {
                const touchDuration = Date.now() - touchStartTime;
                const touch = e.changedTouches[0];
                const moveDistance = Math.sqrt(
                    Math.pow(touch.clientX - touchStartPos.x, 2) + 
                    Math.pow(touch.clientY - touchStartPos.y, 2)
                );
                // If it was a quick tap without much movement, treat as click
                if (touchDuration < 300 && moveDistance < 10) {
                    onTouchTap(e);
                }
            }, false);

            // Build location list
            buildLocationList();

            // Hide loading screen
            setTimeout(() => {
                document.getElementById('loading').classList.add('hidden');
            }, 1000);

            // Start animation
            animate();
            
            // Stars
            initStars();
        }

        function createGlobe() {
            const textureLoader = new THREE.TextureLoader();
            
            // Original Earth texture with darker ocean colors
            const earthTexture = textureLoader.load(
                'https://i.imgur.com/TIrHFCa.jpg',
                function() { 
                    console.log('Earth texture loaded');
                }
            );
            
            // Bump map for terrain elevation
            const bumpMap = textureLoader.load(
                'https://unpkg.com/three-globe/example/img/earth-topology.png'
            );
            
            // Specular map - makes oceans shiny, land matte
            const specularMap = textureLoader.load(
                'https://unpkg.com/three-globe/example/img/earth-water.png'
            );

            // Higher polygon count for smoother sphere
            const geometry = new THREE.SphereGeometry(1, 128, 128);
            
            // Enhanced material with specular highlights on water
            const material = new THREE.MeshPhongMaterial({
                map: earthTexture,
                bumpMap: bumpMap,
                bumpScale: 0.015,
                specularMap: specularMap,
                specular: new THREE.Color(0x666666),
                shininess: 25
            });

            globe = new THREE.Mesh(geometry, material);
            scene.add(globe);

            // Enhanced atmosphere glow - three layers for realistic depth
            // Inner atmosphere (crisp blue rim at edge)
            const innerAtmoGeometry = new THREE.SphereGeometry(1.01, 64, 64);
            const innerAtmoMaterial = new THREE.ShaderMaterial({
                vertexShader: `
                    varying vec3 vNormal;
                    varying vec3 vPosition;
                    void main() {
                        vNormal = normalize(normalMatrix * normal);
                        vPosition = position;
                        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                    }
                `,
                fragmentShader: `
                    varying vec3 vNormal;
                    void main() {
                        float intensity = pow(0.7 - dot(vNormal, vec3(0.0, 0.0, 1.0)), 2.0);
                        // Gradient from cyan at edge to deeper blue
                        vec3 atmosphereColor = mix(vec3(0.3, 0.6, 1.0), vec3(0.5, 0.8, 1.0), intensity);
                        gl_FragColor = vec4(atmosphereColor, intensity * 1.2);
                    }
                `,
                blending: THREE.AdditiveBlending,
                side: THREE.BackSide,
                transparent: true,
                depthWrite: false
            });
            const innerAtmosphere = new THREE.Mesh(innerAtmoGeometry, innerAtmoMaterial);
            globe.add(innerAtmosphere);
            
            // Middle atmosphere (main blue glow)
            const midAtmoGeometry = new THREE.SphereGeometry(1.08, 64, 64);
            const midAtmoMaterial = new THREE.ShaderMaterial({
                vertexShader: `
                    varying vec3 vNormal;
                    void main() {
                        vNormal = normalize(normalMatrix * normal);
                        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                    }
                `,
                fragmentShader: `
                    varying vec3 vNormal;
                    void main() {
                        float intensity = pow(0.68 - dot(vNormal, vec3(0.0, 0.0, 1.0)), 2.5);
                        vec3 glowColor = vec3(0.35, 0.55, 0.95);
                        gl_FragColor = vec4(glowColor, intensity * 0.7);
                    }
                `,
                blending: THREE.AdditiveBlending,
                side: THREE.BackSide,
                transparent: true,
                depthWrite: false
            });
            const midAtmosphere = new THREE.Mesh(midAtmoGeometry, midAtmoMaterial);
            globe.add(midAtmosphere);
            
            // Outer atmosphere corona (soft diffuse glow extending into space)
            const outerAtmoGeometry = new THREE.SphereGeometry(1.18, 64, 64);
            const outerAtmoMaterial = new THREE.ShaderMaterial({
                vertexShader: `
                    varying vec3 vNormal;
                    void main() {
                        vNormal = normalize(normalMatrix * normal);
                        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                    }
                `,
                fragmentShader: `
                    varying vec3 vNormal;
                    void main() {
                        float intensity = pow(0.55 - dot(vNormal, vec3(0.0, 0.0, 1.0)), 4.0);
                        vec3 glowColor = vec3(0.25, 0.4, 0.8);
                        gl_FragColor = vec4(glowColor, intensity * 0.35);
                    }
                `,
                blending: THREE.AdditiveBlending,
                side: THREE.BackSide,
                transparent: true,
                depthWrite: false
            });
            const outerAtmosphere = new THREE.Mesh(outerAtmoGeometry, outerAtmoMaterial);
            globe.add(outerAtmosphere);
        }

        function latLonToVector3(lat, lon, radius) {
            const phi = (90 - lat) * (Math.PI / 180);
            const theta = (lon + 180) * (Math.PI / 180);
            
            return new THREE.Vector3(
                -radius * Math.sin(phi) * Math.cos(theta),
                radius * Math.cos(phi),
                radius * Math.sin(phi) * Math.sin(theta)
            );
        }

        // =============================================
        // ICON RENDERING SYSTEM
        // =============================================
        
        const ICON_CONFIG = {
            // Toledo - Wood Door (same style as Darwin)
            "Toledo, Ohio": { style: 'door', symbol: 'wood-door', color: '#6a5a4a', accent: '#d4a574' },
            // Darwin - Wood Door  
            "Darwin, Australia": { style: 'door', symbol: 'wood-door', color: '#6a5a4a', accent: '#d4a574' },
            // Auckland - Gold Door
            "Auckland, New Zealand": { style: 'door', symbol: 'wood-door', color: '#6a5a4a', accent: '#d4a574' },
            // Art Deco - Luxury
            "Queen Victoria (Cunard)": { style: 'deco', symbol: 'crown', color: '#d4a574', accent: '#ffd700' },
            // Modern Minimal - Cities
            "Brisbane, Australia": { style: 'minimal', symbol: 'sunrise', color: '#ffa500', accent: '#ffcc00' },
            "Sydney, Australia": { style: 'minimal', symbol: 'fireworks', color: '#ff6b6b', accent: '#ffd700' },
            "Wellington, New Zealand": { style: 'minimal', symbol: 'star', color: '#c0c8d0', accent: '#ff6b6b' },
            "Napier, New Zealand": { style: 'minimal', symbol: 'car', color: '#607080', accent: '#d4a574' },
            "Tel Aviv, Israel": { style: 'minimal', symbol: 'menorah', color: '#ffd700', accent: '#4a90a0' },
            "Mumbai, India": { style: 'minimal', symbol: 'gateway', color: '#e07a5f', accent: '#ffd700' },
            "Barcelona, Spain": { style: 'minimal', symbol: 'mosaic', color: '#e07a5f', accent: '#ffd700' },
            // Heritage - Historic Sites (each unique)
            "Dubrovnik, Croatia": { style: 'heritage', symbol: 'fortress', color: '#8b7355', accent: '#5a4a3a' },
            "Ephesus, Turkey": { style: 'heritage', symbol: 'library', color: '#c9b896', accent: '#8b7355' },
            "Rome, Italy": { style: 'heritage', symbol: 'colosseum', color: '#c9b896', accent: '#8b7355' },
            "Milford Sound, New Zealand": { style: 'heritage', symbol: 'mountain', color: '#607080', accent: '#a0c0d0' },
            "Milos, Greece": { style: 'heritage', symbol: 'venus', color: '#4a90a0', accent: '#ffffff' },
            "Santorini, Greece": { style: 'heritage', symbol: 'column', color: '#1e90ff', accent: '#ffffff' },
            "Syracuse, Sicily": { style: 'heritage', symbol: 'amphitheater', color: '#c9b896', accent: '#8b7355' },
            "Kotor, Montenegro": { style: 'heritage', symbol: 'fortress', color: '#8b7355', accent: '#5a4a3a' },
            "Valletta, Malta": { style: 'heritage', symbol: 'cross', color: '#c9b896', accent: '#8b7355' },
            "Alexandria, Egypt": { style: 'heritage', symbol: 'lighthouse', color: '#d4a574', accent: '#8b7355' },
            // Paradise - Tropical
            "Reithi Rah, Maldives": { style: 'paradise', symbol: 'shark', color: '#4a90a0', accent: '#2d5a6a' },
            "Bali, Indonesia": { style: 'paradise', symbol: 'mango', color: '#ffa500', accent: '#228b22' },
            "Bora Bora": { style: 'paradise', symbol: 'palm', color: '#40e0d0', accent: '#228b22' },
            "Tonga": { style: 'paradise', symbol: 'whale', color: '#4a90a0', accent: '#2d5a6a' },
            "Port Vila": { style: 'maritime', symbol: 'cyclone', color: '#1a1a2e', accent: '#4a90d9' },
            "Lifou": { style: 'paradise', symbol: 'spider', color: '#2d5016', accent: '#90EE90' },
            "Airlie Beach, Australia": { style: 'paradise', symbol: 'sun-hot', color: '#ff6b6b', accent: '#ffa500' },
            "Ibiza, Spain": { style: 'paradise', symbol: 'dj', color: '#ff6b6b', accent: '#ffd700' },
            "Amazon River": { style: 'culture', symbol: 'opera', color: '#f5e6d3', accent: '#8b4513' },
            // Adventure - Remote
            "Ushuaia, Argentina": { style: 'adventure', symbol: 'penguin', color: '#2d3748', accent: '#ffa500' },
            "Falkland Islands": { style: 'adventure', symbol: 'beer', color: '#d4a574', accent: '#f5f0e8' },
            "South Georgia": { style: 'adventure', symbol: 'whalingboat', color: '#8b4513', accent: '#a0522d' },
            "Lemaire Channel, Antarctica": { style: 'adventure', symbol: 'iceberg', color: '#a0c0d0', accent: '#ffffff' },
            "Port Lockroy, Antarctica": { style: 'adventure', symbol: 'penguin', color: '#2d3748', accent: '#ffa500' },
            // Culture - Food, Wine, Music, Glamour (unique boats)
            "Portofino, Italy": { style: 'culture', symbol: 'yacht', color: '#e07a5f', accent: '#2d5a6a' },
            "Akaroa, New Zealand": { style: 'culture', symbol: 'wine', color: '#722f37', accent: '#d4a574' },
            "Picton, New Zealand": { style: 'culture', symbol: 'grapes', color: '#4a0e4e', accent: '#228b22' },
            "Tauranga, New Zealand": { style: 'culture', symbol: 'guitar', color: '#8b4513', accent: '#d4a574' },
            "Piran, Slovenia": { style: 'culture', symbol: 'violin', color: '#4a90a0', accent: '#8b4513' },
            "St. Tropez, France": { style: 'culture', symbol: 'champagne', color: '#e07a5f', accent: '#ffd700' }
        };
        
        // ================================================================
        // PORTHOLE ICON SYSTEM WITH IRIS ANIMATION
        // ================================================================
        
        // Track animation state for each marker
        const markerAnimations = new Map();
        
        // Color utility functions
        function lightenColor(hex, percent) {
            const num = parseInt(hex.replace('#', ''), 16);
            const amt = Math.round(2.55 * percent);
            const R = Math.min(255, (num >> 16) + amt);
            const G = Math.min(255, ((num >> 8) & 0x00FF) + amt);
            const B = Math.min(255, (num & 0x0000FF) + amt);
            return `rgb(${R}, ${G}, ${B})`;
        }
        
        function darkenColor(hex, percent) {
            const num = parseInt(hex.replace('#', ''), 16);
            const amt = Math.round(2.55 * percent);
            const R = Math.max(0, (num >> 16) - amt);
            const G = Math.max(0, ((num >> 8) & 0x00FF) - amt);
            const B = Math.max(0, (num & 0x0000FF) - amt);
            return `rgb(${R}, ${G}, ${B})`;
        }
        
        // Draw iris aperture
        function drawIrisAperture(ctx, cx, cy, radius, closedAmount) {
            if (closedAmount <= 0) return;
            
            const blades = 8;
            const maxAngle = Math.PI / blades;
            
            ctx.save();
            ctx.translate(cx, cy);
            
            for (let i = 0; i < blades; i++) {
                const angle = (i / blades) * Math.PI * 2;
                
                ctx.save();
                ctx.rotate(angle);
                
                const bladeOpenAngle = maxAngle * (1 - closedAmount * 0.95);
                const bladeLength = radius * 1.3;
                
                // Smoky glass blade
                const gradient = ctx.createLinearGradient(0, 0, bladeLength, 0);
                gradient.addColorStop(0, 'rgba(40, 55, 75, 0.95)');
                gradient.addColorStop(0.5, 'rgba(30, 45, 65, 0.9)');
                gradient.addColorStop(1, 'rgba(20, 35, 55, 0.85)');
                
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.arc(0, 0, bladeLength, -bladeOpenAngle, bladeOpenAngle);
                ctx.closePath();
                ctx.fill();
                
                // Blade edge highlight
                ctx.strokeStyle = 'rgba(100, 130, 170, 0.3)';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.lineTo(Math.cos(bladeOpenAngle) * bladeLength, Math.sin(bladeOpenAngle) * bladeLength);
                ctx.stroke();
                
                ctx.restore();
            }
            
            // Center overlay when mostly closed
            if (closedAmount > 0.3) {
                const centerGrad = ctx.createRadialGradient(0, 0, 0, 0, 0, radius * (1 - closedAmount + 0.3));
                centerGrad.addColorStop(0, 'rgba(35, 50, 70, 0.9)');
                centerGrad.addColorStop(1, 'rgba(35, 50, 70, 0)');
                ctx.fillStyle = centerGrad;
                ctx.beginPath();
                ctx.arc(0, 0, radius, 0, Math.PI * 2);
                ctx.fill();
            }
            
            ctx.restore();
        }
        
        // Draw brass porthole frame
        function drawPortholeFrame(ctx, cx, cy, radius) {
            // Minimal elegant brass ring
            const brassGrad = ctx.createLinearGradient(cx - radius, cy - radius, cx + radius, cy + radius);
            brassGrad.addColorStop(0, '#e8c9a0');
            brassGrad.addColorStop(0.3, '#d4af37');
            brassGrad.addColorStop(0.7, '#b8956a');
            brassGrad.addColorStop(1, '#8a6a3a');
            
            ctx.strokeStyle = brassGrad;
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(cx, cy, radius, 0, Math.PI * 2);
            ctx.stroke();
            
            // Subtle highlight
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.15)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.arc(cx, cy, radius - 1, -Math.PI * 0.7, -Math.PI * 0.2);
            ctx.stroke();
        }
        
        // Draw brass base
        function drawPortholeBase(ctx, cx, baseY, isDoor) {
            const baseWidth = isDoor ? 50 : 44;
            
            // Brass curved base
            const brassGrad = ctx.createLinearGradient(0, baseY, 0, baseY + 16);
            brassGrad.addColorStop(0, '#e8c9a0');
            brassGrad.addColorStop(0.2, '#d4a574');
            brassGrad.addColorStop(0.6, '#b8956a');
            brassGrad.addColorStop(1, '#6a4a2a');
            
            ctx.fillStyle = brassGrad;
            ctx.beginPath();
            ctx.moveTo(cx - baseWidth / 2, baseY);
            ctx.quadraticCurveTo(cx, baseY + 18, cx + baseWidth / 2, baseY);
            ctx.lineTo(cx + baseWidth / 2 - 5, baseY + 12);
            ctx.quadraticCurveTo(cx, baseY + 22, cx - baseWidth / 2 + 5, baseY + 12);
            ctx.closePath();
            ctx.fill();
            
            // Highlight
            ctx.fillStyle = 'rgba(255, 255, 255, 0.15)';
            ctx.beginPath();
            ctx.ellipse(cx, baseY + 4, baseWidth * 0.25, 3, 0, 0, Math.PI * 2);
            ctx.fill();
        }
        
        // Draw 3D perspective door (for door locations)
        function draw3DDoor(ctx, cx, cy, doorColor, openAmount) {
            if (openAmount <= 0) return;
            
            ctx.save();
            ctx.globalAlpha = openAmount;
            ctx.translate(cx, cy);
            
            // Door shadow (offset for 3D effect)
            ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
            ctx.beginPath();
            ctx.moveTo(-5, -20);
            ctx.lineTo(16, -18);
            ctx.lineTo(16, 20);
            ctx.lineTo(-5, 22);
            ctx.closePath();
            ctx.fill();
            
            // Door face (angled)
            const doorGrad = ctx.createLinearGradient(-12, 0, 10, 0);
            doorGrad.addColorStop(0, lightenColor(doorColor, 20));
            doorGrad.addColorStop(0.5, doorColor);
            doorGrad.addColorStop(1, darkenColor(doorColor, 30));
            ctx.fillStyle = doorGrad;
            ctx.beginPath();
            ctx.moveTo(-12, -20);
            ctx.lineTo(10, -18);
            ctx.lineTo(10, 20);
            ctx.lineTo(-12, 22);
            ctx.closePath();
            ctx.fill();
            
            // Door edge (depth)
            ctx.fillStyle = darkenColor(doorColor, 50);
            ctx.beginPath();
            ctx.moveTo(10, -18);
            ctx.lineTo(16, -16);
            ctx.lineTo(16, 18);
            ctx.lineTo(10, 20);
            ctx.closePath();
            ctx.fill();
            
            // Panel insets - top
            ctx.fillStyle = darkenColor(doorColor, 20);
            ctx.beginPath();
            ctx.moveTo(-8, -16);
            ctx.lineTo(6, -14);
            ctx.lineTo(6, -4);
            ctx.lineTo(-8, -6);
            ctx.closePath();
            ctx.fill();
            
            // Panel insets - bottom
            ctx.beginPath();
            ctx.moveTo(-8, 2);
            ctx.lineTo(6, 4);
            ctx.lineTo(6, 16);
            ctx.lineTo(-8, 18);
            ctx.closePath();
            ctx.fill();
            
            // Panel highlights
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.15)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(-8, -16);
            ctx.lineTo(6, -14);
            ctx.moveTo(-8, 2);
            ctx.lineTo(6, 4);
            ctx.stroke();
            
            // Frame
            ctx.strokeStyle = '#d4a574';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(-14, -22);
            ctx.lineTo(12, -20);
            ctx.lineTo(12, 22);
            ctx.lineTo(-14, 24);
            ctx.closePath();
            ctx.stroke();
            
            // Frame highlight
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(-14, -22);
            ctx.lineTo(12, -20);
            ctx.stroke();
            
            // Glowing knob
            ctx.shadowColor = '#ffd700';
            ctx.shadowBlur = 8;
            ctx.fillStyle = '#ffd700';
            ctx.beginPath();
            ctx.arc(6, 2, 3, 0, Math.PI * 2);
            ctx.fill();
            
            // Knob highlight
            ctx.shadowBlur = 0;
            ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
            ctx.beginPath();
            ctx.arc(5, 1, 1.2, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.restore();
        }
        
        // Draw regular icon content (emoji)
        function drawRegularIcon(ctx, cx, cy, config, openAmount) {
            if (openAmount <= 0) return;
            
            ctx.save();
            ctx.globalAlpha = openAmount;
            
            // Use the same icon rendering as the sidebar
            const color = config.color || '#d4a574';
            const accent = config.accent || '#8b6914';
            const symbol = config.symbol || 'default';
            
            // Scale icons to 150% for better visibility
            ctx.translate(cx, cy);
            ctx.scale(1.5, 1.5);
            ctx.translate(-cx, -cy);
            
            renderIconSymbol(ctx, cx, cy, symbol, color, accent);
            
            ctx.restore();
        }
        
        // Shared icon rendering function (used by both globe and sidebar)
        function renderIconSymbol(ctx, cx, cy, symbol, color, accent) {
            switch(symbol) {
                case 'steel-door':
                    // Heavy steel door with padlock
                    ctx.fillStyle = '#2d3748';
                    ctx.fillRect(cx - 14, cy - 18, 28, 36);
                    ctx.fillStyle = color;
                    ctx.fillRect(cx - 11, cy - 15, 22, 30);
                    ctx.strokeStyle = '#2d3748';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(cx - 11, cy - 5);
                    ctx.lineTo(cx + 11, cy - 5);
                    ctx.moveTo(cx - 11, cy + 5);
                    ctx.lineTo(cx + 11, cy + 5);
                    ctx.stroke();
                    ctx.fillStyle = accent;
                    ctx.fillRect(cx - 5, cy - 2, 10, 10);
                    ctx.strokeStyle = accent;
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(cx, cy - 4, 4, Math.PI, 0);
                    ctx.stroke();
                    ctx.fillStyle = '#1a1a1a';
                    ctx.beginPath();
                    ctx.arc(cx, cy + 3, 2, 0, Math.PI * 2);
                    ctx.fill();
                    break;
                    
                case 'wood-door':
                    ctx.fillStyle = color;
                    ctx.fillRect(cx - 12, cy - 16, 24, 32);
                    ctx.strokeStyle = accent;
                    ctx.lineWidth = 2;
                    ctx.strokeRect(cx - 10, cy - 14, 20, 28);
                    ctx.beginPath();
                    ctx.arc(cx + 6, cy, 3, 0, Math.PI * 2);
                    ctx.stroke();
                    break;
                    
                case 'gold-door':
                    const goldGrad = ctx.createLinearGradient(cx - 12, 0, cx + 12, 0);
                    goldGrad.addColorStop(0, color);
                    goldGrad.addColorStop(0.5, accent);
                    goldGrad.addColorStop(1, color);
                    ctx.fillStyle = goldGrad;
                    ctx.fillRect(cx - 12, cy - 16, 24, 32);
                    ctx.strokeStyle = accent;
                    ctx.lineWidth = 2;
                    ctx.strokeRect(cx - 12, cy - 16, 24, 32);
                    break;
                    
                case 'crown':
                    ctx.fillStyle = color;
                    ctx.beginPath();
                    ctx.moveTo(cx - 14, cy + 8);
                    ctx.lineTo(cx - 10, cy - 8);
                    ctx.lineTo(cx - 5, cy);
                    ctx.lineTo(cx, cy - 12);
                    ctx.lineTo(cx + 5, cy);
                    ctx.lineTo(cx + 10, cy - 8);
                    ctx.lineTo(cx + 14, cy + 8);
                    ctx.closePath();
                    ctx.fill();
                    ctx.fillStyle = accent;
                    ctx.beginPath();
                    ctx.arc(cx, cy - 12, 3, 0, Math.PI * 2);
                    ctx.fill();
                    break;
                    
                case 'sunrise':
                    ctx.fillStyle = color;
                    ctx.beginPath();
                    ctx.arc(cx, cy + 5, 12, Math.PI, 0);
                    ctx.fill();
                    ctx.strokeStyle = accent;
                    ctx.lineWidth = 2;
                    for (let i = 0; i < 7; i++) {
                        const angle = Math.PI + (i / 6) * Math.PI;
                        ctx.beginPath();
                        ctx.moveTo(cx + Math.cos(angle) * 14, cy + 5 + Math.sin(angle) * 14);
                        ctx.lineTo(cx + Math.cos(angle) * 20, cy + 5 + Math.sin(angle) * 20);
                        ctx.stroke();
                    }
                    break;
                    
                case 'fireworks':
                    ctx.strokeStyle = color;
                    ctx.lineWidth = 2;
                    for (let i = 0; i < 8; i++) {
                        const angle = (i / 8) * Math.PI * 2;
                        ctx.beginPath();
                        ctx.moveTo(cx + Math.cos(angle) * 4, cy + Math.sin(angle) * 4);
                        ctx.lineTo(cx + Math.cos(angle) * 14, cy + Math.sin(angle) * 14);
                        ctx.stroke();
                    }
                    ctx.fillStyle = accent;
                    ctx.beginPath();
                    ctx.arc(cx, cy, 4, 0, Math.PI * 2);
                    ctx.fill();
                    break;
                    
                case 'star':
                    ctx.fillStyle = color;
                    ctx.beginPath();
                    for (let i = 0; i < 5; i++) {
                        const outerAngle = (i / 5) * Math.PI * 2 - Math.PI / 2;
                        const innerAngle = ((i + 0.5) / 5) * Math.PI * 2 - Math.PI / 2;
                        if (i === 0) ctx.moveTo(cx + Math.cos(outerAngle) * 14, cy + Math.sin(outerAngle) * 14);
                        else ctx.lineTo(cx + Math.cos(outerAngle) * 14, cy + Math.sin(outerAngle) * 14);
                        ctx.lineTo(cx + Math.cos(innerAngle) * 6, cy + Math.sin(innerAngle) * 6);
                    }
                    ctx.closePath();
                    ctx.fill();
                    break;
                    
                case 'car':
                    ctx.fillStyle = color;
                    ctx.fillRect(cx - 14, cy - 4, 28, 10);
                    ctx.fillRect(cx - 8, cy - 10, 16, 8);
                    ctx.fillStyle = accent;
                    ctx.beginPath();
                    ctx.arc(cx - 8, cy + 8, 4, 0, Math.PI * 2);
                    ctx.arc(cx + 8, cy + 8, 4, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.fillStyle = '#a0d8ef';
                    ctx.fillRect(cx - 6, cy - 8, 12, 5);
                    break;
                    
                case 'fortress':
                    ctx.fillStyle = color;
                    ctx.fillRect(cx - 14, cy - 4, 28, 18);
                    ctx.fillRect(cx - 16, cy - 10, 8, 10);
                    ctx.fillRect(cx + 8, cy - 10, 8, 10);
                    ctx.fillRect(cx - 4, cy - 14, 8, 14);
                    ctx.fillStyle = accent;
                    ctx.fillRect(cx - 3, cy + 4, 6, 10);
                    break;
                    
                case 'column':
                case 'arch':
                    ctx.fillStyle = color;
                    ctx.fillRect(cx - 12, cy - 14, 6, 28);
                    ctx.fillRect(cx + 6, cy - 14, 6, 28);
                    ctx.fillRect(cx - 14, cy - 16, 28, 4);
                    ctx.fillRect(cx - 14, cy + 12, 28, 4);
                    ctx.fillStyle = accent;
                    ctx.beginPath();
                    ctx.arc(cx, cy - 8, 8, Math.PI, 0);
                    ctx.fill();
                    break;
                    
                case 'mountain':
                    ctx.fillStyle = color;
                    ctx.beginPath();
                    ctx.moveTo(cx - 18, cy + 14);
                    ctx.lineTo(cx - 4, cy - 12);
                    ctx.lineTo(cx + 2, cy - 4);
                    ctx.lineTo(cx + 10, cy - 14);
                    ctx.lineTo(cx + 18, cy + 14);
                    ctx.closePath();
                    ctx.fill();
                    ctx.fillStyle = accent;
                    ctx.beginPath();
                    ctx.moveTo(cx - 4, cy - 12);
                    ctx.lineTo(cx - 8, cy - 4);
                    ctx.lineTo(cx, cy - 6);
                    ctx.lineTo(cx + 2, cy - 4);
                    ctx.closePath();
                    ctx.fill();
                    ctx.beginPath();
                    ctx.moveTo(cx + 10, cy - 14);
                    ctx.lineTo(cx + 6, cy - 6);
                    ctx.lineTo(cx + 14, cy - 6);
                    ctx.closePath();
                    ctx.fill();
                    break;
                    
                case 'shark':
                    ctx.fillStyle = color;
                    ctx.beginPath();
                    ctx.moveTo(cx - 16, cy);
                    ctx.quadraticCurveTo(cx, cy - 10, cx + 16, cy);
                    ctx.quadraticCurveTo(cx, cy + 6, cx - 16, cy);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.moveTo(cx, cy - 6);
                    ctx.lineTo(cx - 4, cy - 16);
                    ctx.lineTo(cx + 4, cy - 6);
                    ctx.fill();
                    ctx.fillStyle = accent;
                    ctx.beginPath();
                    ctx.arc(cx - 8, cy - 2, 2, 0, Math.PI * 2);
                    ctx.fill();
                    break;
                    
                case 'mango':
                    ctx.fillStyle = color;
                    ctx.beginPath();
                    ctx.ellipse(cx, cy + 2, 12, 16, 0.2, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.fillStyle = accent;
                    ctx.beginPath();
                    ctx.ellipse(cx - 2, cy - 12, 4, 6, -0.5, 0, Math.PI * 2);
                    ctx.fill();
                    break;
                    
                case 'palm':
                    ctx.fillStyle = '#8b4513';
                    ctx.fillRect(cx - 2, cy, 4, 16);
                    ctx.fillStyle = accent;
                    for (let i = 0; i < 5; i++) {
                        const angle = -Math.PI / 2 + (i - 2) * 0.4;
                        ctx.beginPath();
                        ctx.moveTo(cx, cy);
                        ctx.quadraticCurveTo(
                            cx + Math.cos(angle) * 10, cy + Math.sin(angle) * 10 - 5,
                            cx + Math.cos(angle) * 16, cy + Math.sin(angle) * 16
                        );
                        ctx.lineWidth = 3;
                        ctx.strokeStyle = accent;
                        ctx.stroke();
                    }
                    break;
                    
                case 'whale':
                    ctx.fillStyle = color;
                    ctx.beginPath();
                    ctx.moveTo(cx, cy + 10);
                    ctx.quadraticCurveTo(cx - 6, cy, cx - 14, cy - 10);
                    ctx.quadraticCurveTo(cx - 10, cy - 6, cx, cy - 4);
                    ctx.quadraticCurveTo(cx + 10, cy - 6, cx + 14, cy - 10);
                    ctx.quadraticCurveTo(cx + 6, cy, cx, cy + 10);
                    ctx.fill();
                    break;
                    
                case 'coffee':
                    ctx.fillStyle = color;
                    ctx.fillRect(cx - 8, cy - 6, 16, 16);
                    ctx.strokeStyle = accent;
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.arc(cx + 10, cy + 2, 6, -Math.PI / 2, Math.PI / 2);
                    ctx.stroke();
                    ctx.fillStyle = accent;
                    ctx.beginPath();
                    ctx.moveTo(cx - 4, cy - 10);
                    ctx.quadraticCurveTo(cx - 6, cy - 14, cx - 4, cy - 16);
                    ctx.quadraticCurveTo(cx, cy - 12, cx, cy - 10);
                    ctx.stroke();
                    break;
                    
                case 'sun-hot':
                    ctx.fillStyle = color;
                    ctx.beginPath();
                    ctx.arc(cx, cy, 10, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.strokeStyle = accent;
                    ctx.lineWidth = 3;
                    for (let i = 0; i < 8; i++) {
                        const angle = (i / 8) * Math.PI * 2;
                        ctx.beginPath();
                        ctx.moveTo(cx + Math.cos(angle) * 12, cy + Math.sin(angle) * 12);
                        ctx.lineTo(cx + Math.cos(angle) * 16, cy + Math.sin(angle) * 16);
                        ctx.stroke();
                    }
                    break;
                    
                case 'compass':
                    ctx.strokeStyle = color;
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(cx, cy, 13, 0, Math.PI * 2);
                    ctx.stroke();
                    ctx.fillStyle = accent;
                    ctx.beginPath();
                    ctx.moveTo(cx, cy - 10);
                    ctx.lineTo(cx + 3, cy);
                    ctx.lineTo(cx, cy + 10);
                    ctx.lineTo(cx - 3, cy);
                    ctx.closePath();
                    ctx.fill();
                    ctx.fillStyle = color;
                    ctx.beginPath();
                    ctx.moveTo(cx, cy + 10);
                    ctx.lineTo(cx + 3, cy);
                    ctx.lineTo(cx, cy - 2);
                    ctx.lineTo(cx - 3, cy);
                    ctx.closePath();
                    ctx.fill();
                    break;
                    
                case 'penguin':
                    ctx.fillStyle = color;
                    ctx.beginPath();
                    ctx.ellipse(cx, cy + 2, 10, 14, 0, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.fillStyle = '#f5f0e8';
                    ctx.beginPath();
                    ctx.ellipse(cx, cy + 4, 6, 10, 0, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.fillStyle = accent;
                    ctx.beginPath();
                    ctx.moveTo(cx - 2, cy - 6);
                    ctx.lineTo(cx, cy - 2);
                    ctx.lineTo(cx + 2, cy - 6);
                    ctx.fill();
                    break;
                
                case 'grave':
                    // Celtic cross for Shackleton's grave
                    ctx.fillStyle = color;
                    // Vertical beam
                    ctx.fillRect(cx - 2, cy - 12, 4, 22);
                    // Horizontal beam
                    ctx.fillRect(cx - 8, cy - 6, 16, 4);
                    // Circle behind cross intersection
                    ctx.strokeStyle = color;
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(cx, cy - 4, 6, 0, Math.PI * 2);
                    ctx.stroke();
                    // Small base
                    ctx.fillRect(cx - 5, cy + 8, 10, 4);
                    break;
                
                case 'whalingboat':
                    // Rusty old whaling boat - weathered and listing
                    ctx.fillStyle = color; // rusty brown
                    // Hull - slightly tilted/listing
                    ctx.beginPath();
                    ctx.moveTo(cx - 14, cy + 2);
                    ctx.lineTo(cx - 12, cy + 10);
                    ctx.lineTo(cx + 10, cy + 12);
                    ctx.lineTo(cx + 14, cy + 4);
                    ctx.closePath();
                    ctx.fill();
                    // Rust patches
                    ctx.fillStyle = accent;
                    ctx.beginPath();
                    ctx.ellipse(cx - 4, cy + 7, 3, 2, 0.2, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.ellipse(cx + 6, cy + 6, 2, 1.5, -0.1, 0, Math.PI * 2);
                    ctx.fill();
                    // Broken mast - tilted
                    ctx.fillStyle = '#5c4033';
                    ctx.save();
                    ctx.translate(cx, cy);
                    ctx.rotate(-0.15);
                    ctx.fillRect(-1, -14, 2, 16);
                    ctx.restore();
                    // Tattered remnant of rigging
                    ctx.strokeStyle = '#4a3728';
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.moveTo(cx - 1, cy - 10);
                    ctx.lineTo(cx + 8, cy + 2);
                    ctx.stroke();
                    break;
                
                case 'beer':
                    // Beer mug with foam
                    ctx.fillStyle = color; // amber/golden
                    // Mug body
                    ctx.beginPath();
                    ctx.moveTo(cx - 8, cy - 6);
                    ctx.lineTo(cx - 7, cy + 10);
                    ctx.lineTo(cx + 7, cy + 10);
                    ctx.lineTo(cx + 8, cy - 6);
                    ctx.closePath();
                    ctx.fill();
                    // Handle
                    ctx.strokeStyle = color;
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.arc(cx + 12, cy + 2, 5, -Math.PI * 0.5, Math.PI * 0.5);
                    ctx.stroke();
                    // Foam top
                    ctx.fillStyle = accent; // white/cream foam
                    ctx.beginPath();
                    ctx.ellipse(cx - 4, cy - 8, 5, 4, 0, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.ellipse(cx + 3, cy - 7, 5, 4, 0, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.ellipse(cx, cy - 10, 4, 3, 0, 0, Math.PI * 2);
                    ctx.fill();
                    // Foam drip
                    ctx.beginPath();
                    ctx.ellipse(cx - 6, cy - 4, 2, 3, 0.2, 0, Math.PI * 2);
                    ctx.fill();
                    break;
                    
                case 'boat':
                    ctx.fillStyle = color;
                    ctx.beginPath();
                    ctx.moveTo(cx - 14, cy + 4);
                    ctx.lineTo(cx - 10, cy + 10);
                    ctx.lineTo(cx + 10, cy + 10);
                    ctx.lineTo(cx + 14, cy + 4);
                    ctx.closePath();
                    ctx.fill();
                    ctx.fillStyle = accent;
                    ctx.fillRect(cx - 1, cy - 10, 2, 16);
                    ctx.beginPath();
                    ctx.moveTo(cx + 1, cy - 8);
                    ctx.lineTo(cx + 12, cy);
                    ctx.lineTo(cx + 1, cy + 4);
                    ctx.fill();
                    break;
                    
                case 'wine':
                    ctx.strokeStyle = color;
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(cx - 8, cy - 10);
                    ctx.quadraticCurveTo(cx - 10, cy - 2, cx, cy + 2);
                    ctx.quadraticCurveTo(cx + 10, cy - 2, cx + 8, cy - 10);
                    ctx.stroke();
                    ctx.beginPath();
                    ctx.moveTo(cx, cy + 2);
                    ctx.lineTo(cx, cy + 12);
                    ctx.moveTo(cx - 6, cy + 12);
                    ctx.lineTo(cx + 6, cy + 12);
                    ctx.stroke();
                    ctx.fillStyle = accent;
                    ctx.beginPath();
                    ctx.arc(cx, cy - 4, 5, 0, Math.PI);
                    ctx.fill();
                    break;
                    
                case 'grapes':
                    ctx.fillStyle = color;
                    const grapePositions = [[0,-8],[5,-4],[-5,-4],[0,0],[8,0],[-8,0],[3,6],[-3,6],[0,10]];
                    grapePositions.forEach(([x, y]) => {
                        ctx.beginPath();
                        ctx.arc(cx + x, cy + y, 4, 0, Math.PI * 2);
                        ctx.fill();
                    });
                    ctx.fillStyle = accent;
                    ctx.fillRect(cx - 1, cy - 14, 2, 6);
                    break;
                    
                case 'guitar':
                    ctx.fillStyle = color;
                    ctx.beginPath();
                    ctx.ellipse(cx, cy + 6, 10, 8, 0, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.ellipse(cx, cy - 2, 6, 5, 0, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.fillStyle = accent;
                    ctx.fillRect(cx - 2, cy - 16, 4, 14);
                    ctx.fillStyle = '#1a1a1a';
                    ctx.beginPath();
                    ctx.arc(cx, cy + 6, 3, 0, Math.PI * 2);
                    ctx.fill();
                    break;
                
                // === NEW UNIQUE ICONS ===
                
                case 'colosseum':
                    // Roman Colosseum - arched structure
                    ctx.fillStyle = color;
                    ctx.fillRect(cx - 16, cy - 8, 32, 20);
                    // Arches
                    ctx.fillStyle = '#1a1a1a';
                    for (let i = -1; i <= 1; i++) {
                        ctx.beginPath();
                        ctx.arc(cx + i * 10, cy + 4, 4, Math.PI, 0);
                        ctx.fill();
                    }
                    // Top tier arches (smaller)
                    for (let i = -1; i <= 1; i++) {
                        ctx.beginPath();
                        ctx.arc(cx + i * 10, cy - 4, 3, Math.PI, 0);
                        ctx.fill();
                    }
                    // Curved top edge
                    ctx.fillStyle = color;
                    ctx.beginPath();
                    ctx.ellipse(cx, cy - 8, 16, 4, 0, Math.PI, 0);
                    ctx.fill();
                    break;
                    
                case 'library':
                    // Library of Celsus - facade with columns
                    ctx.fillStyle = color;
                    // Base structure
                    ctx.fillRect(cx - 14, cy - 6, 28, 20);
                    // Triangular pediment
                    ctx.beginPath();
                    ctx.moveTo(cx - 14, cy - 6);
                    ctx.lineTo(cx, cy - 16);
                    ctx.lineTo(cx + 14, cy - 6);
                    ctx.closePath();
                    ctx.fill();
                    // Columns
                    ctx.fillStyle = accent;
                    ctx.fillRect(cx - 12, cy - 4, 3, 16);
                    ctx.fillRect(cx - 4, cy - 4, 3, 16);
                    ctx.fillRect(cx + 1, cy - 4, 3, 16);
                    ctx.fillRect(cx + 9, cy - 4, 3, 16);
                    // Door
                    ctx.fillStyle = '#1a1a1a';
                    ctx.fillRect(cx - 3, cy + 4, 6, 10);
                    break;
                    
                case 'venus':
                    // Venus de Milo silhouette
                    ctx.fillStyle = color;
                    // Head
                    ctx.beginPath();
                    ctx.arc(cx, cy - 10, 5, 0, Math.PI * 2);
                    ctx.fill();
                    // Torso (armless)
                    ctx.beginPath();
                    ctx.moveTo(cx - 6, cy - 4);
                    ctx.quadraticCurveTo(cx - 8, cy + 2, cx - 5, cy + 10);
                    ctx.lineTo(cx + 5, cy + 10);
                    ctx.quadraticCurveTo(cx + 8, cy + 2, cx + 6, cy - 4);
                    ctx.closePath();
                    ctx.fill();
                    // Draping
                    ctx.strokeStyle = accent;
                    ctx.lineWidth = 1.5;
                    ctx.beginPath();
                    ctx.moveTo(cx - 4, cy + 2);
                    ctx.quadraticCurveTo(cx, cy + 4, cx + 4, cy + 2);
                    ctx.stroke();
                    break;
                    
                case 'amphitheater':
                    // Greek amphitheater - semicircle with tiers
                    ctx.fillStyle = color;
                    ctx.beginPath();
                    ctx.arc(cx, cy + 6, 16, Math.PI, 0);
                    ctx.fill();
                    // Tier lines
                    ctx.strokeStyle = accent;
                    ctx.lineWidth = 1.5;
                    ctx.beginPath();
                    ctx.arc(cx, cy + 6, 12, Math.PI, 0);
                    ctx.stroke();
                    ctx.beginPath();
                    ctx.arc(cx, cy + 6, 8, Math.PI, 0);
                    ctx.stroke();
                    // Stage
                    ctx.fillStyle = accent;
                    ctx.fillRect(cx - 6, cy + 4, 12, 4);
                    break;
                    
                case 'lighthouse':
                    // Lighthouse of Alexandria
                    ctx.fillStyle = color;
                    // Tower (tapered)
                    ctx.beginPath();
                    ctx.moveTo(cx - 8, cy + 14);
                    ctx.lineTo(cx - 4, cy - 8);
                    ctx.lineTo(cx + 4, cy - 8);
                    ctx.lineTo(cx + 8, cy + 14);
                    ctx.closePath();
                    ctx.fill();
                    // Light chamber
                    ctx.fillStyle = accent;
                    ctx.fillRect(cx - 5, cy - 12, 10, 6);
                    // Light beam
                    ctx.fillStyle = '#ffd700';
                    ctx.beginPath();
                    ctx.moveTo(cx, cy - 14);
                    ctx.lineTo(cx - 8, cy - 20);
                    ctx.lineTo(cx + 8, cy - 20);
                    ctx.closePath();
                    ctx.fill();
                    break;
                    
                case 'cross':
                    // Maltese Cross
                    ctx.fillStyle = color;
                    // Vertical bar
                    ctx.fillRect(cx - 3, cy - 14, 6, 28);
                    // Horizontal bar
                    ctx.fillRect(cx - 12, cy - 4, 24, 6);
                    // Pointed ends (V shapes)
                    ctx.fillStyle = accent;
                    ctx.beginPath();
                    // Top
                    ctx.moveTo(cx - 3, cy - 14);
                    ctx.lineTo(cx, cy - 18);
                    ctx.lineTo(cx + 3, cy - 14);
                    // Bottom
                    ctx.moveTo(cx - 3, cy + 14);
                    ctx.lineTo(cx, cy + 18);
                    ctx.lineTo(cx + 3, cy + 14);
                    // Left
                    ctx.moveTo(cx - 12, cy - 4);
                    ctx.lineTo(cx - 16, cy - 1);
                    ctx.lineTo(cx - 12, cy + 2);
                    // Right
                    ctx.moveTo(cx + 12, cy - 4);
                    ctx.lineTo(cx + 16, cy - 1);
                    ctx.lineTo(cx + 12, cy + 2);
                    ctx.fill();
                    break;
                    
                case 'gateway':
                    // Gateway of India - arch monument
                    ctx.fillStyle = color;
                    // Main arch structure
                    ctx.fillRect(cx - 14, cy - 10, 6, 24);
                    ctx.fillRect(cx + 8, cy - 10, 6, 24);
                    // Top connecting piece
                    ctx.fillRect(cx - 14, cy - 14, 28, 6);
                    // Central arch
                    ctx.beginPath();
                    ctx.arc(cx, cy + 2, 8, Math.PI, 0);
                    ctx.fillStyle = '#1a1a1a';
                    ctx.fill();
                    // Decorative top
                    ctx.fillStyle = accent;
                    ctx.beginPath();
                    ctx.arc(cx, cy - 14, 4, Math.PI, 0);
                    ctx.fill();
                    break;
                    
                case 'menorah':
                    // Menorah
                    ctx.strokeStyle = color;
                    ctx.lineWidth = 2;
                    // Base
                    ctx.beginPath();
                    ctx.moveTo(cx - 8, cy + 14);
                    ctx.lineTo(cx + 8, cy + 14);
                    ctx.lineTo(cx + 4, cy + 10);
                    ctx.lineTo(cx - 4, cy + 10);
                    ctx.closePath();
                    ctx.fillStyle = color;
                    ctx.fill();
                    // Central stem
                    ctx.beginPath();
                    ctx.moveTo(cx, cy + 10);
                    ctx.lineTo(cx, cy - 8);
                    ctx.stroke();
                    // Branches (3 on each side)
                    const branchY = [cy - 8, cy - 8, cy - 8];
                    ctx.beginPath();
                    ctx.moveTo(cx - 10, cy + 4);
                    ctx.quadraticCurveTo(cx - 10, cy - 4, cx - 10, cy - 8);
                    ctx.moveTo(cx - 6, cy + 2);
                    ctx.quadraticCurveTo(cx - 6, cy - 2, cx - 6, cy - 8);
                    ctx.moveTo(cx + 10, cy + 4);
                    ctx.quadraticCurveTo(cx + 10, cy - 4, cx + 10, cy - 8);
                    ctx.moveTo(cx + 6, cy + 2);
                    ctx.quadraticCurveTo(cx + 6, cy - 2, cx + 6, cy - 8);
                    ctx.stroke();
                    // Flames
                    ctx.fillStyle = accent;
                    [-10, -6, 0, 6, 10].forEach(x => {
                        ctx.beginPath();
                        ctx.ellipse(cx + x, cy - 11, 2, 3, 0, 0, Math.PI * 2);
                        ctx.fill();
                    });
                    break;
                    
                case 'mosaic':
                    // Gaudi-style mosaic pattern
                    ctx.fillStyle = color;
                    ctx.beginPath();
                    ctx.arc(cx, cy, 14, 0, Math.PI * 2);
                    ctx.fill();
                    // Mosaic pieces
                    const colors = [accent, '#4a90a0', '#228b22', '#ffd700'];
                    const pieces = [
                        [-6, -6], [2, -8], [8, -2], [6, 6], [-2, 8], [-8, 2], [0, 0]
                    ];
                    pieces.forEach((pos, i) => {
                        ctx.fillStyle = colors[i % colors.length];
                        ctx.beginPath();
                        ctx.moveTo(cx + pos[0], cy + pos[1]);
                        ctx.lineTo(cx + pos[0] + 4, cy + pos[1] - 2);
                        ctx.lineTo(cx + pos[0] + 6, cy + pos[1] + 2);
                        ctx.lineTo(cx + pos[0] + 2, cy + pos[1] + 4);
                        ctx.closePath();
                        ctx.fill();
                    });
                    break;
                    
                case 'yacht':
                    // Luxury yacht
                    ctx.fillStyle = color;
                    // Hull
                    ctx.beginPath();
                    ctx.moveTo(cx - 16, cy + 4);
                    ctx.lineTo(cx - 12, cy + 10);
                    ctx.lineTo(cx + 14, cy + 10);
                    ctx.lineTo(cx + 16, cy + 4);
                    ctx.quadraticCurveTo(cx + 14, cy + 2, cx - 14, cy + 2);
                    ctx.closePath();
                    ctx.fill();
                    // Cabin
                    ctx.fillStyle = accent;
                    ctx.fillRect(cx - 8, cy - 2, 14, 6);
                    // Windows
                    ctx.fillStyle = '#a0d8ef';
                    ctx.fillRect(cx - 6, cy - 1, 3, 3);
                    ctx.fillRect(cx, cy - 1, 3, 3);
                    // Mast
                    ctx.fillStyle = color;
                    ctx.fillRect(cx - 1, cy - 10, 2, 10);
                    break;
                    
                case 'violin':
                    // Violin (Tartini - Piran connection)
                    ctx.fillStyle = color;
                    // Body
                    ctx.beginPath();
                    ctx.ellipse(cx, cy + 4, 8, 10, 0, 0, Math.PI * 2);
                    ctx.fill();
                    // Waist curves
                    ctx.fillStyle = '#1a1a1a';
                    ctx.beginPath();
                    ctx.ellipse(cx - 8, cy + 2, 3, 5, 0.3, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.ellipse(cx + 8, cy + 2, 3, 5, -0.3, 0, Math.PI * 2);
                    ctx.fill();
                    // Neck
                    ctx.fillStyle = accent;
                    ctx.fillRect(cx - 2, cy - 14, 4, 12);
                    // Scroll
                    ctx.beginPath();
                    ctx.arc(cx, cy - 16, 3, 0, Math.PI * 2);
                    ctx.fill();
                    // F-holes
                    ctx.strokeStyle = '#1a1a1a';
                    ctx.lineWidth = 1.5;
                    ctx.beginPath();
                    ctx.moveTo(cx - 3, cy);
                    ctx.quadraticCurveTo(cx - 4, cy + 4, cx - 2, cy + 6);
                    ctx.moveTo(cx + 3, cy);
                    ctx.quadraticCurveTo(cx + 4, cy + 4, cx + 2, cy + 6);
                    ctx.stroke();
                    break;
                    
                case 'champagne':
                    // Champagne glass
                    ctx.strokeStyle = color;
                    ctx.lineWidth = 2;
                    // Glass bowl (flute shape)
                    ctx.beginPath();
                    ctx.moveTo(cx - 6, cy - 12);
                    ctx.lineTo(cx - 4, cy + 2);
                    ctx.lineTo(cx + 4, cy + 2);
                    ctx.lineTo(cx + 6, cy - 12);
                    ctx.stroke();
                    // Stem
                    ctx.beginPath();
                    ctx.moveTo(cx, cy + 2);
                    ctx.lineTo(cx, cy + 10);
                    ctx.stroke();
                    // Base
                    ctx.beginPath();
                    ctx.moveTo(cx - 6, cy + 10);
                    ctx.lineTo(cx + 6, cy + 10);
                    ctx.stroke();
                    // Bubbles
                    ctx.fillStyle = accent;
                    ctx.beginPath();
                    ctx.arc(cx - 2, cy - 6, 2, 0, Math.PI * 2);
                    ctx.arc(cx + 1, cy - 2, 1.5, 0, Math.PI * 2);
                    ctx.arc(cx - 1, cy - 10, 1.5, 0, Math.PI * 2);
                    ctx.fill();
                    break;
                    
                case 'dj':
                    // DJ turntable/headphones
                    ctx.fillStyle = color;
                    // Headphone band
                    ctx.strokeStyle = color;
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.arc(cx, cy - 4, 12, Math.PI, 0);
                    ctx.stroke();
                    // Ear cups
                    ctx.fillStyle = color;
                    ctx.fillRect(cx - 14, cy - 6, 6, 12);
                    ctx.fillRect(cx + 8, cy - 6, 6, 12);
                    // Record/vinyl underneath
                    ctx.fillStyle = accent;
                    ctx.beginPath();
                    ctx.arc(cx, cy + 8, 8, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.fillStyle = '#1a1a1a';
                    ctx.beginPath();
                    ctx.arc(cx, cy + 8, 3, 0, Math.PI * 2);
                    ctx.fill();
                    break;
                    
                case 'iceberg':
                    // Iceberg
                    ctx.fillStyle = color;
                    // Above water (visible part)
                    ctx.beginPath();
                    ctx.moveTo(cx - 10, cy);
                    ctx.lineTo(cx - 4, cy - 14);
                    ctx.lineTo(cx + 2, cy - 8);
                    ctx.lineTo(cx + 8, cy - 12);
                    ctx.lineTo(cx + 12, cy);
                    ctx.closePath();
                    ctx.fill();
                    // Below water (larger, transparent)
                    ctx.fillStyle = 'rgba(160, 200, 220, 0.4)';
                    ctx.beginPath();
                    ctx.moveTo(cx - 14, cy);
                    ctx.lineTo(cx - 8, cy + 14);
                    ctx.lineTo(cx + 10, cy + 14);
                    ctx.lineTo(cx + 14, cy);
                    ctx.closePath();
                    ctx.fill();
                    // Water line
                    ctx.strokeStyle = accent;
                    ctx.lineWidth = 1.5;
                    ctx.beginPath();
                    ctx.moveTo(cx - 16, cy);
                    ctx.lineTo(cx + 16, cy);
                    ctx.stroke();
                    break;
                    
                case 'witch':
                    // Witch hat (Salem)
                    ctx.fillStyle = color;
                    // Hat cone
                    ctx.beginPath();
                    ctx.moveTo(cx, cy - 16);
                    ctx.lineTo(cx - 10, cy + 2);
                    ctx.lineTo(cx + 10, cy + 2);
                    ctx.closePath();
                    ctx.fill();
                    // Hat brim
                    ctx.beginPath();
                    ctx.ellipse(cx, cy + 2, 14, 4, 0, 0, Math.PI * 2);
                    ctx.fill();
                    // Buckle
                    ctx.fillStyle = accent;
                    ctx.fillRect(cx - 4, cy - 4, 8, 6);
                    ctx.fillStyle = color;
                    ctx.fillRect(cx - 2, cy - 2, 4, 3);
                    break;
                
                case 'opera':
                    // Theater/opera masks - comedy and tragedy
                    // Happy mask (left, slightly up)
                    ctx.fillStyle = color;
                    ctx.beginPath();
                    ctx.ellipse(cx - 7, cy - 2, 9, 11, -0.2, 0, Math.PI * 2);
                    ctx.fill();
                    // Happy face details
                    ctx.fillStyle = accent;
                    ctx.beginPath();
                    ctx.arc(cx - 10, cy - 5, 2, 0, Math.PI * 2); // left eye
                    ctx.arc(cx - 4, cy - 6, 2, 0, Math.PI * 2);  // right eye
                    ctx.fill();
                    ctx.beginPath();
                    ctx.arc(cx - 7, cy + 2, 4, 0, Math.PI); // smile
                    ctx.stroke();
                    
                    // Sad mask (right, slightly down)
                    ctx.fillStyle = color;
                    ctx.beginPath();
                    ctx.ellipse(cx + 7, cy + 2, 9, 11, 0.2, 0, Math.PI * 2);
                    ctx.fill();
                    // Sad face details
                    ctx.fillStyle = accent;
                    ctx.beginPath();
                    ctx.arc(cx + 4, cy - 1, 2, 0, Math.PI * 2);  // left eye
                    ctx.arc(cx + 10, cy, 2, 0, Math.PI * 2);     // right eye
                    ctx.fill();
                    ctx.beginPath();
                    ctx.arc(cx + 7, cy + 8, 4, Math.PI, 0); // frown
                    ctx.stroke();
                    break;
                    
                default:
                    // Fallback - simple circle with pin
                    ctx.fillStyle = color;
                    ctx.beginPath();
                    ctx.arc(cx, cy, 12, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.fillStyle = accent;
                    ctx.beginPath();
                    ctx.arc(cx, cy, 5, 0, Math.PI * 2);
                    ctx.fill();
            }
        }
        
        // Main function to draw a porthole icon
        function drawPortholeIcon(canvas, config, isDoor, openAmount) {
            const ctx = canvas.getContext('2d');
            const w = canvas.width;
            const h = canvas.height;
            
            ctx.clearRect(0, 0, w, h);
            
            const cx = w / 2;
            const cy = isDoor ? h / 2 : h / 2 - 12; // Center doors vertically (no base)
            const radius = isDoor ? 44 : 38;
            
            if (isDoor) {
                // === DOOR PORTHOLE: Clear glass with door visible behind ===
                
                // Layer 1: Dark interior behind the door
                ctx.fillStyle = '#1a1a2e';
                ctx.beginPath();
                ctx.arc(cx, cy, radius - 3, 0, Math.PI * 2);
                ctx.fill();
                
                // Layer 2: The door (always visible through glass)
                ctx.save();
                ctx.beginPath();
                ctx.arc(cx, cy, radius - 5, 0, Math.PI * 2);
                ctx.clip();
                draw3DDoor(ctx, cx, cy, config.color || '#6a5a4a', 1); // Always draw door at full opacity
                ctx.restore();
                
                // Layer 3: Clear glass overlay with subtle reflections
                drawClearGlass(ctx, cx, cy, radius - 3);
                
                // Layer 4: Brass porthole frame
                drawPortholeFrame(ctx, cx, cy, radius);
                
                // NO BASE for doors
                
            } else {
                // === REGULAR ICONS: Keep existing behavior ===
                
                // Layer 1: Black background
                ctx.fillStyle = '#0a0a0a';
                ctx.beginPath();
                ctx.arc(cx, cy, radius - 3, 0, Math.PI * 2);
                ctx.fill();
                
                // Layer 2: The icon content
                ctx.save();
                ctx.beginPath();
                ctx.arc(cx, cy, radius - 5, 0, Math.PI * 2);
                ctx.clip();
                drawRegularIcon(ctx, cx, cy, config, openAmount);
                ctx.restore();
                
                // Layer 3: Brass porthole frame
                drawPortholeFrame(ctx, cx, cy, radius);
                
                // Layer 4: Base for regular icons
                drawPortholeBase(ctx, cx, cy + radius, isDoor);
            }
        }
        
        // Draw clear glass effect for door portholes
        function drawClearGlass(ctx, cx, cy, radius) {
            // Subtle blue-ish tint like real glass
            ctx.fillStyle = 'rgba(200, 220, 240, 0.08)';
            ctx.beginPath();
            ctx.arc(cx, cy, radius, 0, Math.PI * 2);
            ctx.fill();
            
            // Main highlight (top-left reflection)
            ctx.fillStyle = 'rgba(255, 255, 255, 0.25)';
            ctx.beginPath();
            ctx.ellipse(cx - radius * 0.3, cy - radius * 0.3, radius * 0.35, radius * 0.15, -0.6, 0, Math.PI * 2);
            ctx.fill();
            
            // Secondary smaller highlight
            ctx.fillStyle = 'rgba(255, 255, 255, 0.12)';
            ctx.beginPath();
            ctx.ellipse(cx - radius * 0.15, cy - radius * 0.5, radius * 0.15, radius * 0.06, -0.4, 0, Math.PI * 2);
            ctx.fill();
            
            // Subtle rim light around edge
            const rimGrad = ctx.createRadialGradient(cx, cy, radius * 0.7, cx, cy, radius);
            rimGrad.addColorStop(0, 'rgba(255, 255, 255, 0)');
            rimGrad.addColorStop(0.8, 'rgba(255, 255, 255, 0)');
            rimGrad.addColorStop(1, 'rgba(255, 255, 255, 0.1)');
            ctx.fillStyle = rimGrad;
            ctx.beginPath();
            ctx.arc(cx, cy, radius, 0, Math.PI * 2);
            ctx.fill();
        }
        
        // Draw smoky glass bubble effect for regular icons
        function drawSmokyGlassBubble(ctx, cx, cy, radius) {
            // Outer smoky edge
            const smokyGrad = ctx.createRadialGradient(cx, cy, radius * 0.5, cx, cy, radius);
            smokyGrad.addColorStop(0, 'rgba(30, 45, 65, 0)');
            smokyGrad.addColorStop(0.6, 'rgba(30, 45, 65, 0.1)');
            smokyGrad.addColorStop(0.85, 'rgba(25, 40, 60, 0.35)');
            smokyGrad.addColorStop(1, 'rgba(20, 35, 55, 0.5)');
            
            ctx.fillStyle = smokyGrad;
            ctx.beginPath();
            ctx.arc(cx, cy, radius, 0, Math.PI * 2);
            ctx.fill();
            
            // Glass highlight (top left reflection)
            ctx.fillStyle = 'rgba(255, 255, 255, 0.15)';
            ctx.beginPath();
            ctx.ellipse(cx - radius * 0.3, cy - radius * 0.35, radius * 0.25, radius * 0.12, -0.5, 0, Math.PI * 2);
            ctx.fill();
            
            // Subtle inner rim highlight
            ctx.strokeStyle = 'rgba(150, 180, 210, 0.2)';
            ctx.lineWidth = 1.5;
            ctx.beginPath();
            ctx.arc(cx, cy, radius - 1, 0, Math.PI * 2);
            ctx.stroke();
        }
        
        // Map symbol names to emojis
        function getEmojiForSymbol(symbol) {
            const emojiMap = {
                'sunrise': 'ðŸŒ…',
                'sunset': 'ðŸŒ…',
                'palm': 'ðŸŒ´',
                'waves': 'ðŸŒŠ',
                'star': 'â­',
                'cocktail': 'ðŸ¹',
                'mountain': 'ðŸ”ï¸',
                'anchor': 'âš“',
                'ship': 'ðŸš¢',
                'compass': 'ðŸ§­',
                'guitar': 'ðŸŽ¸',
                'music': 'ðŸŽµ',
                'crown': 'ðŸ‘‘',
                'mask': 'ðŸŽ­',
                'temple': 'â›©ï¸',
                'church': 'â›ª',
                'castle': 'ðŸ°',
                'cityscape': 'ðŸ™ï¸',
                'island': 'ðŸï¸',
                'fish': 'ðŸŸ',
                'coral': 'ðŸª¸',
                'whale': 'ðŸ‹',
                'dolphin': 'ðŸ¬',
                'turtle': 'ðŸ¢',
                'shell': 'ðŸš',
                'sparkle': 'âœ¨',
                'fireworks': 'ðŸŽ†',
                'car': 'ðŸš—',
                'fortress': 'ðŸ°',
                'column': 'ðŸ›ï¸',
                'arch': 'ðŸ›ï¸',
                'shark': 'ðŸ¦ˆ',
                'mango': 'ðŸ¥­',
                'coffee': 'â˜•',
                'sun-hot': 'â˜€ï¸',
                'penguin': 'ðŸ§',
                'boat': 'â›µ',
                'wine': 'ðŸ·',
                'grapes': 'ðŸ‡',
                'default': 'ðŸ“',
                'wood-door': 'ðŸšª',
                'gold-door': 'ðŸšª',
                'steel-door': 'ðŸšª'
            };
            return emojiMap[symbol] || emojiMap['default'];
        }
        
        // Start iris open animation for a marker
        function startIrisAnimation(markerId, targetOpen, callback) {
            let anim = markerAnimations.get(markerId);
            if (!anim) {
                anim = { openAmount: 0, targetOpen: 0, isAnimating: false, callback: null };
                markerAnimations.set(markerId, anim);
            }
            
            anim.targetOpen = targetOpen;
            anim.callback = callback;
            
            if (!anim.isAnimating) {
                anim.isAnimating = true;
                animateIris(markerId);
            }
        }
        
        // Animation loop for iris
        function animateIris(markerId) {
            const anim = markerAnimations.get(markerId);
            if (!anim) return;
            
            const diff = anim.targetOpen - anim.openAmount;
            
            if (Math.abs(diff) < 0.01) {
                anim.openAmount = anim.targetOpen;
                anim.isAnimating = false;
                
                // Redraw final state
                updateMarkerTexture(markerId);
                
                // Call callback when animation completes
                if (anim.callback && anim.targetOpen === 1) {
                    anim.callback();
                    anim.callback = null;
                }
                return;
            }
            
            // Easing - faster for snappier animation
            anim.openAmount += diff * 0.18;
            
            // Update the marker texture
            updateMarkerTexture(markerId);
            
            requestAnimationFrame(() => animateIris(markerId));
        }
        
        // Update marker texture during animation
        function updateMarkerTexture(markerId) {
            const marker = markers.find(m => m.userData.id === markerId);
            if (!marker) return;
            
            const anim = markerAnimations.get(markerId);
            if (!anim) return;
            
            // Skip canvas updates for AI porthole markers
            if (marker.userData.useAIPorthole) return;
            
            const canvas = marker.userData.iconCanvas;
            if (!canvas) return; // Safety check
            
            const config = marker.userData.iconConfig;
            const isDoor = marker.userData.isDoor;
            
            drawPortholeIcon(canvas, config, isDoor, anim.openAmount);
            
            // Update Three.js texture
            if (marker.material.map) {
                marker.material.map.needsUpdate = true;
            }
        }
        
        // Get current open amount for a marker
        function getMarkerOpenAmount(markerId) {
            const anim = markerAnimations.get(markerId);
            return anim ? anim.openAmount : 0;
        }
        
        function renderSidebarIcon(canvas, config) {
            const ctx = canvas.getContext('2d');
            const size = canvas.width;
            const cx = size / 2;
            const cy = size / 2;
            
            ctx.clearRect(0, 0, size, size);
            
            // Use the shared icon rendering function
            renderIconSymbol(ctx, cx, cy, config.symbol, config.color, config.accent);
        }
        
        function getIconConfig(title) {
            return ICON_CONFIG[title] || { style: 'minimal', symbol: 'default', color: '#d4a574', accent: '#8b6914' };
        }


        // Calculate density factor for each location based on nearby neighbors
        function calculateDensityFactors() {
            const densityFactors = new Map();
            const proximityThreshold = 15; // Degrees - locations within this range count as neighbors
            const minScale = 0.5;  // Minimum scale factor (50% of original)
            const maxNeighbors = 6; // At this many neighbors, hit minimum scale
            
            locations.forEach(loc => {
                if (loc.isDoor) {
                    // Doors always stay full size
                    densityFactors.set(loc.id, 1.0);
                    return;
                }
                
                // Count nearby non-door locations
                let neighborCount = 0;
                locations.forEach(other => {
                    if (other.id === loc.id) return;
                    
                    // Calculate great circle distance approximation
                    const lat1 = loc.coords[0], lon1 = loc.coords[1];
                    const lat2 = other.coords[0], lon2 = other.coords[1];
                    const dLat = Math.abs(lat2 - lat1);
                    const dLon = Math.abs(lon2 - lon1);
                    const distance = Math.sqrt(dLat * dLat + dLon * dLon);
                    
                    if (distance < proximityThreshold) {
                        neighborCount++;
                    }
                });
                
                // Calculate scale factor: more neighbors = smaller icon
                // 0 neighbors = 1.0 (full size)
                // maxNeighbors or more = minScale
                const densityRatio = Math.min(neighborCount / maxNeighbors, 1.0);
                const scaleFactor = 1.0 - (densityRatio * (1.0 - minScale));
                
                densityFactors.set(loc.id, scaleFactor);
            });
            
            // Store globally for zoom calculations
            globalDensityFactors = densityFactors;
            
            return densityFactors;
        }
        
        // Calculate zoom distance for a location - smaller icons zoom closer to match door appearance
        function getZoomDistanceForLocation(loc) {
            if (!globalDensityFactors || !loc) return baseZoomInDistance;
            
            // Door size is the reference
            const doorSize = 0.040;
            const doorZoom = baseZoomInDistance; // Doors zoom to this distance
            
            // Calculate this location's actual icon size
            let iconSize;
            if (loc.isDoor) {
                iconSize = doorSize;
            } else {
                const densityFactor = globalDensityFactors.get(loc.id) || 1.0;
                const manualOverride = 1.0; // Could look up from sizeOverrides if needed
                iconSize = 0.029 * densityFactor * manualOverride;
            }
            
            // Calculate full proportional zoom
            const fullProportionalZoom = doorZoom * (iconSize / doorSize);
            
            // Blend 50% between base zoom and full proportional (middle ground)
            const blendFactor = 0.5;
            const zoomDistance = doorZoom - (doorZoom - fullProportionalZoom) * blendFactor;
            
            // Clamp to reasonable range
            const minZoom = 1.20;
            return Math.max(zoomDistance, minZoom);
        }
        
        // Custom shader material for video textures with black transparency (chroma key)
        function createVideoChromaMaterial(texture) {
            const vertexShader = `
                varying vec2 vUv;
                void main() {
                    vUv = uv;
                    // Billboard behavior for sprites
                    vec4 mvPosition = modelViewMatrix * vec4(0.0, 0.0, 0.0, 1.0);
                    vec2 scale = vec2(
                        length(vec3(modelMatrix[0].xyz)),
                        length(vec3(modelMatrix[1].xyz))
                    );
                    mvPosition.xy += position.xy * scale;
                    gl_Position = projectionMatrix * mvPosition;
                }
            `;
            
            const fragmentShader = `
                uniform sampler2D map;
                uniform float threshold;
                uniform float softness;
                varying vec2 vUv;
                
                void main() {
                    vec4 texColor = texture2D(map, vUv);
                    
                    // Calculate brightness (luminance)
                    float brightness = (texColor.r + texColor.g + texColor.b) / 3.0;
                    
                    // Create soft edge around threshold
                    float alpha = smoothstep(threshold - softness, threshold + softness, brightness);
                    
                    // Also check for circular mask (porthole shape)
                    vec2 center = vec2(0.5, 0.5);
                    float dist = distance(vUv, center);
                    float radius = 0.46; // Porthole radius
                    float edgeSoftness = 0.02;
                    
                    // Only apply black transparency OUTSIDE the porthole circle
                    // Inside the circle, keep all pixels (including dark ones)
                    float insideCircle = 1.0 - smoothstep(radius - edgeSoftness, radius + edgeSoftness, dist);
                    
                    // Final alpha: inside circle = keep everything, outside = remove black
                    float finalAlpha = mix(alpha, 1.0, insideCircle) * texColor.a;
                    
                    gl_FragColor = vec4(texColor.rgb, finalAlpha);
                }
            `;
            
            const material = new THREE.ShaderMaterial({
                uniforms: {
                    map: { value: texture },
                    threshold: { value: 0.15 }, // Black threshold (0-1)
                    softness: { value: 0.05 }   // Edge softness
                },
                vertexShader: vertexShader,
                fragmentShader: fragmentShader,
                transparent: true,
                depthWrite: false,
                side: THREE.DoubleSide
            });
            
            return material;
        }
        
        // Track which locations use video (for special material handling)
        function isVideoTexture(locationTitle) {
            return locationVideoURLs.hasOwnProperty(locationTitle);
        }
        
        function createMarkers() {
            // Pre-calculate density factors for all locations
            const densityFactors = calculateDensityFactors();
            
            // Manual size adjustments for specific locations (multiplier)
            const sizeOverrides = {
                "Queen Victoria (Cunard)": 1.10,
                "Barcelona, Spain": 1.10,
                "Ibiza, Spain": 1.10,
                "Alexandria, Egypt": 1.10,
                "Tel Aviv, Israel": 1.10,
                // Northern Italy/Adriatic cluster - all shrunk uniformly
                "Venice, Italy": 0.65,
                "Piran, Slovenia": 0.65,
                "Ravenna, Italy": 0.65,
                "Florence, Italy": 0.65,
                "Portovenere, Italy": 0.65,
                "Portofino, Italy": 0.70,
                "Dubrovnik, Croatia": 0.70,
                "Kotor, Montenegro": 0.70,
                "Hvar, Croatia": 0.70,
                "Å ibenik, Croatia": 0.65,
                // Western Greece
                "Corfu, Greece": 0.70,
                "Parga, Greece": 0.65,
                // Aegean - Turkish coast
                "Ephesus, Turkey": 0.60,
                "KuÅŸadasÄ±, Turkey": 0.72,
                "Izmir, Turkey": 0.60,
                "Ã‡eÅŸme, Turkey": 0.55,
                // Aegean - Cyclades
                "Mykonos, Greece": 0.80,
                "Santorini, Greece": 0.80,
                "Milos, Greece": 0.60,
                // Peloponnese cluster
                "Itea, Greece": 0.75,
                "Nafplio, Greece": 0.55,
                "Katakolon, Greece": 0.72,
                "Pylos, Greece": 0.75,
                "Zakynthos, Greece": 0.55,
                // French Riviera cluster - offset handles spacing
                "Le Lavandou, France": 0.85,
                "Monte Carlo, Monaco": 0.85,
                "San Remo, Italy": 0.50,
                "St. Tropez, France": 0.85,
                "Marseille, France": 0.85,
                "Roses, Spain": 0.85,
                // Other Italian
                "Stromboli, Italy": 0.75,
                // Israel
                "Haifa, Israel": 0.85,
                // Indonesia
                "Celukan Bawang, Indonesia": 0.80
            };
            
            // Offset positions for overlapping markers (lat/lng offset)
            const markerOffsets = {
                // New Zealand - spread out close locations
                "Wellington, New Zealand": { latOffset: -0.5, lngOffset: -0.8 },
                "Picton, New Zealand": { latOffset: 0.5, lngOffset: 0.8 },
                "Auckland, New Zealand": { latOffset: 0.5, lngOffset: -0.6 },
                "Tauranga, New Zealand": { latOffset: -0.5, lngOffset: 0.6 },
                // Northern Adriatic - minimal offsets, rely on smaller sizes
                "Venice, Italy": { latOffset: 0.4, lngOffset: -0.6 },
                "Piran, Slovenia": { latOffset: -0.2, lngOffset: 0.6 },
                "Ravenna, Italy": { latOffset: -0.3, lngOffset: 0.5 },
                // Central Italy - spread along coast
                "Florence, Italy": { latOffset: 0.3, lngOffset: 0.2 },
                "Portovenere, Italy": { latOffset: -0.5, lngOffset: 0.6 },
                "Portofino, Italy": { latOffset: 0.4, lngOffset: -0.3 },
                // French Riviera - stagger north/south to avoid overlap
                "Marseille, France": { latOffset: 0.6, lngOffset: -0.3 },
                "Le Lavandou, France": { latOffset: -0.7, lngOffset: -0.2 },
                "St. Tropez, France": { latOffset: 0.8, lngOffset: 0.2 },
                "Monte Carlo, Monaco": { latOffset: -0.6, lngOffset: -0.3 },
                "San Remo, Italy": { latOffset: -0.5, lngOffset: 0.3 },
                "Roses, Spain": { latOffset: -0.3, lngOffset: 0.2 },
                // Corsica
                "Propriano, Corsica": { latOffset: -0.2, lngOffset: 0.2 },
                // Adriatic south - minimal offsets
                "Dubrovnik, Croatia": { latOffset: 0.2, lngOffset: -0.2 },
                "Kotor, Montenegro": { latOffset: -0.2, lngOffset: 0.2 },
                "Hvar, Croatia": { latOffset: -0.4, lngOffset: 0.4 },
                "Å ibenik, Croatia": { latOffset: 0.4, lngOffset: -0.4 },
                // Western Greece - spread Corfu/Parga
                "Corfu, Greece": { latOffset: 0.4, lngOffset: -0.3 },
                "Parga, Greece": { latOffset: -0.4, lngOffset: 0.3 },
                // Aegean - Turkish coast (Ephesus/KuÅŸadasÄ± are almost same spot!)
                "Ephesus, Turkey": { latOffset: 0.4, lngOffset: 0.3 },
                "KuÅŸadasÄ±, Turkey": { latOffset: -0.8, lngOffset: -0.3 },
                "Izmir, Turkey": { latOffset: 0.4, lngOffset: -0.3 },
                "Ã‡eÅŸme, Turkey": { latOffset: -0.4, lngOffset: 0.3 },
                // Aegean - Cyclades islands
                "Mykonos, Greece": { latOffset: 0.4, lngOffset: -0.3 },
                "Santorini, Greece": { latOffset: -0.4, lngOffset: 0.3 },
                "Milos, Greece": { latOffset: 0.3, lngOffset: -0.4 },
                // Peloponnese ports - spread them out
                "Itea, Greece": { latOffset: 0.5, lngOffset: -0.3 },
                "Nafplio, Greece": { latOffset: -0.3, lngOffset: 0.4 },
                "Katakolon, Greece": { latOffset: -0.5, lngOffset: -0.4 },
                "Pylos, Greece": { latOffset: -0.4, lngOffset: 0.3 },
                "Zakynthos, Greece": { latOffset: 0.4, lngOffset: -0.5 }
            };
            
            locations.forEach((loc, index) => {
                // Check for offset
                const offset = markerOffsets[loc.title];
                const displayLat = offset ? loc.coords[0] + offset.latOffset : loc.coords[0];
                const displayLng = offset ? loc.coords[1] + offset.lngOffset : loc.coords[1];
                
                const position = latLonToVector3(displayLat, displayLng, 1.0);
                const truePosition = latLonToVector3(loc.coords[0], loc.coords[1], 1.0);
                const config = getIconConfig(loc.title);
                
                // Offsets are applied above - no visual anchor line needed
                
                // Get density-based scale factor
                const densityScale = densityFactors.get(loc.id) || 1.0;
                
                // Check for manual override (applies to both doors and regular markers)
                const manualOverride = sizeOverrides[loc.title] || 1.0;
                
                // Size - doors are larger, apply manual overrides to all, density only to non-doors
                const baseSize = loc.isDoor ? 0.040 * manualOverride : 0.029 * densityScale * manualOverride;
                
                let texture, spriteMaterial, canvas;
                
                if (USE_AI_PORTHOLES) {
                    if (locationTextures[loc.title]) {
                        // Use location-specific texture if available (even for doors!)
                        texture = locationTextures[loc.title];
                    } else if (loc.isDoor) {
                        // Doors without custom image use the frame texture
                        texture = portholeFrameTexture;
                    } else {
                        // Fall back to default scene texture
                        texture = portholeSceneTexture;
                    }
                    
                if (texture) {
                        // Check if this is a video texture - use shader for transparency
                        if (isVideoTexture(loc.title)) {
                            // Use custom shader material for video (handles black transparency)
                            spriteMaterial = createVideoChromaMaterial(texture);
                        } else {
                            // Regular sprite material for static images
                            spriteMaterial = new THREE.SpriteMaterial({
                                map: texture,
                                transparent: true
                            });
                        }
                        canvas = null; // No canvas needed for AI images
                    }
                }
                
                // Fallback to canvas-drawn portholes if no texture
                if (!texture) {
                    canvas = document.createElement('canvas');
                    canvas.width = 128;
                    canvas.height = 150; // Taller for base
                    
                    // Doors start closed (iris animation), regular icons start open
                    const initialOpen = loc.isDoor ? 0 : 1;
                    
                    // Draw initial state
                    drawPortholeIcon(canvas, config, loc.isDoor, initialOpen);
                    
                    texture = new THREE.CanvasTexture(canvas);
                    spriteMaterial = new THREE.SpriteMaterial({
                        map: texture,
                        transparent: true
                    });
                }
                
                // Create Three.js sprite or mesh
                let marker;
                const useVideoMesh = isVideoTexture(loc.title);
                
                if (useVideoMesh) {
                    // Use Mesh with PlaneGeometry for video (supports shader material)
                    const geometry = new THREE.PlaneGeometry(1, 1);
                    marker = new THREE.Mesh(geometry, spriteMaterial);
                    marker.userData.isVideoMesh = true;
                } else {
                    // Use Sprite for static images
                    marker = new THREE.Sprite(spriteMaterial);
                    marker.userData.isVideoMesh = false;
                }
                
                // Position marker above surface
                const direction = position.clone().normalize();
                marker.position.copy(position).add(direction.multiplyScalar(0.015));
                
                // Adjust scale - AI images are square, canvas ones are taller
                let scaleX, scaleY;
                if (canvas === null) {
                    // AI images are square (1:1)
                    scaleX = baseSize * 2;
                    scaleY = baseSize * 2;
                } else {
                    // Canvas icons - doors are circular (no base), regular icons are taller (have base)
                    scaleX = baseSize * 2;
                    scaleY = loc.isDoor ? baseSize * 2 : baseSize * 2.35;
                }
                marker.scale.set(scaleX, scaleY, 1);
                
                // Store data on marker for click handling and animation
                marker.userData = { ...marker.userData, ...loc };
                marker.userData.baseSize = baseSize;
                marker.userData.iconConfig = config;
                marker.userData.iconCanvas = canvas; // null for AI images, canvas for drawn ones
                marker.userData.useAIPorthole = (canvas === null); // Track which mode based on actual usage
                
                // Initialize animation state - doors closed, regular open
                const initialOpen = loc.isDoor ? 0 : 1;
                markerAnimations.set(loc.id, {
                    openAmount: initialOpen,
                    targetOpen: initialOpen,
                    isAnimating: false,
                    callback: null
                });
                
                globe.add(marker);
                markers.push(marker);
            });
        }

        function buildLocationList() {
            const list = document.getElementById('locationList');
            
            // Doors first
            const doors = locations.filter(l => l.isDoor);
            const others = locations.filter(l => !l.isDoor);
            
            [...doors, ...others].forEach(loc => {
                const config = getIconConfig(loc.title);
                
                const item = document.createElement('div');
                item.className = `location-item ${loc.isDoor ? 'door' : ''}`;
                item.setAttribute('data-style', config.style);
                
                // Create icon container
                const iconDiv = document.createElement('div');
                iconDiv.className = 'icon';
                
                // Create canvas for custom icon
                const canvas = document.createElement('canvas');
                canvas.width = 64;
                canvas.height = 64;
                renderSidebarIcon(canvas, config);
                iconDiv.appendChild(canvas);
                
                // Create name
                const nameDiv = document.createElement('div');
                nameDiv.className = 'name';
                nameDiv.textContent = loc.title;
                
                item.appendChild(iconDiv);
                item.appendChild(nameDiv);
                
                item.onclick = () => {
                    skipPanelOpen = true; // User must click icon to open story
                    focusLocation(loc);
                    closeMobileMenu();
                };
                list.appendChild(item);
            });
            
            // Update locations count in panel hint
            const countEl = document.getElementById('locationsCount');
            if (countEl) {
                countEl.textContent = locations.length + ' places';
            }
            
            // Setup sidebar scroll hint
            setupSidebarScrollHint();
        }
        
        function setupSidebarScrollHint() {
            const list = document.getElementById('locationList');
            const hint = document.getElementById('sidebarScrollHint');
            if (!list || !hint) return;
            
            let scrollTimeout;
            let hasReachedBottom = false;
            
            // Show hint initially after a short delay
            setTimeout(() => {
                if (list.scrollHeight > list.clientHeight && !hasReachedBottom) {
                    hint.classList.add('visible');
                }
            }, 1000);
            
            list.addEventListener('scroll', () => {
                // Hide while scrolling
                hint.classList.remove('visible');
                
                // Check if near bottom
                const nearBottom = list.scrollTop + list.clientHeight >= list.scrollHeight - 50;
                if (nearBottom) {
                    hasReachedBottom = true;
                }
                
                // Show again after stopping (if not at bottom)
                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(() => {
                    if (!hasReachedBottom && list.scrollHeight > list.clientHeight) {
                        hint.classList.add('visible');
                    }
                }, 1500);
            });
        }

        function focusLocation(loc) {
            // Close panel immediately when navigating to new location
            closePanel();
            
            const lon = loc.coords[1]; // longitude (negative = west)
            const lat = loc.coords[0]; // latitude (positive = north)
            
            // Simple direct formula:
            // The globe's Y rotation corresponds to longitude
            // We need to convert longitude to the rotation value
            // Based on calibration: Toledo (lon=-83.54) should be at Y=-0.10
            // The formula: Y = -lon * (Math.PI / 180) adjusted for globe orientation
            
            // Convert longitude to radians, with offset to match globe texture
            // The globe texture has 0Â° longitude at a specific rotation
            // Calibrated offset based on Toledo: when lon=-83.54, Y should show Toledo
            const lonRad = lon * (Math.PI / 180);
            
            // The globe rotation Y increases as we go west (negative longitude)
            // and the texture is offset by approximately 0.1 radians at lon=0
            const targetY = -lonRad - 1.55;
            
            // Start zoom-out transition, then rotate, then zoom-in
            isTransitioning = true;
            transitionPhase = 'zoom-out';
            transitionStartTime = Date.now();
            
            // Store target rotation for after zoom-out
            pendingRotationY = targetY;
            pendingRotationX = lat * (Math.PI / 180);
            pendingLocation = loc;
            pendingZoomLocation = loc; // Track for dynamic zoom
            
            console.log(loc.title, '- lon:', lon, 'lat:', lat, 'targetY:', targetY.toFixed(2));
        }
        
        // Pending rotation values during transition
        let pendingRotationY = 0;
        let pendingRotationX = 0;
        let pendingLocation = null;
        let pendingZoomLocation = null; // Track location for dynamic zoom calculation

        function triggerBounce(locationId) {
            bouncingMarkerId = locationId;
            bounceStartTime = Date.now();
        }

        // Track current location for next door navigation
        let currentLocation = null;
        
        function openPanel(loc) {
            try {
                currentLocation = loc;
                
                // Hide tooltip when opening panel
                hideTooltip();
                
                // Note: Video playback is handled in click handler, not here
                
                const panelImage = document.getElementById('panelImage');
                panelImage.src = loc.image;
                panelImage.style.setProperty('--image-position', loc.imagePosition || 'center');
                document.getElementById('panelImageCaption').textContent = loc.imageCaption || '';
                document.getElementById('panelTag').textContent = loc.tag;
                document.getElementById('panelTitle').textContent = loc.title;
                
                const paragraphs = loc.fullDesc.split('\n\n');
                
                // Show first paragraph as preview (truncated if too long)
                let preview = paragraphs[0];
                if (preview.length > 150) {
                    preview = preview.substring(0, 150) + '...';
                }
                document.getElementById('panelPreview').textContent = preview;
                
                // Check if location has rich HTML content
                let fullContent;
                if (loc.useRichContent && loc.richContent) {
                    fullContent = loc.richContent;
                } else {
                    // Default: Full text for expanded view
                    fullContent = paragraphs.map(p => `<p>${p}</p>`).join('');
                }
                
                // Support both single image and array of images
                if (loc.storyImages && loc.storyImages.length > 0) {
                    fullContent += '<div class="story-gallery">';
                    loc.storyImages.forEach(img => {
                        fullContent += `<img src="${img}" class="story-image" alt="Story photo">`;
                    });
                    fullContent += '</div>';
                } else if (loc.storyImage) {
                    fullContent += `<img src="${loc.storyImage}" class="story-image" alt="Story photo">`;
                }
                document.getElementById('panelText').innerHTML = fullContent;
                
                // Attach click handlers to story images for lightbox
                attachImageClickHandlers();
                
                // Update next door button based on current location
                updateNextDoorButton(loc);
                
                // Update three doors navigation
                updateThreeDoorsNav(loc);
                
                // Reset expanded state when opening new location
                sidePanel.classList.remove('expanded');
                sidePanel.classList.add('open');
                panelIsOpen = true; // Stop auto-rotation while reading
                
                // Reset scroll position to top
                sidePanel.scrollTop = 0;
                
                // Hide scroll hint until panel fully opens
                document.getElementById('scrollHintBottom').classList.remove('visible');
            } catch (error) {
                console.error('Error opening panel:', error);
                // Reset panel state on error
                sidePanel.classList.remove('expanded');
                sidePanel.classList.add('open');
                panelIsOpen = true;
            }
        }
        
        function updateNextDoorButton(loc) {
            const nextDoorHint = document.getElementById('nextDoorHint');
            const nextDoorText = document.getElementById('nextDoorText');
            
            // Find doors
            const doors = locations.filter(l => l.isDoor);
            const doorIndex = doors.findIndex(d => d.id === loc.id);
            
            if (loc.isDoor && doorIndex < doors.length - 1) {
                // This is a door and there's a next door
                const nextDoor = doors[doorIndex + 1];
                const nextDoorNum = doorIndex + 2;
                nextDoorText.textContent = `Continue to Door #${nextDoorNum}`;
                nextDoorHint.style.display = '';
                nextDoorHint.dataset.nextDoorId = nextDoor.id;
            } else {
                // Last door or not a door - hide the next door button
                nextDoorHint.style.display = 'none';
            }
        }
        
        function goToNextDoor() {
            const nextDoorHint = document.getElementById('nextDoorHint');
            const nextDoorId = parseInt(nextDoorHint.dataset.nextDoorId);
            const nextDoor = locations.find(l => l.id === nextDoorId);
            
            if (nextDoor) {
                // Close panel and rotate globe to next door
                // User must click the icon to open the door
                closePanel();
                focusLocation(nextDoor);
            }
        }
        
        function goToDoor(doorNum) {
            const doors = locations.filter(l => l.isDoor);
            const targetDoor = doors[doorNum - 1]; // doorNum is 1-indexed
            
            if (targetDoor) {
                closePanel();
                focusLocation(targetDoor);
            }
        }
        
        function updateThreeDoorsNav(loc) {
            const nav = document.getElementById('threeDoorsNav');
            const buttons = nav.querySelectorAll('.door-nav-btn');
            const labels = [
                document.getElementById('doorLabel1'),
                document.getElementById('doorLabel2'),
                document.getElementById('doorLabel3')
            ];
            
            // Show nav only for door locations, hide for others
            if (loc && loc.isDoor) {
                nav.classList.remove('hidden');
                
                // Find which door this is (1, 2, or 3)
                const doors = locations.filter(l => l.isDoor);
                const currentDoorIndex = doors.findIndex(d => d.id === loc.id);
                const currentDoorNum = currentDoorIndex + 1;
                
                // Update button states
                buttons.forEach((btn, i) => {
                    const doorNum = i + 1;
                    if (doorNum === currentDoorNum) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
                
                // Update labels based on current door
                labels.forEach((label, i) => {
                    const doorNum = i + 1;
                    label.classList.remove('active-label');
                    
                    if (doorNum === currentDoorNum) {
                        label.textContent = 'viewing';
                        label.classList.add('active-label');
                    } else if (doorNum < currentDoorNum) {
                        label.textContent = `back to ${doorNum}`;
                    } else {
                        label.textContent = `skip to ${doorNum}`;
                    }
                });
            } else {
                // Hide nav for non-door locations
                nav.classList.add('hidden');
            }
        }
        
        function viewAllLocations() {
            closePanel();
            // On mobile, open the locations menu; on desktop, list is already visible
            if (window.innerWidth <= 768) {
                setTimeout(toggleMobileMenu, 300);
            }
        }

        // Lightbox functions
        function openLightbox(imgSrc, caption) {
            document.getElementById('lightboxImg').src = imgSrc;
            document.getElementById('lightboxCaption').textContent = caption || '';
            document.getElementById('lightbox').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeLightbox(event) {
            // Only close if clicking the background or close button, not the image
            if (event.target.id === 'lightbox' || event.target.classList.contains('lightbox-close')) {
                document.getElementById('lightbox').classList.remove('active');
                document.body.style.overflow = '';
            }
        }

        // Close lightbox with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                document.getElementById('lightbox').classList.remove('active');
                document.body.style.overflow = '';
            }
        });

        // Attach click handlers to story images when panel content changes
        function attachImageClickHandlers() {
            const storyImages = document.querySelectorAll('.panel-text .story-image, .panel-text .gallery-thumb');
            storyImages.forEach(img => {
                img.onclick = function() {
                    // Get caption from data-caption attribute first, then fall back to next sibling
                    let caption = img.dataset.caption || '';
                    if (!caption) {
                        const nextEl = img.parentElement?.nextElementSibling;
                        if (nextEl && nextEl.classList.contains('photo-caption-inline')) {
                            caption = nextEl.textContent;
                        }
                    }
                    openLightbox(img.src, caption);
                };
            });
        }

        function closePanel() {
            // Stop background music with fade out
            stopBackgroundMusic();
            
            // Pause video playback if current location has video
            if (currentLocation && locationVideos[currentLocation.title]) {
                const video = locationVideos[currentLocation.title];
                video.pause();
                video.currentTime = 0; // Reset to beginning for next open
                console.log('Paused and reset video for:', currentLocation.title);
            }
            
            sidePanel.classList.remove('open');
            sidePanel.classList.remove('expanded');
            panelIsOpen = false; // Resume auto-rotation
            currentLocation = null;
        }
        
        function expandPanel() {
            sidePanel.classList.add('expanded');
        }
        
        // Swipe up to expand panel on mobile
        let panelTouchStartY = 0;
        sidePanel.addEventListener('touchstart', function(e) {
            panelTouchStartY = e.touches[0].clientY;
        }, { passive: true });
        
        sidePanel.addEventListener('touchend', function(e) {
            const touchEndY = e.changedTouches[0].clientY;
            const swipeDistance = panelTouchStartY - touchEndY;
            
            // If swiped up more than 50px and panel is not expanded, expand it
            if (swipeDistance > 50 && !sidePanel.classList.contains('expanded')) {
                expandPanel();
            }
            // If swiped down more than 50px and panel is expanded, collapse it
            else if (swipeDistance < -50 && sidePanel.classList.contains('expanded')) {
                sidePanel.classList.remove('expanded');
            }
        }, { passive: true });

        // Scroll hint visibility based on scroll position
        const scrollHintBottom = document.getElementById('scrollHintBottom');
        let scrollTimeout = null;
        
        sidePanel.addEventListener('scroll', function() {
            const scrollTop = sidePanel.scrollTop;
            const scrollHeight = sidePanel.scrollHeight;
            const clientHeight = sidePanel.clientHeight;
            const distanceFromBottom = scrollHeight - scrollTop - clientHeight;
            
            // Hide hint while scrolling
            scrollHintBottom.classList.remove('visible');
            
            // Clear any existing timeout
            if (scrollTimeout) clearTimeout(scrollTimeout);
            
            // If not at the bottom, show hint again after user stops scrolling
            if (distanceFromBottom > 100) {
                scrollTimeout = setTimeout(() => {
                    scrollHintBottom.classList.add('visible');
                }, 2000); // Reappear after 2 seconds of no scrolling
            }
        }, { passive: true });
        
        // Show scroll hint when panel opens (desktop) or expands (mobile)
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.attributeName === 'class') {
                    const isOpen = sidePanel.classList.contains('open');
                    const isExpanded = sidePanel.classList.contains('expanded');
                    const isMobile = window.innerWidth <= 768;
                    
                    // On mobile: show only when expanded
                    // On desktop: show when open
                    if ((isMobile && isExpanded && isOpen) || (!isMobile && isOpen)) {
                        // Small delay to let panel open/expand first
                        setTimeout(() => {
                            scrollHintBottom.classList.add('visible');
                        }, 500);
                    } else if (!isOpen) {
                        // Panel closed - hide hint
                        scrollHintBottom.classList.remove('visible');
                    }
                }
            });
        });
        observer.observe(sidePanel, { attributes: true });

        function onMouseDown(event) {
            event.preventDefault();
            isUserInteracting = true;
            
            // Hide tooltip when user starts interacting
            hideTooltip();
            
            mouseXOnMouseDown = event.clientX;
            mouseYOnMouseDown = event.clientY;
            
            // Capture current TARGET rotation (not globe rotation) for smooth continuation
            targetRotationXOnMouseDown = targetRotationX;
            targetRotationYOnMouseDown = targetRotationY;
        }

        function onMouseMove(event) {
            if (isUserInteracting) {
                targetRotationY = targetRotationYOnMouseDown + (event.clientX - mouseXOnMouseDown) * 0.002;
                targetRotationX = targetRotationXOnMouseDown + (event.clientY - mouseYOnMouseDown) * 0.002;
                targetRotationX = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, targetRotationX));
            }
            
            checkHover(event);
        }

        function onMouseUp() {
            isUserInteracting = false;
        }

        function onMouseWheel(event) {
            event.preventDefault();
            camera.position.z += event.deltaY * 0.002;
            camera.position.z = Math.max(1.2, Math.min(4, camera.position.z));
        }

        // Touch events
        let touchStartX, touchStartY;
        let initialPinchDistance = null;
        let initialCameraZ = null;
        
        function onTouchStart(event) {
            // Hide tooltip when user starts interacting
            hideTooltip();
            
            if (event.touches.length === 1) {
                isUserInteracting = true;
                touchStartX = event.touches[0].clientX;
                touchStartY = event.touches[0].clientY;
                targetRotationXOnMouseDown = targetRotationX;
                targetRotationYOnMouseDown = targetRotationY;
            } else if (event.touches.length === 2) {
                // Pinch zoom start
                isUserInteracting = true;
                initialPinchDistance = getPinchDistance(event.touches);
                initialCameraZ = camera.position.z;
            }
        }

        function onTouchMove(event) {
            event.preventDefault();
            
            if (event.touches.length === 1 && isUserInteracting && !initialPinchDistance) {
                // Single finger drag to rotate
                targetRotationY = targetRotationYOnMouseDown + (event.touches[0].clientX - touchStartX) * 0.002;
                targetRotationX = targetRotationXOnMouseDown + (event.touches[0].clientY - touchStartY) * 0.002;
                targetRotationX = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, targetRotationX));
            } else if (event.touches.length === 2 && initialPinchDistance) {
                // Pinch to zoom
                const currentDistance = getPinchDistance(event.touches);
                const scale = initialPinchDistance / currentDistance;
                camera.position.z = Math.max(1.2, Math.min(4, initialCameraZ * scale));
            }
        }

        function onTouchEnd(event) {
            if (event.touches.length === 0) {
                isUserInteracting = false;
                initialPinchDistance = null;
                initialCameraZ = null;
            } else if (event.touches.length === 1) {
                // Switched from pinch to single touch
                initialPinchDistance = null;
                touchStartX = event.touches[0].clientX;
                touchStartY = event.touches[0].clientY;
                targetRotationXOnMouseDown = targetRotationX;
                targetRotationYOnMouseDown = targetRotationY;
            }
        }
        
        function getPinchDistance(touches) {
            const dx = touches[0].clientX - touches[1].clientX;
            const dy = touches[0].clientY - touches[1].clientY;
            return Math.sqrt(dx * dx + dy * dy);
        }
        
        // Mobile tap to select location
        function onTouchTap(event) {
            if (event.changedTouches.length === 1) {
                const touch = event.changedTouches[0];
                mouse.x = (touch.clientX / window.innerWidth) * 2 - 1;
                mouse.y = -(touch.clientY / window.innerHeight) * 2 + 1;
                
                raycaster.setFromCamera(mouse, camera);
                const intersects = raycaster.intersectObjects(markers);
                
                if (intersects.length > 0) {
                    const marker = intersects[0].object;
                    if (marker.userData.title) {
                        const loc = marker.userData;
                        
                        // Check if we're switching to a different location
                        const isSwitching = currentLocation && currentLocation.id !== loc.id;
                        
                        // Close previous door's iris if switching (only for doors)
                        if (isSwitching && currentLocation && currentLocation.isDoor) {
                            startIrisAnimation(currentLocation.id, 0, null);
                        }
                        
                        // If switching, trigger globe rotation
                        if (isSwitching) {
                            closePanel();
                            const lon = loc.coords[1];
                            const lat = loc.coords[0];
                            isTransitioning = true;
                            transitionPhase = 'zoom-out';
                            transitionStartTime = Date.now();
                            pendingRotationY = getTargetY(lon);
                            pendingRotationX = lat * (Math.PI / 180);
                            pendingLocation = null;
                            pendingZoomLocation = loc; // Track for dynamic zoom
                        }
                        
                        // Check if this location has a video animation
                        const hasVideo = locationVideos[loc.title];
                        
                        // Helper function to open panel (now triggers midway through animation)
                        const openPanelForLocation = () => {
                            // Start background music for doors (if configured)
                            if (loc.isDoor && doorAudioTracks[loc.id]) {
                                playBackgroundMusic(loc.id);
                            }
                            
                            if (hasVideo) {
                                // Play video and open panel midway through
                                const video = locationVideos[loc.title];
                                video.currentTime = 0; // Reset to start
                                video.play();
                                console.log('Playing video animation for:', loc.title);
                                
                                // Open panel after 40% of video duration (or 400ms minimum)
                                const panelDelay = Math.max(400, (video.duration * 0.4) * 1000);
                                setTimeout(() => openPanel(loc), panelDelay);
                            } else {
                                // No video - open panel immediately
                                openPanel(loc);
                            }
                        };
                        
                        // Doors have iris animation, regular icons don't
                        if (loc.isDoor) {
                            const currentOpen = getMarkerOpenAmount(loc.id);
                            
                            if (currentOpen < 0.5) {
                                // Iris is closed - start animation and open panel midway
                                const delay = isSwitching ? 600 : 0;
                                setTimeout(() => {
                                    startIrisAnimation(loc.id, 1, null); // No callback - we'll use timeout
                                    
                                    // Open panel after 200ms (roughly halfway through iris animation)
                                    setTimeout(() => openPanelForLocation(), 200);
                                }, delay);
                            } else {
                                // Iris already open - handle video/panel
                                if (isSwitching) {
                                    setTimeout(() => openPanelForLocation(), 800);
                                } else {
                                    openPanelForLocation();
                                }
                            }
                        } else {
                            // Regular icons - no iris animation
                            if (isSwitching) {
                                setTimeout(() => openPanelForLocation(), 800);
                            } else {
                                openPanelForLocation();
                            }
                        }
                    }
                }
            }
        }
        
        // Mobile menu toggle
        function toggleMobileMenu() {
            const menu = document.getElementById('locationList');
            const toggle = document.getElementById('menuToggle');
            const overlay = document.getElementById('mobileOverlay');
            
            menu.classList.toggle('open');
            toggle.classList.toggle('open');
            overlay.classList.toggle('open');
        }
        
        // Close mobile menu when location selected
        function closeMobileMenu() {
            const menu = document.getElementById('locationList');
            const toggle = document.getElementById('menuToggle');
            const overlay = document.getElementById('mobileOverlay');
            
            menu.classList.remove('open');
            toggle.classList.remove('open');
            overlay.classList.remove('open');
        }

        function onClick(event) {
            if (hoveredMarker) {
                const loc = hoveredMarker.userData;
                
                // Check if we're switching to a different location
                const isSwitching = currentLocation && currentLocation.id !== loc.id;
                
                // Close previous door's iris if switching (only for doors)
                if (isSwitching && currentLocation && currentLocation.isDoor) {
                    startIrisAnimation(currentLocation.id, 0, null);
                }
                
                // If switching, trigger globe rotation
                if (isSwitching) {
                    closePanel();
                    const lon = loc.coords[1];
                    const lat = loc.coords[0];
                    isTransitioning = true;
                    transitionPhase = 'zoom-out';
                    transitionStartTime = Date.now();
                    pendingRotationY = getTargetY(lon);
                    pendingRotationX = lat * (Math.PI / 180);
                    pendingLocation = null;
                    pendingZoomLocation = loc; // Track for dynamic zoom
                }
                
                // Check if this location has a video animation
                const hasVideo = locationVideos[loc.title];
                
                // Helper function to open panel (now triggers midway through animation)
                const openPanelForLocation = () => {
                    // Start background music for doors (if configured)
                    if (loc.isDoor && doorAudioTracks[loc.id]) {
                        playBackgroundMusic(loc.id);
                    }
                    
                    if (hasVideo) {
                        // Play video and open panel midway through
                        const video = locationVideos[loc.title];
                        video.currentTime = 0; // Reset to start
                        video.play();
                        console.log('Playing video animation for:', loc.title);
                        
                        // Open panel after 40% of video duration (or 400ms minimum)
                        const panelDelay = Math.max(400, (video.duration * 0.4) * 1000);
                        setTimeout(() => openPanel(loc), panelDelay);
                    } else {
                        // No video - open panel immediately
                        openPanel(loc);
                    }
                };
                
                // Doors have iris animation, regular icons don't
                if (loc.isDoor) {
                    const currentOpen = getMarkerOpenAmount(loc.id);
                    
                    if (currentOpen < 0.5) {
                        // Iris is closed - start animation and open panel midway
                        const delay = isSwitching ? 600 : 0;
                        setTimeout(() => {
                            startIrisAnimation(loc.id, 1, null); // No callback - we'll use timeout
                            
                            // Open panel after 200ms (roughly halfway through iris animation)
                            setTimeout(() => openPanelForLocation(), 200);
                        }, delay);
                    } else {
                        // Iris already open - handle video/panel
                        if (isSwitching) {
                            setTimeout(() => openPanelForLocation(), 800);
                        } else {
                            openPanelForLocation();
                        }
                    }
                } else {
                    // Regular icons - no iris animation
                    if (isSwitching) {
                        setTimeout(() => openPanelForLocation(), 800);
                    } else {
                        openPanelForLocation();
                    }
                }
            }
        }
        
        // Helper function to calculate shortest angular distance (avoids spinning the long way)
        function shortestAngleDiff(current, target) {
            let diff = target - current;
            // Normalize to -Ï€ to Ï€ range
            while (diff > Math.PI) diff -= 2 * Math.PI;
            while (diff < -Math.PI) diff += 2 * Math.PI;
            return diff;
        }
        
        // Helper function to get calibrated Y rotation for a longitude
        function getTargetY(lon) {
            if (lon <= -83.54) {
                const slope = (-0.87 - (-0.10)) / (-41.89 - (-83.54));
                return -0.10 + (lon - (-83.54)) * slope;
            } else if (lon <= -41.89) {
                const t = (lon - (-83.54)) / (-41.89 - (-83.54));
                return -0.10 + t * (-0.87 - (-0.10));
            } else if (lon <= 5.37) {
                const t = (lon - (-41.89)) / (5.37 - (-41.89));
                return -0.87 + t * (-1.65 - (-0.87));
            } else if (lon <= 9.21) {
                const t = (lon - 5.37) / (9.21 - 5.37);
                return -1.65 + t * (4.60 - (-1.65));
            } else if (lon <= 12.50) {
                const t = (lon - 9.21) / (12.50 - 9.21);
                return 4.60 + t * (4.50 - 4.60);
            } else if (lon <= 14.51) {
                const t = (lon - 12.50) / (14.51 - 12.50);
                return 4.50 + t * (4.42 - 4.50);
            } else if (lon <= 130.85) {
                const t = (lon - 14.51) / (130.85 - 14.51);
                return 4.42 + t * (2.44 - 4.42);
            } else if (lon <= 151.21) {
                const t = (lon - 130.85) / (151.21 - 130.85);
                return 2.44 + t * (2.10 - 2.44);
            } else if (lon <= 153.03) {
                const t = (lon - 151.21) / (153.03 - 151.21);
                return 2.10 + t * (8.30 - 2.10);
            } else if (lon <= 167.90) {
                const t = (lon - 153.03) / (167.90 - 153.03);
                return 8.30 + t * (8.10 - 8.30);
            } else if (lon <= 174.78) {
                const t = (lon - 167.90) / (174.78 - 167.90);
                return 8.10 + t * (8.01 - 8.10);
            } else if (lon <= 176.17) {
                const t = (lon - 174.78) / (176.17 - 174.78);
                return 8.01 + t * (7.93 - 8.01);
            } else {
                const t = (lon - 176.17) / (176.91 - 176.17);
                return 7.93 + t * (7.90 - 7.93);
            }
        }

        function checkHover(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(markers);
            
            if (intersects.length > 0) {
                const marker = intersects[0].object;
                
                if (marker.userData.title) {
                    hoveredMarker = marker;
                    showTooltip(marker.userData, marker);
                    document.body.style.cursor = 'pointer';
                    
                    // Highlight marker - scale up from original size
                    const baseScale = marker.userData.baseSize * 2;
                    const useAI = marker.userData.useAIPorthole;
                    const baseScaleY = useAI ? marker.userData.baseSize * 2 : (marker.userData.isDoor ? marker.userData.baseSize * 2 : marker.userData.baseSize * 2.2);
                    marker.scale.set(baseScale * 1.3, baseScaleY * 1.3, 1);
                }
            } else {
                if (hoveredMarker) {
                    // Reset to original size
                    const baseScale = hoveredMarker.userData.baseSize * 2;
                    const useAI = hoveredMarker.userData.useAIPorthole;
                    const baseScaleY = useAI ? hoveredMarker.userData.baseSize * 2 : (hoveredMarker.userData.isDoor ? hoveredMarker.userData.baseSize * 2 : hoveredMarker.userData.baseSize * 2.2);
                    hoveredMarker.scale.set(baseScale, baseScaleY, 1);
                }
                hoveredMarker = null;
                hideTooltip();
                document.body.style.cursor = isUserInteracting ? 'grabbing' : 'grab';
            }
        }

        function showTooltip(loc, marker) {
            document.getElementById('tooltipTag').textContent = loc.tag;
            document.getElementById('tooltipTitle').textContent = loc.title;
            document.getElementById('tooltipDesc').textContent = loc.shortDesc;
            
            updateTooltipPosition(marker);
            tooltip.classList.add('visible');
        }
        
        function updateTooltipPosition(marker) {
            // Calculate marker's screen position
            const markerWorldPos = new THREE.Vector3();
            marker.getWorldPosition(markerWorldPos);
            
            // Project to screen coordinates
            const screenPos = markerWorldPos.clone().project(camera);
            
            // Convert to pixel coordinates
            const x = (screenPos.x * 0.5 + 0.5) * window.innerWidth;
            const y = (-screenPos.y * 0.5 + 0.5) * window.innerHeight;
            
            // Position tooltip centered below the icon with generous clearance
            // Account for marker size (doors are larger)
            const offsetY = marker.userData.isDoor ? 85 : 70;
            
            tooltip.style.left = x + 'px';
            tooltip.style.top = (y + offsetY) + 'px';
        }

        function hideTooltip() {
            tooltip.classList.remove('visible');
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            
            // Cinematic intro - just zoom, globe is already positioned
            if (!introComplete) {
                if (!introStartTime) {
                    introStartTime = Date.now();
                    // Set globe rotation immediately to Toledo
                    globe.rotation.y = TOLEDO_Y;
                    globe.rotation.x = TOLEDO_X;
                    targetRotationY = TOLEDO_Y;
                    targetRotationX = TOLEDO_X;
                }
                
                const elapsed = Date.now() - introStartTime;
                const progress = Math.min(elapsed / introDuration, 1);
                
                // Easing function for smooth deceleration
                const easeOutCubic = 1 - Math.pow(1 - progress, 3);
                
                // Zoom from far (8) to close (1.62) - 10% closer
                camera.position.z = 8 - (6.38 * easeOutCubic);
                
                if (progress >= 1) {
                    introComplete = true;
                }
            } else {
                // Handle zoom transition animation
                if (isTransitioning) {
                    const elapsed = Date.now() - transitionStartTime;
                    
                    if (transitionPhase === 'zoom-out') {
                        const progress = Math.min(elapsed / zoomOutDuration, 1);
                        const easeOut = 1 - Math.pow(1 - progress, 2);
                        
                        // Zoom out
                        const startZ = camera.position.z;
                        camera.position.z = startZ + (zoomOutDistance - startZ) * easeOut * 0.1;
                        
                        if (progress >= 1) {
                            // Switch to rotate phase - apply pending rotation
                            targetRotationY = pendingRotationY;
                            targetRotationX = pendingRotationX;
                            transitionPhase = 'zoom-in';
                            transitionStartTime = Date.now();
                            
                            // Calculate zoom distance based on target location's density
                            currentZoomInDistance = getZoomDistanceForLocation(pendingZoomLocation || pendingLocation);
                        }
                    } else if (transitionPhase === 'zoom-in') {
                        const progress = Math.min(elapsed / zoomInDuration, 1);
                        const easeOut = 1 - Math.pow(1 - progress, 3);
                        
                        // Zoom in (closer for dense areas)
                        camera.position.z = zoomOutDistance - (zoomOutDistance - currentZoomInDistance) * easeOut;
                        
                        // Check if globe rotation has settled (close enough to target)
                        // Use shortestAngleDiff since rotation values may differ by full rotations
                        const rotationSettled = 
                            Math.abs(shortestAngleDiff(globe.rotation.y, targetRotationY)) < 0.05 &&
                            Math.abs(globe.rotation.x - targetRotationX) < 0.05;
                        
                        if (progress >= 1 && rotationSettled) {
                            isTransitioning = false;
                            transitionPhase = 'none';
                            camera.position.z = currentZoomInDistance;
                            pendingZoomLocation = null;
                            
                            // Trigger bounce animation for the target location
                            if (pendingLocation) {
                                triggerBounce(pendingLocation.id);
                                // Panel no longer auto-opens - user must click icon
                                pendingLocation = null;
                            }
                        }
                    }
                }
                
                // Normal interaction after intro
                
                // Only auto-rotate if:
                // - User is not dragging
                // - Panel is not open (user is not reading)
                // - Not transitioning
                if (!isUserInteracting && !panelIsOpen && !isTransitioning) {
                    targetRotationY += 0.0001;
                }
                
                // Always smooth-lerp toward target rotation
                // Use shortest angular distance to avoid spinning the long way around
                globe.rotation.y += shortestAngleDiff(globe.rotation.y, targetRotationY) * 0.05;
                globe.rotation.x += (targetRotationX - globe.rotation.x) * 0.05;
                
                // Periodically normalize rotation values to prevent unbounded accumulation
                // This keeps values in a reasonable range without affecting visual appearance
                if (Math.abs(globe.rotation.y) > Math.PI * 4) {
                    const normalize = Math.round(globe.rotation.y / (2 * Math.PI)) * 2 * Math.PI;
                    globe.rotation.y -= normalize;
                    targetRotationY -= normalize;
                }
                
                // Update tooltip position to stay anchored to hovered marker
                if (hoveredMarker && tooltip.classList.contains('visible')) {
                    updateTooltipPosition(hoveredMarker);
                }
            }
            
            // Marker animations
            markers.forEach((marker, i) => {
                const isDoor = marker.userData.isDoor;
                const useAI = marker.userData.useAIPorthole;
                const baseScale = marker.userData.baseSize * 2; // Original scale
                // AI portholes are square, canvas ones have base
                const baseScaleY = useAI ? marker.userData.baseSize * 2 : (isDoor ? marker.userData.baseSize * 2 : marker.userData.baseSize * 2.2);
                const isBouncing = bouncingMarkerId && marker.userData.id === bouncingMarkerId;
                
                // Billboard video meshes to face camera
                if (marker.userData.isVideoMesh) {
                    marker.lookAt(camera.position);
                }
                
                // Ensure marker is visible and fully opaque
                marker.visible = true;
                if (marker.material.opacity !== undefined) {
                    marker.material.opacity = 1.0;
                }
                
                if (isBouncing && bounceStartTime) {
                    // Bounce animation - up and down with decreasing amplitude
                    const elapsed = Date.now() - bounceStartTime;
                    const progress = elapsed / bounceDuration;
                    
                    if (progress < 1) {
                        // Bouncing: scale pulses with decreasing amplitude
                        const bounceFreq = 1; // Single bounce
                        const decay = 1 - progress; // Decreasing amplitude
                        const bounce = 1 + Math.sin(progress * Math.PI * bounceFreq) * 0.3 * decay;
                        marker.scale.set(baseScale * bounce, baseScaleY * bounce, 1);
                    } else {
                        // Animation complete
                        bouncingMarkerId = null;
                        bounceStartTime = null;
                        marker.scale.set(baseScale, baseScaleY, 1);
                    }
                } else if (!hoveredMarker || hoveredMarker !== marker) {
                    // Check if this marker's panel is currently open - if so, stay still
                    const isPanelOpenForThis = currentLocation && currentLocation.id === marker.userData.id;
                    
                    if (isPanelOpenForThis) {
                        // Panel is open for this location - no animation, stay at base scale
                        marker.scale.set(baseScale, baseScaleY, 1);
                    } else if (isDoor) {
                        // Doors: only pulse when NO panel is open anywhere
                        if (currentLocation) {
                            // Some panel is open - doors stay still
                            marker.scale.set(baseScale, baseScaleY, 1);
                        } else {
                            // No panel open - doors pulse to attract attention
                            const pulse = 1 + Math.sin(Date.now() * 0.003 + i) * 0.1;
                            marker.scale.set(baseScale * pulse, baseScaleY * pulse, 1);
                        }
                    } else if (useAI) {
                        // AI portholes: very gentle breathing (slower, subtler)
                        const breath = 1 + Math.sin(Date.now() * 0.0015 + i * 0.5) * 0.03;
                        marker.scale.set(baseScale * breath, baseScaleY * breath, 1);
                    }
                }
            });
            
            // Update video textures each frame - smart update to prevent glitching
            videoTextures.forEach(({ texture, video }) => {
                // Update texture if:
                // 1. Video is actively playing (for animation)
                // 2. Video is paused but we haven't shown the current frame yet (for static display)
                const isPlaying = !video.paused && !video.ended;
                const isReady = video.readyState >= 2;
                
                if (isReady) {
                    if (isPlaying) {
                        // Video is playing - update every frame
                        texture.needsUpdate = true;
                    } else if (!texture.userData?.lastFrameShown || texture.userData.lastFrameShown !== video.currentTime) {
                        // Video paused/ended - update once to show current frame, then stop
                        texture.needsUpdate = true;
                        texture.userData = texture.userData || {};
                        texture.userData.lastFrameShown = video.currentTime;
                    }
                }
            });
            
            renderer.render(scene, camera);
        }

        // Stars background
        function initStars() {
            const canvas = document.getElementById('stars');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const stars = [];
            for (let i = 0; i < 300; i++) {
                stars.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    size: Math.random() * 1.5 + 0.5,
                    opacity: Math.random() * 0.5 + 0.3,
                    twinkle: Math.random() * Math.PI
                });
            }
            
            function drawStars() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                stars.forEach(star => {
                    const opacity = star.opacity + Math.sin(Date.now() * 0.001 + star.twinkle) * 0.2;
                    ctx.beginPath();
                    ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(245, 240, 232, ${Math.max(0.1, opacity)})`;
                    ctx.fill();
                });
                requestAnimationFrame(drawStars);
            }
            
            drawStars();
            
            window.addEventListener('resize', () => {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            });
        }

        // Initialize
        init();
        
        // World Tour Carousel
        let carouselInitialized = false;
        let carouselInterval = null;
        let currentSlide = 0;
        let carouselSlides = null;
        let carouselDots = null;
        
        function goToSlide(index) {
            if (!carouselSlides || !carouselDots) return;
            carouselSlides[currentSlide].classList.remove('active');
            carouselDots[currentSlide].classList.remove('active');
            currentSlide = index;
            if (currentSlide >= carouselSlides.length) currentSlide = 0;
            if (currentSlide < 0) currentSlide = carouselSlides.length - 1;
            carouselSlides[currentSlide].classList.add('active');
            carouselDots[currentSlide].classList.add('active');
        }
        
        function nextSlide() {
            goToSlide(currentSlide + 1);
        }
        
        function prevSlide() {
            goToSlide(currentSlide - 1);
        }
        
        function resetCarouselTimer() {
            if (carouselInterval) clearInterval(carouselInterval);
            carouselInterval = setInterval(nextSlide, 4000);
        }
        
        function initCarousel() {
            const carousel = document.getElementById('worldCarousel');
            if (!carousel) return;
            
            // Prevent duplicate initialization
            if (carouselInitialized) {
                resetCarouselTimer();
                return;
            }
            
            carouselSlides = carousel.querySelectorAll('.carousel-slide');
            const dotsContainer = carousel.querySelector('.carousel-dots');
            
            // Clear any existing dots and arrows
            dotsContainer.innerHTML = '';
            const existingArrows = carousel.querySelectorAll('.carousel-arrow');
            existingArrows.forEach(a => a.remove());
            
            currentSlide = 0;
            
            // Create dots
            carouselSlides.forEach((_, i) => {
                const dot = document.createElement('div');
                dot.className = 'carousel-dot' + (i === 0 ? ' active' : '');
                dotsContainer.appendChild(dot);
            });
            
            carouselDots = dotsContainer.querySelectorAll('.carousel-dot');
            
            // Add click handlers to dots
            carouselDots.forEach((dot, i) => {
                dot.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    goToSlide(i);
                    resetCarouselTimer();
                });
            });
            
            // Create arrow buttons
            const prevArrow = document.createElement('button');
            prevArrow.className = 'carousel-arrow prev';
            prevArrow.innerHTML = 'â€¹';
            prevArrow.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                prevSlide();
                resetCarouselTimer();
            });
            
            const nextArrow = document.createElement('button');
            nextArrow.className = 'carousel-arrow next';
            nextArrow.innerHTML = 'â€º';
            nextArrow.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                nextSlide();
                resetCarouselTimer();
            });
            
            carousel.appendChild(prevArrow);
            carousel.appendChild(nextArrow);
            
            // Swipe support
            let touchStartX = 0;
            let touchEndX = 0;
            
            carousel.addEventListener('touchstart', function(e) {
                touchStartX = e.changedTouches[0].screenX;
            }, { passive: true });
            
            carousel.addEventListener('touchend', function(e) {
                touchEndX = e.changedTouches[0].screenX;
                const diff = touchStartX - touchEndX;
                if (Math.abs(diff) > 50) { // minimum swipe distance
                    if (diff > 0) {
                        nextSlide(); // swipe left = next
                    } else {
                        prevSlide(); // swipe right = prev
                    }
                    resetCarouselTimer();
                }
            }, { passive: true });
            
            // Pause on hover (desktop)
            carousel.addEventListener('mouseenter', function() {
                if (carouselInterval) clearInterval(carouselInterval);
            });
            carousel.addEventListener('mouseleave', function() {
                resetCarouselTimer();
            });
            
            // Start auto-rotation
            resetCarouselTimer();
            carouselInitialized = true;
        }
        
        // Initialize carousel when panel opens (observe for panel open)
        const carouselObserver = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.target.classList.contains('open')) {
                    setTimeout(initCarousel, 100);
                }
            });
        });
        
        const sidePanelEl = document.getElementById('sidePanel');
        if (sidePanelEl) {
            carouselObserver.observe(sidePanelEl, { attributes: true, attributeFilter: ['class'] });
        }
    </script>
    
    <!-- Background Music for Story Panels -->
    <audio id="backgroundMusic" preload="none"></audio>

    <!-- Lightbox for full-size images -->
    <div class="lightbox" id="lightbox" onclick="closeLightbox(event)">
        <span class="lightbox-close">&times;</span>
        <img src="" alt="Full size image" id="lightboxImg">
        <div class="lightbox-caption" id="lightboxCaption"></div>
    </div>

    <!-- Director's Commentary Modal -->
    <div class="commentary-modal-overlay" id="commentaryModal" onclick="closeCommentaryModal(event)">
        <div class="commentary-modal" onclick="event.stopPropagation()">
            <div class="commentary-header">
                <span class="commentary-icon">ðŸŽ¬</span>
                <span class="commentary-label">Director's Commentary</span>
            </div>
            <h4 class="commentary-title">How to Make an Impression</h4>
            <p>The assistant cruise director gave me the grand tour and dropped me at my cabin. I flipped through my folder full of welcome papers - induction schedules, safety protocols, crew mess hours. <em>I hope I can find my way back to...</em> where was it again?</p>
            <p>"You'll be fine. See you at 14:30 for Induction 1."</p>
            <p>The door clicked shut. I wanted to call home. Tell everyone I'd made it. The phone on the wall looked simple enough.</p>
            <p><span class="story-emphasis">Here's what I understood about ship communication systems:</span> nothing.</p>
            <p><span class="story-emphasis">Here's what I understood about maritime hierarchy and protocol:</span> less than nothing.</p>
            <p>Let me paint you a picture of embarkation day on a cruise ship. Two thousand passengers are boarding. Luggage is being sorted and delivered to 800+ cabins. The kitchen is prepping for the first seating. Safety officers are running equipment checks. The entertainment staff is rehearsing the welcome show.</p>
            <p>And on the bridge - the nerve center of the entire operation - the Captain is coordinating with harbor pilots, monitoring weather reports, clearing departure procedures, and managing a crew of over 600 people.</p>
            <p>This is where I come in.</p>
            <p>So when the phone wouldn't connect, I did what any reasonable person would do. I started mashing zeros like I was trying to win a prize.</p>
            <p class="zeros">Nothing.</p>
            <p class="zeros">Zero zero zero.</p>
            <p class="zeros">Still nothing.</p>
            <p class="zeros"><em>Zero zero zero zero zero-</em></p>
            <span class="captain-voice">"Bridge. Captain speaking."</span>
            <p>I froze.</p>
            <span class="captain-voice">"...Hello?"</span>
            <p>I hung up.</p>
            <span class="rule-one">Rule #1: Do not call the bridge. Ever. Unless someone is actively dying - and even then, there's a chain of command for that.</span>
            <p class="kicker">I had been aboard for approximately forty-five minutes. But for one beautiful, horrifying moment, I was the guy who made the Captain answer the phone to help the new musician call his mom.</p>
        </div>
    </div>

    <script>
        // Director's Commentary Modal Functions
        function openCommentaryModal() {
            document.getElementById('commentaryModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        function closeCommentaryModal(event) {
            if (event.target === document.getElementById('commentaryModal')) {
                document.getElementById('commentaryModal').classList.remove('active');
                document.body.style.overflow = '';
            }
        }
        
        // Close on Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                document.getElementById('commentaryModal').classList.remove('active');
                document.body.style.overflow = '';
            }
        });
    </script>

</body>
</html>
